module.exports=[89058,88497,22787,81719,27872,31641,92189,15512,95320,60933,37883,96745,56389,a=>{"use strict";let b;class c{static zeros=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"];static groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];static groupBases=[0,0,0x2000000,0x290d741,0x1000000,0x2e90edd,0x39aa400,0x267bf47,0x1000000,0x290d741,1e7,0x12959c3,0x222c000,0x3bd7765,7529536,0xadcea1,0x1000000,0x1704f61,0x206fc40,0x2cddcf9,64e6,4084101,5153632,6436343,7962624,9765625,0xb54ba0,0xdaf26b,0x1069c00,0x138f9ad,243e5,0x1b4d89f,0x2000000,0x25528a1,0x2b54a20,0x3216b93,0x39aa400];static wordSize=26;static WORD_SIZE_BIGINT=BigInt(c.wordSize);static WORD_MASK=(1n<<c.WORD_SIZE_BIGINT)-1n;static MAX_SAFE_INTEGER_BIGINT=BigInt(Number.MAX_SAFE_INTEGER);static MIN_SAFE_INTEGER_BIGINT=BigInt(Number.MIN_SAFE_INTEGER);static MAX_IMULN_ARG=0x3ffffff;static MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT=(1n<<53n)-1n;_magnitude;_sign;_nominalWordLength;red;get negative(){return this._sign}set negative(a){this.assert(0===a||1===a,"Negative property must be 0 or 1"),0n===this._magnitude?this._sign=0:this._sign=+(1===a)}get _computedWordsArray(){if(0n===this._magnitude)return[0];let a=[],b=this._magnitude;for(;b>0n;)a.push(Number(b&c.WORD_MASK)),b>>=c.WORD_SIZE_BIGINT;return a.length>0?a:[0]}get words(){let a=this._computedWordsArray;if(this._nominalWordLength<=a.length)return a;let b=Array(this._nominalWordLength).fill(0);for(let c=0;c<a.length;c++)b[c]=a[c];return b}set words(a){let b=this._sign,d=0n,e=a.length>0?a.length:1;for(let b=e-1;b>=0;b--){let e=void 0===a[b]?0:a[b];d=d<<c.WORD_SIZE_BIGINT|BigInt(e&Number(c.WORD_MASK))}this._magnitude=d,this._sign=b,this._nominalWordLength=e,this.normSign()}get length(){return Math.max(1,this._nominalWordLength)}static isBN(a){return a instanceof c||null!==a&&"object"==typeof a&&a.constructor?.wordSize===c.wordSize&&Array.isArray(a.words)}static max(a,b){return a.cmp(b)>0?a:b}static min(a,b){return 0>a.cmp(b)?a:b}constructor(a=0,b=10,c="be"){if(this._magnitude=0n,this._sign=0,this._nominalWordLength=1,this.red=null,void 0===a&&(a=0),null===a)return void this._initializeState(0n,0);if("bigint"==typeof a){this._initializeState(a<0n?-a:a,+(a<0n)),this.normSign();return}let d=b,e=c;if(("le"===b||"be"===b)&&(e=b,d=10),"number"==typeof a)return void this.initNumber(a,e);if(Array.isArray(a))return void this.initArray(a,e);if("string"==typeof a){"hex"===d&&(d=16),this.assert("number"==typeof d&&d===(0|d)&&d>=2&&d<=36,"Base must be an integer between 2 and 36");const b=a.toString().replace(/\s+/g,"");let c=0,f=0;b.startsWith("-")?(c++,f=1):b.startsWith("+")&&c++;const g=b.substring(c);if(0===g.length){this._initializeState(0n,1===f&&b.startsWith("-")?1:0),this.normSign();return}if(16===d){let a;if("le"===e){const a=[];let b=g;b.length%2!=0&&(b="0"+b);for(let c=0;c<b.length;c+=2){const d=parseInt(b.substring(c,c+2),16);if(isNaN(d))throw Error("Invalid character in "+b);a.push(d)}this.initArray(a,"le"),this._sign=f,this.normSign();return}try{a=BigInt("0x"+g)}catch(a){throw Error("Invalid character in "+g)}this._initializeState(a,f),this.normSign()}else try{if(this._parseBaseString(g,d),this._sign=f,this.normSign(),"le"===e){const a=this._sign;this.initArray(this.toArray("be"),"le"),this._sign=a,this.normSign()}}catch(a){if(a.message.includes("Invalid character in string")||a.message.includes("Invalid digit for base")||a.message.startsWith("Invalid character:"))throw Error("Invalid character");throw a}}else 0!==a?this.assert(!1,"Unsupported input type for BigNumber constructor"):this._initializeState(0n,0)}_bigIntToStringInBase(a,b){if(0n===a)return"0";if(b<2||b>36)throw Error("Base must be between 2 and 36");let c="",d=a>0n?a:-a,e=BigInt(b);for(;d>0n;)c="0123456789abcdefghijklmnopqrstuvwxyz"[Number(d%e)]+c,d/=e;return c}_parseBaseString(a,b){if(0===a.length){this._magnitude=0n,this._finishInitialization();return}this._magnitude=0n;let d=BigInt(b),e=c.groupSizes[b],f=BigInt(c.groupBases[b]);(0===e||0n===f)&&(0===(e=Math.floor(Math.log(0x3ffffff)/Math.log(b)))&&(e=1),f=d**BigInt(e));let g=0,h=a.length,i=h%e;if(0===i&&h>0&&(i=e),i>0){let c=a.substring(g,g+i);this._magnitude=BigInt(this._parseBaseWord(c,b)),g+=i}for(;g<h;){let c=a.substring(g,g+e),d=BigInt(this._parseBaseWord(c,b));this._magnitude=this._magnitude*f+d,g+=e}this._finishInitialization()}_parseBaseWord(a,b){let c=0;for(let d=0;d<a.length;d++){let e,f=a.charCodeAt(d);if(f>=48&&f<=57)e=f-48;else if(f>=65&&f<=90)e=f-65+10;else if(f>=97&&f<=122)e=f-97+10;else throw Error("Invalid character: "+a[d]);if(e>=b)throw Error("Invalid character");c=c*b+e}return c}_initializeState(a,b){this._magnitude=a,this._sign=0n===a?0:b,this._finishInitialization()}_finishInitialization(){if(0n===this._magnitude)this._nominalWordLength=1,this._sign=0;else{let a=this._magnitude.toString(2).length;this._nominalWordLength=Math.max(1,Math.ceil(a/c.wordSize))}}assert(a,b="Assertion failed"){if(!a)throw Error(b)}initNumber(a,b="be"){if(this.assert(BigInt(Math.abs(a))<=c.MAX_NUMBER_CONSTRUCTOR_MAG_BIGINT,"The number is larger than 2 ^ 53 (unsafe)"),this.assert(a%1==0,"Number must be an integer for BigNumber conversion"),this._initializeState(BigInt(Math.abs(a)),+(a<0)),"le"===b){let a=this._sign,b=this.toArray("be");this.initArray(b,"le"),this._sign=a,this.normSign()}return this}initArray(a,b){if(0===a.length)return this._initializeState(0n,0),this;let c=0n;if("be"===b)for(let b=0;b<a.length;b++)c=c<<8n|BigInt(255&a[b]);else for(let b=a.length-1;b>=0;b--)c=c<<8n|BigInt(255&a[b]);return this._initializeState(c,0),this}copy(a){a._magnitude=this._magnitude,a._sign=this._sign,a._nominalWordLength=this._nominalWordLength,a.red=this.red}static move(a,b){a._magnitude=b._magnitude,a._sign=b._sign,a._nominalWordLength=b._nominalWordLength,a.red=b.red}clone(){let a=new c(0n);return this.copy(a),a}expand(a){return this.assert(a>=0,"Expand size must be non-negative"),this._nominalWordLength=Math.max(this._nominalWordLength,a,1),this}strip(){return this._finishInitialization(),this.normSign()}normSign(){return 0n===this._magnitude&&(this._sign=0),this}inspect(){return(null!==this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}_getMinimalHex(){return 0n===this._magnitude?"0":this._magnitude.toString(16)}toString(a=10,b=1){if(16===a||"hex"===a){let a=this._getMinimalHex();if(b>1)for("0"!==a&&a.length%2!=0&&(a="0"+a);a.length%b!=0;)a="0"+a;return(this.isNeg()?"-":"")+a}if("number"!=typeof a||a<2||a>36||a%1!=0)throw Error("Base should be an integer between 2 and 36");return this.toBaseString(a,b)}toBaseString(a,b){if(0n===this._magnitude){let a="0";if(b>1)for(;a.length<b;)a="0"+a;return a}let d=c.groupSizes[a],e=BigInt(c.groupBases[a]);(0===d||0n===e)&&(0===(d=Math.floor(Math.log(Number.MAX_SAFE_INTEGER)/Math.log(a)))&&(d=1),e=BigInt(a)**BigInt(d));let f="",g=this._magnitude;for(;g>0n;){let b=g%e;g/=e;let h=this._bigIntToStringInBase(b,a);if(g>0n){let a=d-h.length;f=a>0&&a<c.zeros.length?c.zeros[a]+h+f:a>0?"0".repeat(a)+h+f:h+f}else f=h+f}if(b>0)for(;f.length<b;)f="0"+f;return(1===this._sign?"-":"")+f}toNumber(){let a=this._getSignedValue();if(a>c.MAX_SAFE_INTEGER_BIGINT||a<c.MIN_SAFE_INTEGER_BIGINT)throw Error("Number can only safely store up to 53 bits");return Number(a)}toJSON(){let a=this._getMinimalHex();return(this.isNeg()?"-":"")+a}toArrayLikeGeneric(a,b){let c=this._magnitude,d=b?0:a.length-1,e=b?1:-1;for(let b=0;b<a.length;++b){if(0n===c&&d>=0&&d<a.length)a[d]=0;else if(d>=0&&d<a.length)a[d]=Number(255n&c);else break;c>>=8n,d+=e}}toArray(a="be",b){this.strip();let c=this.byteLength(),d=b??Math.max(1,c);this.assert(c<=d,"byte array longer than desired length"),this.assert(d>0,"Requested array length <= 0");let e=Array(d).fill(0);return 0n===this._magnitude&&d>0?e:0n===this._magnitude&&0===d?[]:(this.toArrayLikeGeneric(e,"le"===a),e)}bitLength(){return 0n===this._magnitude?0:this._magnitude.toString(2).length}static toBitArray(a){let b=a.bitLength();if(0===b)return[];let c=Array(b),d=a._magnitude;for(let a=0;a<b;a++)c[a]=+((d>>BigInt(a)&1n)!==0n);return c}toBitArray(){return c.toBitArray(this)}zeroBits(){if(0n===this._magnitude)return 0;let a=0,b=this._magnitude;for(;(1n&b)===0n&&0n!==b;)a++,b>>=1n;return a}byteLength(){return 0n===this._magnitude?0:Math.ceil(this.bitLength()/8)}_getSignedValue(){return 1===this._sign?-this._magnitude:this._magnitude}_setValueFromSigned(a){a<0n?(this._magnitude=-a,this._sign=1):(this._magnitude=a,this._sign=0),this._finishInitialization(),this.normSign()}toTwos(a){this.assert(a>=0);let b=BigInt(a),d=this._getSignedValue();1===this._sign&&0n!==this._magnitude&&(d=(1n<<b)+d),d&=(1n<<b)-1n;let e=new c(0n);return e._initializeState(d,0),e}fromTwos(a){this.assert(a>=0);let b=BigInt(a),d=this._magnitude;if(a>0&&(d>>b-1n&1n)!==0n&&0===this._sign){let a=new c(0n);return a._setValueFromSigned(d-(1n<<b)),a}return this.clone()}isNeg(){return 1===this._sign&&0n!==this._magnitude}neg(){return this.clone().ineg()}ineg(){return 0n!==this._magnitude&&(this._sign=+(1!==this._sign)),this}_iuop(a,b){let c=b(this._magnitude,a._magnitude),d=b===((a,b)=>a^b),e=this._nominalWordLength;return d&&(e=Math.max(this.length,a.length)),this._magnitude=c,this._finishInitialization(),d&&(this._nominalWordLength=Math.max(this._nominalWordLength,e)),this.strip()}iuor(a){return this._iuop(a,(a,b)=>a|b)}iuand(a){return this._iuop(a,(a,b)=>a&b)}iuxor(a){return this._iuop(a,(a,b)=>a^b)}_iop(a,b){return this.assert(0===this._sign&&0===a._sign),this._iuop(a,b)}ior(a){return this._iop(a,(a,b)=>a|b)}iand(a){return this._iop(a,(a,b)=>a&b)}ixor(a){return this._iop(a,(a,b)=>a^b)}_uop_new(a,b){return this.length>=a.length?this.clone()[b](a):a.clone()[b](this)}or(a){return this.assert(0===this._sign&&0===a._sign),this._uop_new(a,"iuor")}uor(a){return this._uop_new(a,"iuor")}and(a){return this.assert(0===this._sign&&0===a._sign),this._uop_new(a,"iuand")}uand(a){return this._uop_new(a,"iuand")}xor(a){return this.assert(0===this._sign&&0===a._sign),this._uop_new(a,"iuxor")}uxor(a){return this._uop_new(a,"iuxor")}inotn(a){this.assert("number"==typeof a&&a>=0);let b=BigInt(a);this._magnitude=~this._magnitude&(1n<<b)-1n;let d=0===a?1:Math.ceil(a/c.wordSize);return this._nominalWordLength=Math.max(1,d),this.strip(),this._nominalWordLength=Math.max(this._nominalWordLength,Math.max(1,d)),this}notn(a){return this.clone().inotn(a)}setn(a,b){this.assert("number"==typeof a&&a>=0);let d=BigInt(a);1===b||!0===b?this._magnitude|=1n<<d:this._magnitude&=~(1n<<d);let e=Math.floor(a/c.wordSize)+1;return this._nominalWordLength=Math.max(this._nominalWordLength,e),this._finishInitialization(),this.strip()}iadd(a){return this._setValueFromSigned(this._getSignedValue()+a._getSignedValue()),this}add(a){let b=new c(0n);return b._setValueFromSigned(this._getSignedValue()+a._getSignedValue()),b}isub(a){return this._setValueFromSigned(this._getSignedValue()-a._getSignedValue()),this}sub(a){let b=new c(0n);return b._setValueFromSigned(this._getSignedValue()-a._getSignedValue()),b}mul(a){let b=new c(0n);return b._magnitude=this._magnitude*a._magnitude,b._sign=0n===b._magnitude?0:this._sign^a._sign,b._nominalWordLength=this.length+a.length,b.red=null,b.normSign()}imul(a){return this._magnitude*=a._magnitude,this._sign=0n===this._magnitude?0:this._sign^a._sign,this._nominalWordLength=this.length+a.length,this.red=null,this.normSign()}imuln(a){return this.assert("number"==typeof a,"Assertion failed"),this.assert(Math.abs(a)<=c.MAX_IMULN_ARG,"Assertion failed"),this._setValueFromSigned(this._getSignedValue()*BigInt(a)),this}muln(a){return this.clone().imuln(a)}sqr(){let a=new c(0n);return a._magnitude=this._magnitude*this._magnitude,a._sign=0,a._nominalWordLength=2*this.length,a.red=null,a}isqr(){return this._magnitude*=this._magnitude,this._sign=0,this._nominalWordLength=2*this.length,this.red=null,this}pow(a){if(this.assert(0===a._sign,"Exponent for pow must be non-negative"),a.isZero())return new c(1n);let b=new c(1n),d=this.clone(),e=a.clone(),f=d.isNeg(),g=e.isOdd();for(f&&d.ineg();!e.isZero();)e.isOdd()&&b.imul(d),d.isqr(),e.iushrn(1);return f&&g&&b.ineg(),b}iushln(a){return(this.assert("number"==typeof a&&a>=0),0===a)?this:(this._magnitude<<=BigInt(a),this._finishInitialization(),this.strip())}ishln(a){return this.assert(0===this._sign,"ishln requires positive number"),this.iushln(a)}iushrn(a,b,c){if(this.assert("number"==typeof a&&a>=0),0===a)return null!=c&&c._initializeState(0n,0),this;if(null!=c){let b=(1n<<BigInt(a))-1n,d=this._magnitude&b;c._initializeState(d,0)}return this._magnitude>>=BigInt(a),this._finishInitialization(),this.strip()}ishrn(a,b,c){return this.assert(0===this._sign,"ishrn requires positive number"),this.iushrn(a,b,c)}shln(a){return this.clone().ishln(a)}ushln(a){return this.clone().iushln(a)}shrn(a){return this.clone().ishrn(a)}ushrn(a){return this.clone().iushrn(a)}testn(a){return this.assert("number"==typeof a&&a>=0),(this._magnitude>>BigInt(a)&1n)!==0n}imaskn(a){this.assert("number"==typeof a&&a>=0),this.assert(0===this._sign,"imaskn works only with positive numbers");let b=BigInt(a);this._magnitude&=0n===b?0n:(1n<<b)-1n;let d=0===a?1:Math.max(1,Math.ceil(a/c.wordSize));return this._nominalWordLength=d,this._finishInitialization(),this._nominalWordLength=Math.max(this._nominalWordLength,d),this.strip()}maskn(a){return this.clone().imaskn(a)}iaddn(a){return this.assert("number"==typeof a),this.assert(Math.abs(a)<=c.MAX_IMULN_ARG,"num is too large"),this._setValueFromSigned(this._getSignedValue()+BigInt(a)),this}_iaddn(a){return this.iaddn(a)}isubn(a){return this.assert("number"==typeof a),this.assert(Math.abs(a)<=c.MAX_IMULN_ARG,"Assertion failed"),this._setValueFromSigned(this._getSignedValue()-BigInt(a)),this}addn(a){return this.clone().iaddn(a)}subn(a){return this.clone().isubn(a)}iabs(){return this._sign=0,this}abs(){return this.clone().iabs()}divmod(a,b,d){if(this.assert(!a.isZero(),"Division by zero"),this.isZero()){let a=new c(0n);return{div:"mod"!==b?a:null,mod:"div"!==b?a:null}}let e=this._getSignedValue(),f=a._getSignedValue(),g=null,h=null;"mod"!==b&&(g=e/f),"div"!==b&&(h=e%f,!0===d&&h<0n&&(h+=f<0n?-f:f));let i=null!==g?new c(0n):null;null!==i&&null!==g&&i._setValueFromSigned(g);let j=null!==h?new c(0n):null;return null!==j&&null!==h&&j._setValueFromSigned(h),{div:i,mod:j}}div(a){return this.divmod(a,"div",!1).div}mod(a){return this.divmod(a,"mod",!1).mod}umod(a){return this.divmod(a,"mod",!0).mod}divRound(a){this.assert(!a.isZero());let b=this._getSignedValue(),d=a._getSignedValue(),e=b/d,f=b%d;if(0n===f){let a=new c(0n);return a._setValueFromSigned(e),a}2n*(f<0n?-f:f)>=(d<0n?-d:d)&&(b>0n&&d>0n||b<0n&&d<0n?e+=1n:e-=1n);let g=new c(0n);return g._setValueFromSigned(e),g}modrn(a){this.assert(0!==a,"Division by zero in modrn");let b=BigInt(Math.abs(a));if(0n===b)throw Error("Division by zero in modrn");let c=this._magnitude%b;return a<0?Number(-c):Number(c)}idivn(a){return this.assert(0!==a),this.assert(Math.abs(a)<=c.MAX_IMULN_ARG,"num is too large"),this._setValueFromSigned(this._getSignedValue()/BigInt(a)),this}divn(a){return this.clone().idivn(a)}egcd(a){this.assert(0===a._sign,"p must not be negative"),this.assert(!a.isZero(),"p must not be zero");let b=this._getSignedValue(),d=a._magnitude,e=1n,f=0n,g=0n,h=1n;for(;0n!==d;){let a=b/d,c=d;d=b%d,b=c,c=f,f=e-a*f,e=c,c=h,h=g-a*h,g=c}let i=new c(0n);i._setValueFromSigned(e);let j=new c(0n);j._setValueFromSigned(g);let k=new c(0n);return k._initializeState(b<0n?-b:b,0),{a:i,b:j,gcd:k}}gcd(a){let b=this._magnitude,d=a._magnitude;if(0n===b){let a=new c(0n);return a._setValueFromSigned(d),a.iabs()}if(0n===d){let a=new c(0n);return a._setValueFromSigned(b),a.iabs()}for(;0n!==d;){let a=b%d;b=d,d=a}let e=new c(0n);return e._initializeState(b,0),e}invm(a){this.assert(!a.isZero()&&0===a._sign,"Modulus for invm must be positive and non-zero");let b=this.egcd(a);if(!b.gcd.eqn(1))throw Error("Inverse does not exist (numbers are not coprime).");return b.a.umod(a)}isEven(){return this._magnitude%2n===0n}isOdd(){return this._magnitude%2n===1n}andln(a){return this.assert(a>=0),Number(this._magnitude&BigInt(a))}bincn(a){this.assert("number"==typeof a&&a>=0);let b=1n<<BigInt(a);return this._setValueFromSigned(this._getSignedValue()+b),this}isZero(){return 0n===this._magnitude}cmpn(a){this.assert(Math.abs(a)<=c.MAX_IMULN_ARG,"Number is too big");let b=this._getSignedValue(),d=BigInt(a);return b<d?-1:+(b>d)}cmp(a){let b=this._getSignedValue(),c=a._getSignedValue();return b<c?-1:+(b>c)}ucmp(a){return this._magnitude<a._magnitude?-1:+(this._magnitude>a._magnitude)}gtn(a){return 1===this.cmpn(a)}gt(a){return 1===this.cmp(a)}gten(a){return this.cmpn(a)>=0}gte(a){return this.cmp(a)>=0}ltn(a){return -1===this.cmpn(a)}lt(a){return -1===this.cmp(a)}lten(a){return 0>=this.cmpn(a)}lte(a){return 0>=this.cmp(a)}eqn(a){return 0===this.cmpn(a)}eq(a){return 0===this.cmp(a)}toRed(a){return this.assert(null==this.red,"Already a number in reduction context"),this.assert(0===this._sign,"toRed works only with positives"),a.convertTo(this).forceRed(a)}fromRed(){return this.assert(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)}forceRed(a){return this.red=a,this}redAdd(a){return this.assert(this.red,"redAdd works only with red numbers"),this.red.add(this,a)}redIAdd(a){return this.assert(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,a)}redSub(a){return this.assert(this.red,"redSub works only with red numbers"),this.red.sub(this,a)}redISub(a){return this.assert(this.red,"redISub works only with red numbers"),this.red.isub(this,a)}redShl(a){return this.assert(this.red,"redShl works only with red numbers"),this.red.shl(this,a)}redMul(a){return this.assert(this.red,"redMul works only with red numbers"),this.red.verify2(this,a),this.red.mul(this,a)}redIMul(a){return this.assert(this.red,"redIMul works only with red numbers"),this.red.verify2(this,a),this.red.imul(this,a)}redSqr(){return this.assert(this.red,"redSqr works only with red numbers"),this.red.verify1(this),this.red.sqr(this)}redISqr(){return this.assert(this.red,"redISqr works only with red numbers"),this.red.verify1(this),this.red.isqr(this)}redSqrt(){return this.assert(this.red,"redSqrt works only with red numbers"),this.red.verify1(this),this.red.sqrt(this)}redInvm(){return this.assert(this.red,"redInvm works only with red numbers"),this.red.verify1(this),this.red.invm(this)}redNeg(){return this.assert(this.red,"redNeg works only with red numbers"),this.red.verify1(this),this.red.neg(this)}redPow(a){return this.assert(null!=this.red&&null==a.red,"redPow(normalNum)"),this.red.verify1(this),this.red.pow(this,a)}static fromHex(a,b){let d="be";return("little"===b||"le"===b)&&(d="le"),new c(a,16,d)}toHex(a=0){if(this.isZero()&&0===a)return"";let b=this._getMinimalHex();"0"!==b&&b.length%2!=0&&(b="0"+b);let c=2*a;for(;b.length<c;)b="0"+b;return(this.isNeg()?"-":"")+b}static fromJSON(a){return new c(a,16)}static fromNumber(a){return new c(a)}static fromString(a,b){return new c(a,b)}static fromSm(a,b="big"){if(0===a.length)return new c(0n);let d=0,e="";if("little"===b){let b=a.length-1,c=a[b];(128&c)!=0&&(d=1,c&=127),e+=(c<16?"0":"")+c.toString(16);for(let c=b-1;c>=0;c--){let b=a[c];e+=(b<16?"0":"")+b.toString(16)}}else{let b=a[0];(128&b)!=0&&(d=1,b&=127),e+=(b<16?"0":"")+b.toString(16);for(let b=1;b<a.length;b++){let c=a[b];e+=(c<16?"0":"")+c.toString(16)}}let f=""===e?0n:BigInt("0x"+e),g=new c(0n);return g._initializeState(f,d),g}toSm(a="big"){if(0n===this._magnitude)return 1===this._sign?[128]:[];let b=this._getMinimalHex();b.length%2!=0&&(b="0"+b);let c=Array(b.length/2);for(let a=0,d=0;a<b.length;a+=2)c[d++]=parseInt(b.slice(a,a+2),16);return 1===this._sign?(128&c[0])!=0?c.unshift(128):c[0]|=128:(128&c[0])!=0&&c.unshift(0),"little"===a?c.reverse():c}static fromBits(a,b=!1){let d=a>>>24,e=8388607&a,f=(8388608&a)!=0;if(b&&f)throw Error("negative bit set");if(0===d&&0===e){if(f&&b)throw Error("negative bit set for zero value");return new c(0n)}let g=new c(e);return d<=3?g.iushrn((3-d)*8):g.iushln((d-3)*8),f&&g.ineg(),g}toBits(){let a;if(this.strip(),this.isZero()&&!this.isNeg())return 0;let b=this.isNeg(),c=this.abs(),d=c.toArray("be"),e=0;for(;e<d.length-1&&0===d[e];)e++;let f=(d=d.slice(e)).length;if(0!==f||c.isZero()||(d=[0],f=1),c.isZero()&&(f=0,d=[]),0===f)a=0;else if(f<=3){a=0;for(let b=0;b<f;b++)a=a<<8|d[b]}else a=d[0]<<16|d[1]<<8|d[2];(8388608&a)!=0&&f<=255&&(a>>>=8,f++);let g=f<<24|a;return b&&(g|=8388608),g>>>0}static fromScriptNum(a,b=!1,d){if(void 0!==d&&a.length>d)throw Error("script number overflow");if(0===a.length)return new c(0n);if(b&&(127&a[a.length-1])==0&&(a.length<=1||(128&a[a.length-2])==0))throw Error("non-minimally encoded script number");return c.fromSm(a,"little")}toScriptNum(){return this.toSm("little")}_invmp(a){let b;this.assert(0===a._sign,"p must not be negative for _invmp"),this.assert(!a.isZero(),"p must not be zero for _invmp");let d=this.umod(a)._magnitude,e=a._magnitude,f=1n,g=0n,h=a._magnitude;for(;d>1n&&e>1n;){let a=0;for(;(d>>BigInt(a)&1n)===0n;)a++;if(a>0){d>>=BigInt(a);for(let b=0;b<a;++b)(1n&f)!==0n&&(f+=h),f>>=1n}let b=0;for(;(e>>BigInt(b)&1n)===0n;)b++;if(b>0){e>>=BigInt(b);for(let a=0;a<b;++a)(1n&g)!==0n&&(g+=h),g>>=1n}d>=e?(d-=e,f-=g):(e-=d,g-=f)}if(1n===d)b=f;else if(1n===e)b=g;else if(0n===d&&1n===e)b=g;else if(0n===e&&1n===d)b=f;else throw Error("_invmp: GCD is not 1, inverse does not exist. aVal="+d+", bVal="+e);(b%=h)<0n&&(b+=h);let i=new c(0n);return i._initializeState(b,0),i}mulTo(a,b){return b._magnitude=this._magnitude*a._magnitude,b._sign=0n===b._magnitude?0:this._sign^a._sign,b._nominalWordLength=this.length+a.length,b.red=null,b.normSign(),b}}a.s(["default",()=>c],89058),a.s(["default",()=>ab],27872);class d{name;p;k;n;tmp;constructor(a,b){this.name=a,this.p=new c(b,16),this.n=this.p.bitLength(),this.k=new c(BigInt(1)).iushln(this.n).isub(this.p),this.tmp=this._tmp()}_tmp(){let a=new c(BigInt(0)),b=Math.ceil(this.n/c.wordSize);return a.expand(Math.max(1,b)),a}ireduce(a){let b;do this.split(a,this.tmp),this.imulK(a),a.iadd(this.tmp),b=a.bitLength();while(b>this.n)let c=b<this.n?-1:a.ucmp(this.p);return 0===c?a.words=[0]:c>0&&a.isub(this.p),a.strip(),a}split(a,b){a.iushrn(this.n,0,b)}imulK(a){return a.imul(this.k)}}class e extends d{constructor(){super("k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}split(a,b){let c=a.words,d=a.length,e=Math.min(d,9),f=Array(e+ +(d>9)).fill(0);for(let a=0;a<e;a++)f[a]=c[a];let g=e;if(d<=9){let c=Array(g);for(let a=0;a<g;++a)c[a]=f[a];b.words=c,a.words=[0];return}let h=c[9];f[g++]=4194303&h;let i=Array(g);for(let a=0;a<g;++a)i[a]=f[a];b.words=i;let j=Array(Math.max(1,d-9)).fill(0),k=0;for(let a=10;a<d;a++){let b=0|c[a];k<j.length&&(j[k++]=(4194303&b)<<4|h>>>22),h=b}h>>>=22,k<j.length?j[k++]=h:0!==h&&j.length;let l=Array(k);for(let a=0;a<k;++a)l[a]=j[a];a.words=l}imulK(a){let b=a.words,c=a.length,d=c+2,e=Array(d).fill(0);for(let a=0;a<c;a++)e[a]=b[a];let f=0;for(let a=0;a<d;a++){let b=0|e[a];f+=977*b,e[a]=0x3ffffff&f,f=64*b+(f/0x4000000|0)}return a.words=e,a}}class f{prime;m;constructor(a){if("k256"===a){const a=new e;this.m=a.p,this.prime=a}else this.assert(a.gtn(1),"modulus must be greater than 1"),this.m=a,this.prime=null}assert(a,b="Assertion failed"){if(!a)throw Error(b)}verify1(a){this.assert(0===a.negative,"red works only with positives"),this.assert(a.red,"red works only with red numbers")}verify2(a,b){this.assert((a.negative|b.negative)==0,"red works only with positives"),this.assert(null!=a.red&&a.red===b.red,"red works only with red numbers")}imod(a){return null!=this.prime?this.prime.ireduce(a).forceRed(this):(c.move(a,a.umod(this.m).forceRed(this)),a)}neg(a){return a.isZero()?a.clone():this.m.sub(a).forceRed(this)}add(a,b){this.verify2(a,b);let c=a.add(b);return c.cmp(this.m)>=0&&c.isub(this.m),c.forceRed(this)}iadd(a,b){this.verify2(a,b);let c=a.iadd(b);return c.cmp(this.m)>=0&&c.isub(this.m),c}sub(a,b){this.verify2(a,b);let c=a.sub(b);return 0>c.cmpn(0)&&c.iadd(this.m),c.forceRed(this)}isub(a,b){this.verify2(a,b);let c=a.isub(b);return 0>c.cmpn(0)&&c.iadd(this.m),c}shl(a,b){return this.verify1(a),this.imod(a.ushln(b))}imul(a,b){return this.verify2(a,b),this.imod(a.imul(b))}mul(a,b){return this.verify2(a,b),this.imod(a.mul(b))}isqr(a){return this.imul(a,a.clone())}sqr(a){return this.mul(a,a)}sqrt(a){if(a.isZero())return a.clone();let b=this.m.andln(3);if(this.assert(b%2==1),3===b){let b=this.m.add(new c(1)).iushrn(2);return this.pow(a,b)}let d=this.m.subn(1),e=0;for(;!d.isZero()&&0===d.andln(1);)e++,d.iushrn(1);this.assert(!d.isZero());let f=new c(1).toRed(this),g=f.redNeg(),h=this.m.subn(1).iushrn(1),i=this.m.bitLength(),j=new c(2*i*i).toRed(this);for(;0!==this.pow(j,h).cmp(g);)j.redIAdd(g);let k=this.pow(j,d),l=this.pow(a,d.addn(1).iushrn(1)),m=this.pow(a,d),n=e;for(;0!==m.cmp(f);){let a=m,b=0;for(;0!==a.cmp(f);b++)a=a.redSqr();this.assert(b<n);let d=this.pow(k,new c(1).iushln(n-b-1));l=l.redMul(d),k=d.redSqr(),m=m.redMul(k),n=b}return l}invm(a){let b=a._invmp(this.m);return 0!==b.negative?(b.negative=0,this.imod(b).redNeg()):this.imod(b)}pow(a,b){if(b.isZero())return new c(1).toRed(this);if(0===b.cmpn(1))return a.clone();let d=Array(16);d[0]=new c(1).toRed(this),d[1]=a;let e=2;for(;e<d.length;e++)d[e]=this.mul(d[e-1],a);let f=d[0],g=0,h=0,i=b.bitLength()%26;for(0===i&&(i=26),e=b.length-1;e>=0;e--){let a=b.words[e];for(let b=i-1;b>=0;b--){let c=a>>b&1;if(f!==d[0]&&(f=this.sqr(f)),0===c&&0===g){h=0;continue}g<<=1,g|=c,(4==++h||0===e&&0===b)&&(f=this.mul(f,d[g]),h=0,g=0)}i=26}return f}convertTo(a){let b=a.umod(this.m);return b===a?b.clone():b}convertFrom(a){let b=a.clone();return b.red=null,b}}class g extends f{shift;r;r2;rinv;minv;constructor(a){super(a),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new c(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}convertTo(a){return this.imod(a.ushln(this.shift))}convertFrom(a){let b=this.imod(a.mul(this.rinv));return b.red=null,b}imul(a,b){if(a.isZero()||b.isZero())return a.words[0]=0,a.length=1,a;let c=a.imul(b),d=c.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),e=c.isub(d).iushrn(this.shift),f=e;return e.cmp(this.m)>=0?f=e.isub(this.m):0>e.cmpn(0)&&(f=e.iadd(this.m)),f.forceRed(this)}mul(a,b){if(a.isZero()||b.isZero())return new c(0).forceRed(this);let d=a.mul(b),e=d.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),f=d.isub(e).iushrn(this.shift),g=f;return f.cmp(this.m)>=0?g=f.isub(this.m):0>f.cmpn(0)&&(g=f.iadd(this.m)),g.forceRed(this)}invm(a){return this.imod(a._invmp(this.m).mul(this.r2)).forceRed(this)}}a.s(["default",()=>aa],81719);class h{curve;type;precomputed;constructor(a){this.curve=new ab,this.type=a,this.precomputed=null}}class i extends h{x;y;z;zOne;constructor(a,b,d){super("jacobian"),null===a&&null===b&&null===d?(this.x=this.curve.one,this.y=this.curve.one,this.z=new c(0)):(c.isBN(a)||(a=new c(a,16)),this.x=a,c.isBN(b)||(b=new c(b,16)),this.y=b,c.isBN(d)||(d=new c(d,16)),this.z=d),null==this.x.red&&(this.x=this.x.toRed(this.curve.red)),null==this.y.red&&(this.y=this.y.toRed(this.curve.red)),null==this.z.red&&(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}toP(){if(this.isInfinity())return new aa(null,null);let a=this.z.redInvm(),b=a.redSqr();return new aa(this.x.redMul(b),this.y.redMul(b).redMul(a))}neg(){return new i(this.x,this.y.redNeg(),this.z)}add(a){if(this.isInfinity())return a;if(a.isInfinity())return this;let b=a.z.redSqr(),c=this.z.redSqr(),d=this.x.redMul(b),e=a.x.redMul(c),f=this.y.redMul(b.redMul(a.z)),g=a.y.redMul(c.redMul(this.z)),h=d.redSub(e),j=f.redSub(g);if(0===h.cmpn(0))if(0!==j.cmpn(0))return new i(null,null,null);else return this.dbl();let k=h.redSqr(),l=k.redMul(h),m=d.redMul(k),n=j.redSqr().redIAdd(l).redISub(m).redISub(m),o=j.redMul(m.redISub(n)).redISub(f.redMul(l));return new i(n,o,this.z.redMul(a.z).redMul(h))}mixedAdd(a){if(this.isInfinity())return a.toJ();if(a.isInfinity())return this;if(null===a.x||null===a.y)throw Error("Point coordinates cannot be null");let b=this.z.redSqr(),c=this.x,d=a.x.redMul(b),e=this.y,f=a.y.redMul(b).redMul(this.z),g=c.redSub(d),h=e.redSub(f);if(0===g.cmpn(0))if(0!==h.cmpn(0))return new i(null,null,null);else return this.dbl();let j=g.redSqr(),k=j.redMul(g),l=c.redMul(j),m=h.redSqr().redIAdd(k).redISub(l).redISub(l),n=h.redMul(l.redISub(m)).redISub(e.redMul(k));return new i(m,n,this.z.redMul(g))}dblp(a){if(0===a||this.isInfinity())return this;if(void 0===a)return this.dbl();let b=this;for(let c=0;c<a;c++)b=b.dbl();return b}dbl(){let a,b,c;if(this.isInfinity())return this;if(this.zOne){let d=this.x.redSqr(),e=this.y.redSqr(),f=e.redSqr(),g=this.x.redAdd(e).redSqr().redISub(d).redISub(f);g=g.redIAdd(g);let h=d.redAdd(d).redIAdd(d),i=h.redSqr().redISub(g).redISub(g),j=f.redIAdd(f);j=(j=j.redIAdd(j)).redIAdd(j),a=i,b=h.redMul(g.redISub(i)).redISub(j),c=this.y.redAdd(this.y)}else{let d=this.x.redSqr(),e=this.y.redSqr(),f=e.redSqr(),g=this.x.redAdd(e).redSqr().redISub(d).redISub(f);g=g.redIAdd(g);let h=d.redAdd(d).redIAdd(d),i=h.redSqr(),j=f.redIAdd(f);j=(j=j.redIAdd(j)).redIAdd(j),a=i.redISub(g).redISub(g),b=h.redMul(g.redISub(a)).redISub(j),c=(c=this.y.redMul(this.z)).redIAdd(c)}return new i(a,b,c)}eq(a){if("affine"===a.type)return this.eq(a.toJ());if(this===a)return!0;let b=this.z.redSqr(),c=a.z.redSqr();if(0!==this.x.redMul(c).redISub(a.x.redMul(b)).cmpn(0))return!1;let d=b.redMul(this.z),e=c.redMul(a.z);return 0===this.y.redMul(e).redISub(a.y.redMul(d)).cmpn(0)}eqXToP(a){let b=this.z.redSqr(),c=a.toRed(this.curve?.red).redMul(b);if(0===this.x.cmp(c))return!0;let d=a.clone();if(null===this.curve||null==this.curve.redN)throw Error("Curve or redN is not initialized.");let e=this.curve.redN.redMul(b);for(;0>d.cmp(this.curve.p)&&(d.iadd(this.curve.n),!(d.cmp(this.curve.p)>=0));)if(c.redIAdd(e),0===this.x.cmp(c))return!0;return!1}inspect(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"}isInfinity(){return 0===this.z.cmpn(0)}}let j=(a,b="Hash assertion failed")=>{if(!a)throw Error(b)};class k{pending;pendingTotal;blockSize;outSize;endian;_delta8;_delta32;padLength;hmacStrength;constructor(a,b,c,d){this.pending=null,this.pendingTotal=0,this.blockSize=a,this.outSize=b,this.hmacStrength=c,this.padLength=d/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}_update(a,b){throw Error("Not implemented")}_digest(){throw Error("Not implemented")}_digestHex(){throw Error("Not implemented")}update(a,b){if(a=l(a,b),null==this.pending?this.pending=a:this.pending=this.pending.concat(a),this.pendingTotal+=a.length,this.pending.length>=this._delta8){let b=(a=this.pending).length%this._delta8;this.pending=a.slice(a.length-b,a.length),0===this.pending.length&&(this.pending=null),a=function(a,b,c,d){let e=c-0;j(e%4==0);let f=Array(e/4);for(let b=0,c=0;b<f.length;b++,c+=4){let e;e="big"===d?a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3]:a[c+3]<<24|a[c+2]<<16|a[c+1]<<8|a[c],f[b]=e>>>0}return f}(a,0,a.length-b,this.endian);for(let b=0;b<a.length;b+=this._delta32)this._update(a,b)}return this}digest(){return this.update(this._pad()),j(null===this.pending),this._digest()}digestHex(){return this.update(this._pad()),j(null===this.pending),this._digestHex()}_pad(){let a,b,c=this.pendingTotal,d=this._delta8,e=d-(c+this.padLength)%d,f=Array(e+this.padLength);for(a=1,f[0]=128;a<e;a++)f[a]=0;if(c<<=3,"big"===this.endian){for(b=8;b<this.padLength;b++)f[a++]=0;f[a++]=0,f[a++]=0,f[a++]=0,f[a++]=0,f[a++]=c>>>24&255,f[a++]=c>>>16&255,f[a++]=c>>>8&255,f[a++]=255&c}else for(b=8,f[a++]=255&c,f[a++]=c>>>8&255,f[a++]=c>>>16&255,f[a++]=c>>>24&255,f[a++]=0,f[a++]=0,f[a++]=0,f[a++]=0;b<this.padLength;b++)f[a++]=0;return f}}function l(a,b){if(Array.isArray(a))return a.slice();if(!a)return[];let c=[];if("string"==typeof a)if("hex"!==b){let b=0;for(let f=0;f<a.length;f++){let g=a.charCodeAt(f);if(g<128)c[b++]=g;else if(g<2048)c[b++]=g>>6|192,c[b++]=63&g|128;else{var d,e;(d=a,e=f,(64512&d.charCodeAt(e))!=55296||e<0||e+1>=d.length?1:(64512&d.charCodeAt(e+1))!=56320)?c[b++]=g>>12|224:(g=65536+((1023&g)<<10)+(1023&a.charCodeAt(++f)),c[b++]=g>>18|240,c[b++]=g>>12&63|128),c[b++]=g>>6&63|128,c[b++]=63&g|128}}}else{(a=a.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(a="0"+a);for(let b=0;b<a.length;b+=2)c.push(parseInt(a[b]+a[b+1],16))}else for(let b=0;b<a.length;b++)c[b]=0|a[b];return c}function m(a,b){let c="";for(let e=0;e<a.length;e++){var d;let f=a[e];"little"===b&&(f=((d=f)>>>24|d>>>8&65280|d<<8&0xff0000|(255&d)<<24)>>>0),c+=function(a){if(7===a.length)return"0"+a;if(6===a.length)return"00"+a;if(5===a.length)return"000"+a;if(4===a.length)return"0000"+a;if(3===a.length)return"00000"+a;else if(2===a.length)return"000000"+a;else if(1===a.length)return"0000000"+a;else return a}(f.toString(16))}return c}function n(a,b){let c=Array(4*a.length);for(let d=0,e=0;d<a.length;d++,e+=4){let f=a[d];"big"===b?(c[e]=f>>>24,c[e+1]=f>>>16&255,c[e+2]=f>>>8&255,c[e+3]=255&f):(c[e+3]=f>>>24,c[e+2]=f>>>16&255,c[e+1]=f>>>8&255,c[e]=255&f)}return c}function o(a,b){return a>>>b|a<<32-b}function p(a,b){return a<<b|a>>>32-b}function q(a,b){return a+b>>>0}let r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],s=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],t=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],u=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function v(a,b,c,d){return a<=15?b^c^d:a<=31?b&c|~b&d:a<=47?(b|~c)^d:a<=63?b&d|c&~d:b^(c|~d)}function w(a,b,c,d){let e=a[b],f=d+a[b+1]>>>0;a[b]=+(f<d)+c+e>>>0,a[b+1]=f}function x(a,b,c,d){return+(b+d>>>0<b)+a+c>>>0}function y(a,b,c){return(b<<32-c|a>>>c)>>>0}function z(a,b,c){return(a<<32-c|b>>>c)>>>0}function A(a,b,c){return(a<<32-c|b>>>c)>>>0}class B extends k{h;constructor(){super(512,160,192,64),this.endian="little",this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0],this.endian="little"}_update(a,b){var c,d,e,f,g,h;let i,j=this.h[0],k=this.h[1],l=this.h[2],m=this.h[3],n=this.h[4],o=j,w=k,x=l,y=m,z=n;for(let A=0;A<80;A++){i=q(p((c=j,d=v(A,k,l,m),c+d+a[r[A]+b]+((g=A)<=15?0:g<=31?0x5a827999:g<=47?0x6ed9eba1:g<=63?0x8f1bbcdc:0xa953fd4e)>>>0),t[A]),n),j=n,n=m,m=p(l,10),l=k,k=i,i=q(p((e=o,f=v(79-A,w,x,y),e+f+a[s[A]+b]+((h=A)<=15?0x50a28be6:h<=31?0x5c4dd124:h<=47?0x6d703ef3:0x7a6d76e9*!!(h<=63))>>>0),u[A]),z),o=z,z=y,y=p(x,10),x=w,w=i}i=this.h[1]+l+y>>>0,this.h[1]=this.h[2]+m+z>>>0,this.h[2]=this.h[3]+n+o>>>0,this.h[3]=this.h[4]+j+w>>>0,this.h[4]=this.h[0]+k+x>>>0,this.h[0]=i}_digest(){return n(this.h,"little")}_digestHex(){return m(this.h,"little")}}class C extends k{h;W;k;constructor(){super(512,256,192,64),this.h=[0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19],this.k=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],this.W=Array(64)}_update(a,b){var c,d,e,f,g,h,i,k,l,m,n,p,r;let s,t=this.W;for(void 0===b&&(b=0),s=0;s<16;s++)t[s]=a[b+s];for(;s<t.length;s++)t[s]=(e=o(c=t[s-2],17)^o(c,19)^c>>>10,f=t[s-7],e+f+(o(d=t[s-15],7)^o(d,18)^d>>>3)+t[s-16]>>>0);let u=this.h[0],v=this.h[1],w=this.h[2],x=this.h[3],y=this.h[4],z=this.h[5],A=this.h[6],B=this.h[7];for(j(this.k.length===t.length),s=0;s<t.length;s++){let a=(i=B,k=o(g=y,6)^o(g,11)^o(g,25),l=(h=y)&z^~h&A,i+k+l+this.k[s]+t[s]>>>0),b=q(o(m=u,2)^o(m,13)^o(m,22),(n=u)&(p=v)^n&(r=w)^p&r);B=A,A=z,z=y,y=q(x,a),x=w,w=v,v=u,u=q(a,b)}this.h[0]=q(this.h[0],u),this.h[1]=q(this.h[1],v),this.h[2]=q(this.h[2],w),this.h[3]=q(this.h[3],x),this.h[4]=q(this.h[4],y),this.h[5]=q(this.h[5],z),this.h[6]=q(this.h[6],A),this.h[7]=q(this.h[7],B)}_digest(){return n(this.h,"big")}_digestHex(){return m(this.h,"big")}}class D extends k{h;W;k;constructor(){super(512,160,80,64),this.k=[0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xca62c1d6],this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0],this.W=Array(80)}_update(a,b){let c,d=this.W;for(void 0===b&&(b=0),c=0;c<16;c++)d[c]=a[b+c];for(;c<d.length;c++)d[c]=p(d[c-3]^d[c-8]^d[c-14]^d[c-16],1);let e=this.h[0],f=this.h[1],g=this.h[2],h=this.h[3],i=this.h[4];for(c=0;c<d.length;c++){var j,k,l,m,n,o,r,s,t;let a=~~(c/20),b=(m=p(e,5),j=f,k=g,l=h,n=0===a?(o=j)&k^~o&l:1===a||3===a?j^k^l:2===a?(r=j)&(s=k)^r&(t=l)^s&t:void 0,m+n+i+d[c]+this.k[a]>>>0);i=h,h=g,g=p(f,30),f=e,e=b}this.h[0]=q(this.h[0],e),this.h[1]=q(this.h[1],f),this.h[2]=q(this.h[2],g),this.h[3]=q(this.h[3],h),this.h[4]=q(this.h[4],i)}_digest(){return n(this.h,"big")}_digestHex(){return m(this.h,"big")}}class E extends k{h;W;k;constructor(){super(1024,512,192,128),this.h=[0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179],this.k=[0x428a2f98,0xd728ae22,0x71374491,0x23ef65cd,0xb5c0fbcf,0xec4d3b2f,0xe9b5dba5,0x8189dbbc,0x3956c25b,0xf348b538,0x59f111f1,0xb605d019,0x923f82a4,0xaf194f9b,0xab1c5ed5,0xda6d8118,0xd807aa98,0xa3030242,0x12835b01,0x45706fbe,0x243185be,0x4ee4b28c,0x550c7dc3,0xd5ffb4e2,0x72be5d74,0xf27b896f,0x80deb1fe,0x3b1696b1,0x9bdc06a7,0x25c71235,0xc19bf174,0xcf692694,0xe49b69c1,0x9ef14ad2,0xefbe4786,0x384f25e3,0xfc19dc6,0x8b8cd5b5,0x240ca1cc,0x77ac9c65,0x2de92c6f,0x592b0275,0x4a7484aa,0x6ea6e483,0x5cb0a9dc,0xbd41fbd4,0x76f988da,0x831153b5,0x983e5152,0xee66dfab,0xa831c66d,0x2db43210,0xb00327c8,0x98fb213f,0xbf597fc7,0xbeef0ee4,0xc6e00bf3,0x3da88fc2,0xd5a79147,0x930aa725,0x6ca6351,0xe003826f,0x14292967,0xa0e6e70,0x27b70a85,0x46d22ffc,0x2e1b2138,0x5c26c926,0x4d2c6dfc,0x5ac42aed,0x53380d13,0x9d95b3df,0x650a7354,0x8baf63de,0x766a0abb,0x3c77b2a8,0x81c2c92e,0x47edaee6,0x92722c85,0x1482353b,0xa2bfe8a1,0x4cf10364,0xa81a664b,0xbc423001,0xc24b8b70,0xd0f89791,0xc76c51a3,0x654be30,0xd192e819,0xd6ef5218,0xd6990624,0x5565a910,0xf40e3585,0x5771202a,0x106aa070,0x32bbd1b8,0x19a4c116,0xb8d2d0c8,0x1e376c08,0x5141ab53,0x2748774c,0xdf8eeb99,0x34b0bcb5,0xe19b48a8,0x391c0cb3,0xc5c95a63,0x4ed8aa4a,0xe3418acb,0x5b9cca4f,0x7763e373,0x682e6ff3,0xd6b2b8a3,0x748f82ee,0x5defb2fc,0x78a5636f,0x43172f60,0x84c87814,0xa1f0ab72,0x8cc70208,0x1a6439ec,0x90befffa,0x23631e28,0xa4506ceb,0xde82bde9,0xbef9a3f7,0xb2c67915,0xc67178f2,0xe372532b,0xca273ece,0xea26619c,0xd186b8c7,0x21c0c207,0xeada7dd6,0xcde0eb1e,0xf57d4f7f,0xee6ed178,0x6f067aa,0x72176fba,0xa637dc5,0xa2c898a6,0x113f9804,0xbef90dae,0x1b710b35,0x131c471b,0x28db77f5,0x23047d84,0x32caab7b,0x40c72493,0x3c9ebe0a,0x15c9bebc,0x431d67c4,0x9c100d4c,0x4cc5d4be,0xcb3e42b6,0x597f299c,0xfc657e2a,0x5fcb6fab,0x3ad6faec,0x6c44198c,0x4a475817],this.W=Array(160)}_prepareBlock(a,b){let c,d=this.W;for(c=0;c<32;c++)d[c]=a[b+c];for(;c<d.length;c+=2){let a=function(a,b){let c=y(a,b,19)^y(b,a,29)^a>>>6;return c<0&&(c+=0x100000000),c}(d[c-4],d[c-3]),b=function(a,b){let c=z(a,b,19)^z(b,a,29)^A(a,b,6);return c<0&&(c+=0x100000000),c}(d[c-4],d[c-3]),e=d[c-14],f=d[c-13],g=function(a,b){let c=y(a,b,1)^y(a,b,8)^a>>>7;return c<0&&(c+=0x100000000),c}(d[c-30],d[c-29]),h=function(a,b){let c=z(a,b,1)^z(a,b,8)^A(a,b,7);return c<0&&(c+=0x100000000),c}(d[c-30],d[c-29]),i=d[c-32],j=d[c-31];d[c]=function(a,b,c,d,e,f,g,h){let i,j=b;return a+c+e+g+(i=0+ +((j=j+d>>>0)<b)+ +((j=j+f>>>0)<f)+ +((j=j+h>>>0)<h))>>>0}(a,b,e,f,g,h,i,j),d[c+1]=b+f+h+j>>>0}}_update(a,b){this._prepareBlock(a,b);let c=this.W,d=this.h[0],e=this.h[1],f=this.h[2],g=this.h[3],h=this.h[4],i=this.h[5],k=this.h[6],l=this.h[7],m=this.h[8],n=this.h[9],o=this.h[10],p=this.h[11],q=this.h[12],r=this.h[13],s=this.h[14],t=this.h[15];j(this.k.length===c.length);for(let a=0;a<c.length;a+=2){let b=s,j=t,u=function(a,b){let c=y(a,b,14)^y(a,b,18)^y(b,a,9);return c<0&&(c+=0x100000000),c}(m,n),v=function(a,b){let c=z(a,b,14)^z(a,b,18)^z(b,a,9);return c<0&&(c+=0x100000000),c}(m,n),w=function(a,b,c,d,e,f){let g=a&c^~a&e;return g<0&&(g+=0x100000000),g}(m,0,o,0,q,0),A=function(a,b,c,d,e,f){let g=b&d^~b&f;return g<0&&(g+=0x100000000),g}(0,n,0,p,0,r),B=this.k[a],C=this.k[a+1],D=c[a],E=c[a+1],F=function(a,b,c,d,e,f,g,h,i,j){let k,l=b;return a+c+e+g+i+(k=0+ +((l=l+d>>>0)<b)+ +((l=l+f>>>0)<f)+ +((l=l+h>>>0)<h)+ +((l=l+j>>>0)<j))>>>0}(b,j,u,v,w,A,B,C,D,E),G=j+v+A+C+E>>>0;b=function(a,b){let c=y(a,b,28)^y(b,a,2)^y(b,a,7);return c<0&&(c+=0x100000000),c}(d,e),j=function(a,b){let c=z(a,b,28)^z(b,a,2)^z(b,a,7);return c<0&&(c+=0x100000000),c}(d,e);let H=x(b,j,u=function(a,b,c,d,e,f){let g=a&c^a&e^c&e;return g<0&&(g+=0x100000000),g}(d,0,f,0,h,0),v=function(a,b,c,d,e,f){let g=b&d^b&f^d&f;return g<0&&(g+=0x100000000),g}(0,e,0,g,0,i)),I=j+v>>>0;s=q,t=r,q=o,r=p,o=m,p=n,m=x(k,l,F,G),n=l+G>>>0,k=h,l=i,h=f,i=g,f=d,g=e,d=x(F,G,H,I),e=G+I>>>0}w(this.h,0,d,e),w(this.h,2,f,g),w(this.h,4,h,i),w(this.h,6,k,l),w(this.h,8,m,n),w(this.h,10,o,p),w(this.h,12,q,r),w(this.h,14,s,t)}_digest(){return n(this.h,"big")}_digestHex(){return m(this.h,"big")}}class F{inner;outer;blockSize=64;outSize=32;constructor(a){let b;for((a=l(a,"hex")).length>this.blockSize&&(a=new C().update(a).digest()),j(a.length<=this.blockSize),b=a.length;b<this.blockSize;b++)a.push(0);for(b=0;b<a.length;b++)a[b]^=54;for(b=0,this.inner=new C().update(a);b<a.length;b++)a[b]^=106;this.outer=new C().update(a)}update(a,b){return this.inner.update(a,b),this}digest(){return this.outer.update(this.inner.digest()),this.outer.digest()}digestHex(){return this.outer.update(this.inner.digest()),this.outer.digestHex()}}class G{inner;outer;blockSize=64;constructor(a){let b;for((a=l(a,"hex")).length>this.blockSize&&(a=new D().update(a).digest()),b=a.length;b<this.blockSize;b++)a.push(0);for(b=0;b<a.length;b++)a[b]^=54;for(b=0,this.inner=new D().update(a);b<a.length;b++)a[b]^=106;this.outer=new D().update(a)}update(a,b){return this.inner.update(a,b),this}digest(){return this.outer.update(this.inner.digest()),this.outer.digest()}digestHex(){return this.outer.update(this.inner.digest()),this.outer.digestHex()}}class H{inner;outer;blockSize=128;outSize=32;constructor(a){let b;for((a=l(a,"hex")).length>this.blockSize&&(a=new E().update(a).digest()),j(a.length<=this.blockSize),b=a.length;b<this.blockSize;b++)a.push(0);for(b=0;b<a.length;b++)a[b]^=54;for(b=0,this.inner=new E().update(a);b<a.length;b++)a[b]^=106;this.outer=new E().update(a)}update(a,b){return this.inner.update(a,b),this}digest(){return this.outer.update(this.inner.digest()),this.outer.digest()}digestHex(){return this.outer.update(this.inner.digest()),this.outer.digestHex()}}let I=(a,b)=>new C().update(a,b).digest(),J=(a,b)=>{let c=new C().update(a,b).digest();return new C().update(c).digest()},K=(a,b)=>{let c=new C().update(a,b).digest();return new B().update(c).digest()},L=(a,b,c)=>new F(a).update(b,c).digest(),M=(a,b,c)=>new H(a).update(b,c).digest();function N(a,b,c,d,e="sha512"){if("sha512"!==e)throw Error("Only sha512 is supported in this PBKDF2 implementation");let f=Array(d),g=[...b,0,0,0,0],h=0,i=Math.ceil(d/64);for(let d=1;d<=i;d++){g[b.length]=d>>24&255,g[b.length+1]=d>>16&255,g[b.length+2]=d>>8&255,g[b.length+3]=255&d;let e=M(a,g),i=e;for(let b=1;b<c;b++){i=M(a,i);for(let a=0;a<64;a++)e[a]^=i[a]}for(let a=0;a<e.length;a++)f[h+a]=e[a];h+=64}return f.slice(0,d)}a.s(["RIPEMD160",()=>B,"SHA1",()=>D,"SHA1HMAC",()=>G,"SHA256",()=>C,"SHA256HMAC",()=>F,"SHA512",()=>E,"SHA512HMAC",()=>H,"hash160",0,K,"hash256",0,J,"pbkdf2",()=>N,"ripemd160",0,(a,b)=>new B().update(a,b).digest(),"sha1",0,(a,b)=>new D().update(a,b).digest(),"sha256",0,I,"sha256hmac",0,L,"sha512",0,(a,b)=>new E().update(a,b).digest(),"sha512hmac",0,M,"toArray",()=>l],88497);let O=a=>a.length%2==1?"0"+a:a,P=a=>{let b="";for(let c of a)b+=O(c.toString(16));return b},Q=(a,b)=>{if(Array.isArray(a))return a.slice();if(void 0===a)return[];if("string"!=typeof a)return Array.from(a,a=>0|a);switch(b){case"hex":return R(a);case"base64":return S(a);default:var c=a;let d=[];for(let a=0;a<c.length;a++){let b=c.codePointAt(a);if(void 0===b)throw Error(`Index out of range: ${a}`);let e=b;e>65535?a++:e>=55296&&e<=57343&&(e=65533),e<=127?d.push(e):e<=2047?d.push(192|e>>6,128|63&e):e<=65535?d.push(224|e>>12,128|e>>6&63,128|63&e):d.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)}return d}},R=a=>{(a=a.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(a="0"+a);let b=[];for(let c=0;c<a.length;c+=2)b.push(parseInt(a[c]+a[c+1],16));return b},S=a=>{let b=[],c=0,d=0;for(let e of a.replace(/=+$/,""))c=c<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e),(d+=6)>=8&&(d-=8,b.push(c>>d&255),c&=(1<<d)-1);return b},T=a=>{let b="",c=0;for(let d=0;d<a.length;d++){let e=a[d];if(c>0){c--;continue}if(e<=127)b+=String.fromCharCode(e);else if(e>=192&&e<=223)c=1,b+=String.fromCharCode((31&e)<<6|63&a[d+1]);else if(e>=224&&e<=239)c=2,b+=String.fromCharCode((15&e)<<12|(63&a[d+1])<<6|63&a[d+2]);else if(e>=240&&e<=247){let f=a[d+1],g=a[d+2],h=a[d+3];c=3;let i=(7&e)<<18|(63&f)<<12|(63&g)<<6|63&h;b+=String.fromCharCode(55296+(i-65536>>10),56320+(i-65536&1023))}}return b};function U(a){let b,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="";for(b=0;b<a.length;b+=3){let e=a[b],f=b+1<a.length?a[b+1]:0,g=b+2<a.length?a[b+2]:0,h=e>>2,i=(3&e)<<4|f>>4,j=(15&f)<<2|g>>6,k=63&g;d+=c.charAt(h)+c.charAt(i),d+=b+1<a.length?c.charAt(j):"=",d+=b+2<a.length?c.charAt(k):"="}return d}let V="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",W=a=>{let b;if(""===a||"string"!=typeof a)throw Error(`Expected base58 string but got “${a}”`);let c=a.match(/[IOl0]/gmu);if(null!==c)throw Error(`Invalid base58 character “${c.join("")}”`);let d=a.match(/^1+/gmu),e=null!==d?d[0].length:0,f=(a.length-e)*(Math.log(58)/Math.log(256))+1>>>0;return[...new Uint8Array([...new Uint8Array(e),...(a.match(/./gmu)??[]).map(a=>V.indexOf(a)).reduce((a,b)=>a=a.map(a=>{let c=58*a+b;return b=c>>8,c}),new Uint8Array(f)).reverse().filter((b=!1,a=>b=b||a))])]},X=a=>{let b=Array(256).fill(-1);for(let a=0;a<V.length;++a)b[V.charCodeAt(a)]=a;let c=[];for(let d of a){let a=d;for(let d=0;d<c.length;++d){let e=(b[c[d]]<<8)+a;c[d]=V.charCodeAt(e%58),a=e/58|0}for(;0!==a;)c.push(V.charCodeAt(a%58)),a=a/58|0}for(let b of a)if(0!==b)break;else c.push(49);return c.reverse(),String.fromCharCode(...c)},Y=(a,b=[0])=>{let c=J([...b,...a]);return X(c=[...b,...a,...c.slice(0,4)])},Z=(a,b,c=1)=>{let d=W(a),e=d.slice(0,c),f=d.slice(c,-4),g=[...e,...f];return g=J(g),d.slice(-4).forEach((a,b)=>{if(a!==g[b])throw Error("Invalid checksum")}),"hex"===b&&(e=P(e),f=P(f)),{prefix:e,data:f}};class ${bufs;length;constructor(a){for(const b of(this.bufs=void 0!==a?a:[],this.length=0,this.bufs))this.length+=b.length}getLength(){return this.length}toArray(){let a=Array(this.length),b=0;for(let c of this.bufs)for(let d of c)a[b++]=d;return a}write(a){return this.bufs.push(a),this.length+=a.length,this}writeReverse(a){let b=Array(a.length);for(let c=0;c<b.length;c++)b[c]=a[a.length-1-c];return this.bufs.push(b),this.length+=b.length,this}writeUInt8(a){let b=[,];return b[0]=a,this.write(b),this}writeInt8(a){let b=[,];return b[0]=255&a,this.write(b),this}writeUInt16BE(a){return this.bufs.push([a>>8&255,255&a]),this.length+=2,this}writeInt16BE(a){return this.writeUInt16BE(65535&a)}writeUInt16LE(a){return this.bufs.push([255&a,a>>8&255]),this.length+=2,this}writeInt16LE(a){return this.writeUInt16LE(65535&a)}writeUInt32BE(a){return this.bufs.push([a>>24&255,a>>16&255,a>>8&255,255&a]),this.length+=4,this}writeInt32BE(a){return this.writeUInt32BE(a>>>0)}writeUInt32LE(a){return this.bufs.push([255&a,a>>8&255,a>>16&255,a>>24&255]),this.length+=4,this}writeInt32LE(a){return this.writeUInt32LE(a>>>0)}writeUInt64BEBn(a){let b=a.toArray("be",8);return this.write(b),this}writeUInt64LEBn(a){let b=a.toArray("be",8);return this.writeReverse(b),this}writeUInt64LE(a){let b=new c(a).toArray("be",8);return this.writeReverse(b),this}writeVarIntNum(a){let b=$.varIntNum(a);return this.write(b),this}writeVarIntBn(a){let b=$.varIntBn(a);return this.write(b),this}static varIntNum(a){let b;if(a<253)b=[a];else if(a<65536)b=[253,255&a,a>>8&255];else if(a<0x100000000)b=[254,255&a,a>>8&255,a>>16&255,a>>24&255];else{let c=0|a,d=0|Math.floor(a/0x100000000);b=[255,255&c,c>>8&255,c>>16&255,c>>24&255,255&d,d>>8&255,d>>16&255,d>>24&255]}return b}static varIntBn(a){let b;if(a.ltn(253))b=[a.toNumber()];else if(a.ltn(65536)){let c=a.toNumber();b=[253,255&c,c>>8&255]}else if(a.lt(new c(0x100000000))){let c=a.toNumber();b=[254,255&c,c>>8&255,c>>16&255,c>>24&255]}else{let c=new $;c.writeUInt8(255),c.writeUInt64LEBn(a),b=c.toArray()}return b}}class _{bin;pos;length;constructor(a=[],b=0){this.bin=a,this.pos=b,this.length=a.length}eof(){return this.pos>=this.length}read(a=this.length){let b=this.pos,c=this.pos+a;return this.pos=c,this.bin.slice(b,c)}readReverse(a=this.length){let b=Array(a);for(let c=0;c<a;c++)b[c]=this.bin[this.pos+a-1-c];return this.pos+=a,b}readUInt8(){let a=this.bin[this.pos];return this.pos+=1,a}readInt8(){let a=this.bin[this.pos];return this.pos+=1,(128&a)!=0?a-256:a}readUInt16BE(){let a=this.bin[this.pos]<<8|this.bin[this.pos+1];return this.pos+=2,a}readInt16BE(){let a=this.readUInt16BE();return(32768&a)!=0?a-65536:a}readUInt16LE(){let a=this.bin[this.pos]|this.bin[this.pos+1]<<8;return this.pos+=2,a}readInt16LE(){let a=this.readUInt16LE();return(32768&a)!=0?a-65536:a}readUInt32BE(){let a=0x1000000*this.bin[this.pos]+(this.bin[this.pos+1]<<16|this.bin[this.pos+2]<<8|this.bin[this.pos+3]);return this.pos+=4,a}readInt32BE(){let a=this.readUInt32BE();return(0x80000000&a)!=0?a-0x100000000:a}readUInt32LE(){let a=(this.bin[this.pos]|this.bin[this.pos+1]<<8|this.bin[this.pos+2]<<16|this.bin[this.pos+3]<<24)>>>0;return this.pos+=4,a}readInt32LE(){let a=this.readUInt32LE();return(0x80000000&a)!=0?a-0x100000000:a}readUInt64BEBn(){let a=new c(this.bin.slice(this.pos,this.pos+8));return this.pos=this.pos+8,a}readUInt64LEBn(){return new c(this.readReverse(8))}readVarIntNum(){let a,b=this.readUInt8();switch(b){case 253:return this.readUInt16LE();case 254:return this.readUInt32LE();case 255:if((a=this.readUInt64LEBn()).lte(new c(2).pow(new c(53))))return a.toNumber();throw Error("number too large to retain precision - use readVarIntBn");default:return b}}readVarInt(){switch(this.bin[this.pos]){case 253:return this.read(3);case 254:return this.read(5);case 255:return this.read(9);default:return this.read(1)}}readVarIntBn(){let a=this.readUInt8();switch(a){case 253:return new c(this.readUInt16LE());case 254:return new c(this.readUInt32LE());case 255:return this.readUInt64LEBn();default:return new c(a)}}}a.s(["Reader",()=>_,"Writer",()=>$,"encode",0,(a,b)=>{switch(b){case"hex":return P(a);case"utf8":return T(a);default:return a}},"fromBase58",0,W,"fromBase58Check",0,Z,"minimallyEncode",0,a=>{if(0===a.length)return a;let b=a[a.length-1];if((127&b)!=0)return a;if(1===a.length)return[];if((128&a[a.length-2])!=0)return a;for(let c=a.length-1;c>0;c--)if(0!==a[c-1])if((128&a[c-1])!=0)return a[c]=b,a.slice(0,c+1);else return a[c-1]|=b,a.slice(0,c);return[]},"toArray",0,Q,"toBase58",0,X,"toBase58Check",0,Y,"toBase64",()=>U,"toHex",0,P,"toUTF8",0,T,"zero2",0,O],22787);class aa extends h{static red=new f("k256");static a=new c(0).toRed(aa.red);static b=new c(7).toRed(aa.red);static zero=new c(0).toRed(aa.red);x;y;inf;static fromDER(a){if((4===a[0]||6===a[0]||7===a[0])&&a.length-1==64){if(6===a[0]){if(a[a.length-1]%2!=0)throw Error("Point string value is wrong length")}else if(7===a[0]&&a[a.length-1]%2!=1)throw Error("Point string value is wrong length");return new aa(a.slice(1,33),a.slice(33,65))}if((2===a[0]||3===a[0])&&a.length-1==32)return aa.fromX(a.slice(1,33),3===a[0]);throw Error("Unknown point format")}static fromString(a){let b=Q(a,"hex");return aa.fromDER(b)}static redSqrtOptimized(a){let b=aa.red.m.addn(1).iushrn(2);return a.redPow(b)}static fromX(a,b){if("function"==typeof BigInt){let e,f;function d(a,b,c){let d=BigInt(1);for(a=(a%c+c)%c;b>BigInt(0);)(b&BigInt(1))===BigInt(1)&&(d=(d*a%c+c)%c),b>>=BigInt(1),a=(a*a%c+c)%c;return d}let g=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F"),h=BigInt(7);if(a instanceof c)e=BigInt("0x"+a.toString(16));else if("string"==typeof a)e=BigInt("0x"+a);else if(Array.isArray(a))e=BigInt("0x"+P(a).padStart(64,"0"));else if("number"==typeof a)e=BigInt(a);else throw Error("Invalid x-coordinate type");let i=((d(e=(e%g+g)%g,BigInt(3),g)+h)%g+g)%g,j=((f=d(i,g+BigInt(1)>>BigInt(2),g))*f%g+g)%g==(i%g+g)%g?f:null;if(null===j)throw Error("Invalid point");let k=j%BigInt(2)===BigInt(1);return(b&&!k||!b&&k)&&(j=g-j),new aa(new c(e.toString(16),16),new c(j.toString(16),16))}{let d=new f("k256"),e=new c(0).toRed(d),g=new c(7).toRed(d),h=new c(0).toRed(d);c.isBN(a)||(a=new c(a,16)),null==a.red&&(a=a.toRed(d));let i=a.redSqr().redMul(a).redIAdd(a.redMul(e)).redIAdd(g),j=i.redSqrt();if(0!==j.redSqr().redSub(i).cmp(h))throw Error("invalid point");let k=j.fromRed().isOdd();return(b&&!k||!b&&k)&&(j=j.redNeg()),new aa(a,j)}}static fromJSON(a,b){"string"==typeof a&&(a=JSON.parse(a));let c=new aa(a[0],a[1],b);if("object"!=typeof a[2])return c;let d=a=>new aa(a[0],a[1],b),e=a[2];return c.precomputed={beta:null,doubles:"object"==typeof e.doubles&&null!==e.doubles?{step:e.doubles.step,points:[c].concat(e.doubles.points.map(d))}:void 0,naf:"object"==typeof e.naf&&null!==e.naf?{wnd:e.naf.wnd,points:[c].concat(e.naf.points.map(d))}:void 0},c}constructor(a,b,d=!0){super("affine"),this.precomputed=null,null===a&&null===b?(this.x=null,this.y=null,this.inf=!0):(c.isBN(a)||(a=new c(a,16)),this.x=a,c.isBN(b)||(b=new c(b,16)),this.y=b,d&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),null===this.x.red&&(this.x=this.x.toRed(this.curve.red)),null===this.y.red&&(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}validate(){return this.curve.validate(this)}encode(a=!0,b){let c,d=this.curve.p.byteLength(),e=this.getX().toArray("be",d);return(c=a?[this.getY().isEven()?2:3].concat(e):[4].concat(e,this.getY().toArray("be",d)),"hex"!==b)?c:P(c)}toString(){return this.encode(!0,"hex")}toJSON(){return null==this.precomputed?[this.x,this.y]:[this.x,this.y,"object"==typeof this.precomputed&&null!==this.precomputed?{doubles:null!=this.precomputed.doubles?{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)}:void 0,naf:null!=this.precomputed.naf?{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}:void 0}:void 0]}inspect(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+(this.x?.fromRed()?.toString(16,2)??"undefined")+" y: "+(this.y?.fromRed()?.toString(16,2)??"undefined")+">"}isInfinity(){return this.inf}add(a){if(this.inf)return a;if(a.inf)return this;if(this.eq(a))return this.dbl();if(this.neg().eq(a)||this.x?.cmp(a.x??new c(0))===0)return new aa(new c(0),new c(0));let b=this.y?.redSub(a.y??new c(0))??new c(0);0!==b.cmpn(0)&&(b=b.redMul(this.x?.redSub(a.x??new c(0)).redInvm()??new c(1)));let d=b?.redSqr().redISub(this.x??new c(0)).redISub(a.x??new c(0)),e=(b??new c(1)).redMul((this.x??new c(0)).redSub(d??new c(0))).redISub(this.y??new c(0));return new aa(d??new c(0),e??new c(0))}dbl(){if(this.inf)return this;let a=(this.y??new c(0)).redAdd(this.y??new c(0));if(0===a.cmpn(0))return new aa(new c(0),new c(0));let b=this.curve.a,d=(this.x??new c(0)).redSqr(),e=a.redInvm(),f=d.redAdd(d).redIAdd(d).redIAdd(b).redMul(e),g=f.redSqr().redISub((this.x??new c(0)).redAdd(this.x??new c(0))),h=f.redMul((this.x??new c(0)).redSub(g)).redISub(this.y??new c(0));return new aa(g,h)}getX(){return(this.x??new c(0)).fromRed()}getY(){return(this.y??new c(0)).fromRed()}mul(a){return(c.isBN(a)||(a=new c(a,16)),this.isInfinity())?this:this._hasDoubles(a)?this._fixedNafMul(a):this._endoWnafMulAdd([this],[a])}mulAdd(a,b,c){return this._endoWnafMulAdd([this,b],[a,c])}jmulAdd(a,b,c){return this._endoWnafMulAdd([this,b],[a,c],!0)}eq(a){return this===a||this.inf===a.inf&&(this.inf||0===(this.x??new c(0)).cmp(a.x??new c(0))&&0===(this.y??new c(0)).cmp(a.y??new c(0)))}neg(a){if(this.inf)return this;let b=new aa(this.x,(this.y??new c(0)).redNeg());if(!0===a&&null!=this.precomputed){let a=this.precomputed;b.precomputed={naf:null!=a.naf?{wnd:a.naf.wnd,points:a.naf.points.map(a=>a.neg())}:void 0,doubles:null!=a.doubles?{step:a.doubles.step,points:a.doubles.points.map(a=>a.neg())}:void 0,beta:void 0}}return b}dblp(a){let b=this;for(let c=0;c<a;c++)b=b.dbl();return b}toJ(){return this.inf?new i(null,null,null):new i(this.x,this.y,this.curve.one)}_getBeta(){if("object"!=typeof this.curve.endo)return;let a=this.precomputed;if("object"==typeof a&&null!==a&&"object"==typeof a.beta&&null!==a.beta)return a.beta;let b=new aa((this.x??new c(0)).redMul(this.curve.endo.beta),this.y);if(null!=a){let c=this.curve,d=a=>{if(null===a.x)throw Error("p.x is null");if(void 0===c.endo||null===c.endo)throw Error("curve.endo is undefined");return new aa(a.x.redMul(c.endo.beta),a.y)};a.beta=b,b.precomputed={beta:null,naf:null!=a.naf?{wnd:a.naf.wnd,points:a.naf.points.map(d)}:void 0,doubles:null!=a.doubles?{step:a.doubles.step,points:a.doubles.points.map(d)}:void 0}}return b}_fixedNafMul(a){if("object"!=typeof this.precomputed||null===this.precomputed)throw Error("_fixedNafMul requires precomputed values for the point");let b=this._getDoubles(),c=this.curve.getNAF(a,1,this.curve._bitLength),d=(1<<b.step+1)-(b.step%2==0?2:1);d/=3;let e=[];for(let a=0;a<c.length;a+=b.step){let d=0;for(let e=a+b.step-1;e>=a;e--)d=(d<<1)+c[e];e.push(d)}let f=new i(null,null,null),g=new i(null,null,null);for(let a=d;a>0;a--){for(let c=0;c<e.length;c++){let d=e[c];d===a?g=g.mixedAdd(b.points[c]):d===-a&&(g=g.mixedAdd(b.points[c].neg()))}f=f.add(g)}return f.toP()}_wnafMulAdd(a,b,d,e,f){let g=this.curve._wnafT1.map(a=>a.toNumber()),h=this.curve._wnafT2.map(()=>[]),j=this.curve._wnafT3.map(()=>[]),k=0;for(let c=0;c<e;c++){let d=b[c]._getNAFPoints(a);g[c]=d.wnd,h[c]=d.points}for(let a=e-1;a>=1;a-=2){let e=a-1,f=a;if(1!==g[e]||1!==g[f]){j[e]=this.curve.getNAF(d[e],g[e],this.curve._bitLength),j[f]=this.curve.getNAF(d[f],g[f],this.curve._bitLength),k=Math.max(j[e].length,k),k=Math.max(j[f].length,k);continue}let i=[b[e],null,null,b[f]];0===(b[e].y??new c(0)).cmp(b[f].y??new c(0))?(i[1]=b[e].add(b[f]),i[2]=b[e].toJ().mixedAdd(b[f].neg())):0===(b[e].y??new c(0)).cmp((b[f].y??new c(0)).redNeg())?(i[1]=b[e].toJ().mixedAdd(b[f]),i[2]=b[e].add(b[f].neg())):(i[1]=b[e].toJ().mixedAdd(b[f]),i[2]=b[e].toJ().mixedAdd(b[f].neg()));let l=[-3,-1,-5,-7,0,7,5,1,3],m=this.curve.getJSF(d[e],d[f]);k=Math.max(m[0].length,k),j[e]=Array(k),j[f]=Array(k);for(let a=0;a<k;a++){let b=0|m[0][a],c=0|m[1][a];j[e][a]=l[(b+1)*3+(c+1)],j[f][a]=0,h[e]=i}}let l=new i(null,null,null),m=this.curve._wnafT4;for(let a=k;a>=0;a--){let b=0;for(;a>=0;){let d=!0;for(let b=0;b<e;b++)m[b]=new c("number"==typeof j[b][a]?j[b][a]:0),m[b].isZero()||(d=!1);if(!d)break;b++,a--}if(a>=0&&b++,l=l.dblp(b),a<0)break;let d=new c(1),f=new c(2);for(let a=0;a<e;a++){let b,c=m[a];0!==c.cmpn(0)&&(l="affine"===(b=c.isNeg()?h[a][c.neg().sub(d).div(f).toNumber()].neg():h[a][c.sub(d).div(f).toNumber()]).type?l.mixedAdd(b):l.add(b))}}for(let a=0;a<e;a++)h[a]=[];return!0===f?l:l.toP()}_endoWnafMulAdd(a,b,d){let e,f=Array(2*a.length),g=Array(2*a.length);for(e=0;e<a.length;e++){let d=this.curve._endoSplit(b[e]),h=a[e],i=h._getBeta()??new aa(new c(0),new c(0));0!==d.k1.negative&&(d.k1.ineg(),h=h.neg(!0)),0!==d.k2.negative&&(d.k2.ineg(),i=i.neg(!0)),f[2*e]=h,f[2*e+1]=i,g[2*e]=d.k1,g[2*e+1]=d.k2}let h=this._wnafMulAdd(1,f,g,2*e,d);for(let a=0;a<2*e;a++)f[a]=null,g[a]=null;return h}_hasDoubles(a){if(null==this.precomputed)return!1;let b=this.precomputed.doubles;return"object"==typeof b&&b.points.length>=Math.ceil((a.bitLength()+1)/b.step)}_getDoubles(a,b){if("object"==typeof this.precomputed&&null!==this.precomputed&&"object"==typeof this.precomputed.doubles&&null!==this.precomputed.doubles)return this.precomputed.doubles;let c=[this],d=this;for(let e=0;e<(b??0);e+=a??1){for(let b=0;b<(a??1);b++)d=d.dbl();c.push(d)}return{step:a??1,points:c}}_getNAFPoints(a){if("object"==typeof this.precomputed&&null!==this.precomputed&&"object"==typeof this.precomputed.naf&&null!==this.precomputed.naf)return this.precomputed.naf;let b=[this],c=(1<<a)-1,d=1===c?null:this.dbl();for(let a=1;a<c;a++)null!==d&&(b[a]=b[a-1].add(d));return{wnd:a,points:b}}}class ab{p;red;redN;zero;one;two;g;n;a;b;tinv;zeroA;threeA;endo;_endoWnafT1;_endoWnafT2;_wnafT1;_wnafT2;_wnafT3;_wnafT4;_bitLength;static assert(a,b="Elliptic curve assertion failed"){if(!a)throw Error(b)}getNAF(a,b,c){let d=Array(Math.max(a.bitLength(),c)+1);d.fill(0);let e=1<<b+1,f=a.clone();for(let a=0;a<d.length;a++){let b,c=f.andln(e-1);f.isOdd()?(b=c>(e>>1)-1?(e>>1)-c:c,f.isubn(b)):b=0,d[a]=b,f.iushrn(1)}return d}getJSF(a,b){let c=[[],[]];a=a.clone(),b=b.clone();let d=0,e=0;for(;a.cmpn(-d)>0||b.cmpn(-e)>0;){let f,g,h=a.andln(3)+d&3,i=b.andln(3)+e&3;if(3===h&&(h=-1),3===i&&(i=-1),(1&h)==0)f=0;else{let b=a.andln(7)+d&7;f=(3===b||5===b)&&2===i?-h:h}if(c[0].push(f),(1&i)==0)g=0;else{let a=b.andln(7)+e&7;g=(3===a||5===a)&&2===h?-i:i}c[1].push(g),2*d===f+1&&(d=1-d),2*e===g+1&&(e=1-e),a.iushrn(1),b.iushrn(1)}return c}static cachedProperty(a,b,c){let d="_"+b;a.prototype[b]=function(){return void 0!==this[d]?this[d]:this[d]=c.call(this)}}static parseBytes(a){return"string"==typeof a?Q(a,"hex"):a}static intFromLE(a){return new c(a,"hex","le")}constructor(){if(void 0!==b)return b;b=this;const a={prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",{doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}]};this.p=new c(a.p,16),this.red=new f(a.prime),this.zero=new c(0).toRed(this.red),this.one=new c(1).toRed(this.red),this.two=new c(2).toRed(this.red),this.n=new c(a.n,16),this.g=aa.fromJSON(a.g,a.gRed),this._wnafT1=[,,,,],this._wnafT2=[,,,,],this._wnafT3=[,,,,],this._wnafT4=[,,,,],this._bitLength=this.n.bitLength(),this.redN=this.n.toRed(this.red),this.a=new c(a.a,16).toRed(this.red),this.b=new c(a.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(a),this._endoWnafT1=[,,,,],this._endoWnafT2=[,,,,]}_getEndomorphism(a){let b,d,e;if(this.zeroA&&1===this.p.modrn(3)){if(void 0!==a.beta)b=new c(a.beta,16).toRed(this.red);else{let a=this._getEndoRoots(this.p);if(null===a)throw Error("Failed to get endomorphism roots for beta.");b=(b=0>a[0].cmp(a[1])?a[0]:a[1]).toRed(this.red)}if(void 0!==a.lambda)d=new c(a.lambda,16);else{let a=this._getEndoRoots(this.n);if(null===a)throw Error("Failed to get endomorphism roots for lambda.");if(null==this.g)throw Error("Curve generator point (g) is not defined.");let c=this.g.mul(a[0])?.x,e=null!=this.g.x?this.g.x.redMul(b):void 0;if(null!=c&&null!=e&&0===c.cmp(e))d=a[0];else{if(d=a[1],null==this.g)throw Error("Curve generator point (g) is not defined.");let c=this.g.mul(d)?.x,e=null!=this.g.x?this.g.x.redMul(b):void 0;if(null==c||null==e)throw Error("Lambda computation failed: g.mul(lambda).x or g.x.redMul(beta) is undefined.");ab.assert(0===c.cmp(e),"Lambda selection does not match computed beta.")}}return e="object"==typeof a.basis&&null!==a.basis?a.basis.map(function(a){return{a:new c(a.a,16),b:new c(a.b,16)}}):this._getEndoBasis(d),{beta:b,lambda:d,basis:e}}}_getEndoRoots(a){let b=a===this.p?this.red:new g(a),d=new c(2).toRed(b).redInvm(),e=d.redNeg(),f=new c(3).toRed(b).redNeg().redSqrt().redMul(d);return[e.redAdd(f).fromRed(),e.redSub(f).fromRed()]}_getEndoBasis(a){let b,d,e,f,g,h,i=this.n.ushrn(Math.floor(this.n.bitLength()/2)),j=a,k=this.n.clone(),l=new c(1),m=new c(0),n=new c(0),o=new c(1),p=new c(0),q=0,r=new c(0),s=new c(0);for(;0!==j.cmpn(0);){let a=k.div(j);r=k.sub(a.mul(j)),s=n.sub(a.mul(l));let c=o.sub(a.mul(m));if(void 0===e&&0>r.cmp(i))b=p.neg(),d=l,e=r.neg(),f=s;else if(void 0!==e&&2==++q)break;p=r,k=j,j=r,n=l,l=s,o=m,m=c}if(void 0===b||void 0===d||void 0===e||void 0===f)throw Error("Failed to compute Endo Basis values");g=r.neg(),h=s;let t=e.sqr().add(f.sqr());return g.sqr().add(h.sqr()).cmp(t)>=0&&(g=b,h=d),0!==e.negative&&(e=e.neg(),f=f.neg()),0!==g.negative&&(g=g.neg(),h=h.neg()),[{a:e,b:f},{a:g,b:h}]}_endoSplit(a){if(null==this.endo)throw Error("Endomorphism is not defined.");let b=this.endo.basis,c=b[0],d=b[1],e=d.b.mul(a).divRound(this.n),f=c.b.neg().mul(a).divRound(this.n),g=e.mul(c.a),h=f.mul(d.a),i=e.mul(c.b),j=f.mul(d.b);return{k1:a.sub(g).sub(h),k2:i.add(j).neg()}}validate(a){if(a.inf)return!0;let b=a.x,c=a.y;if(null===b||null===c)throw Error("Point coordinates cannot be null");let d=this.a.redMul(b),e=b.redSqr().redMul(b).redIAdd(d).redIAdd(this.b);return 0===c.redSqr().redISub(e).cmpn(0)}}a.s(["default",()=>ah],95320),a.s(["sign",()=>af,"verify",()=>ag],15512),a.s(["default",()=>ac],31641);class ac{r;s;static fromDER(a,b){let d=(a,b)=>{let c=a[b.place++];if((128&c)==0)return c;throw Error("Invalid DER entity length")};a=Q(a,b);let e=new class{place;constructor(){this.place=0}};if(48!==a[e.place++])throw Error("Signature DER must start with 0x30");if(d(a,e)+e.place!==a.length||2!==a[e.place++])throw Error("Signature DER invalid");let f=d(a,e),g=a.slice(e.place,f+e.place);if(e.place+=f,2!==a[e.place++])throw Error("Signature DER invalid");let h=d(a,e);if(a.length!==h+e.place)throw Error("Invalid R-length in signature DER");let i=a.slice(e.place,h+e.place);if(0===g[0])if((128&g[1])!=0)g=g.slice(1);else throw Error("Invalid R-value in signature DER");if(0===i[0])if((128&i[1])!=0)i=i.slice(1);else throw Error("Invalid S-value in signature DER");return new ac(new c(g),new c(i))}static fromCompact(a,b){if(65!==(a=Q(a,b)).length)throw Error("Invalid Compact Signature");let d=a[0];if(d<27||d>=35)throw Error("Invalid Compact Byte");return new ac(new c(a.slice(1,33)),new c(a.slice(33,65)))}constructor(a,b){this.r=a,this.s=b}verify(a,b,d){return ag(new c(I(a,d),16),this,b)}toString(a){return this.toDER(a)}toDER(a){let b=(a,b)=>{if(b<128)a.push(b);else throw Error("len must be < 0x80")},c=a=>{let b=0,c=a.length-1;for(;0===a[b]&&(128&a[b+1])==0&&b<c;)b++;return 0===b?a:a.slice(b)},d=this.r.toArray(),e=this.s.toArray();for((128&d[0])!=0&&(d=[0].concat(d)),(128&e[0])!=0&&(e=[0].concat(e)),d=c(d),e=c(e);0===e[0]&&(128&e[1])==0;)e=e.slice(1);let f=[2];b(f,d.length),(f=f.concat(d)).push(2),b(f,e.length);let g=f.concat(e),h=[48];return(b(h,g.length),h=h.concat(g),"hex"===a)?P(h):"base64"===a?U(h):h}toCompact(a,b,c){if(a<0||a>3)throw Error("Invalid recovery param");if("boolean"!=typeof b)throw Error("Invalid compressed param");let d=27+a;b&&(d+=4);let e=[d];return(e=(e=e.concat(this.r.toArray("be",32))).concat(this.s.toArray("be",32)),"hex"===c)?P(e):"base64"===c?U(e):e}RecoverPublicKey(a,b){let c=this.r,d=this.s,e=new ab,f=e.n,g=e.g,h=0!=a>>1?c.add(f):c,i=aa.fromX(h,(1&a)!=0);if(!i.mul(f).isInfinity())throw Error("nR is not at infinity");let j=b.neg().umod(f),k=c.invm(f),l=k.mul(d).umod(f),m=k.mul(j).umod(f),n=new ah(g.mul(m).add(i.mul(l)));return n.validate(),n}CalculateRecoveryFactor(a,b){for(let c=0;c<4;c++){let d;try{d=this.RecoverPublicKey(c,b)}catch{continue}if(a.eq(d))return c}throw Error("Unable to find valid recovery factor")}}class ad{K;V;constructor(a,b){if(a=Q(a,"hex"),b=Q(b,"hex"),a.length<32)throw Error("Not enough entropy. Minimum is 256 bits");const c=a.concat(b);this.K=Array(32),this.V=Array(32);for(let a=0;a<32;a++)this.K[a]=0,this.V[a]=1;this.update(c)}hmac(){return new F(this.K)}update(a){let b=this.hmac().update(this.V).update([0]);void 0!==a&&(b=b.update(a)),this.K=b.digest(),this.V=this.hmac().update(this.V).digest(),void 0!==a&&(this.K=this.hmac().update(this.V).update([1]).update(a).digest(),this.V=this.hmac().update(this.V).digest())}generate(a){let b=[];for(;b.length<a;)this.V=this.hmac().update(this.V).digest(),b=b.concat(this.V);let c=b.slice(0,a);return this.update(),P(c)}}function ae(a,b,c=new ab){let d=8*a.byteLength()-c.n.bitLength();return(d>0&&a.iushrn(d),null===b&&a.cmp(c.n)>=0)?a.sub(c.n):a}a.s(["default",()=>ad],92189);let af=(a,b,d=!1,e)=>{if("function"==typeof BigInt){let i=BigInt(0),j=BigInt(1),k=BigInt(2),l=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141"),m=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F"),n={x:BigInt("0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798"),y:BigInt("0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8")},o=BigInt("0x"+a.toString(16)),p=BigInt("0x"+b.toString(16));if(p<=i||p>=l)throw Error("Invalid private key");function f(a,b){let c=a.toString(16).padStart(2*b,"0"),d=new Uint8Array(b);for(let a=0;a<b;a++)d[a]=parseInt(c.substr(2*a,2),16);return d}let q=f(p,32),r=f(o,32),s=new ad(Array.from(q),Array.from(r)),t=l-j,u=0;function g(a,b){let c=j,d=i,e=(a%b+b)%b,f=b;for(;e>j;){let a=f/e,b=d-c*a,g=f-e*a;d=c,c=b,f=e,e=g}return(c%b+b)%b}function h(a,b){let c;if(null===a)return b;if(null===b)return a;if(a.x===b.x&&a.y===(-b.y%m+m)%m)return null;if(a.x===b.x&&a.y===b.y){if(a.y===i)return null;c=((BigInt(3)*a.x*a.x%m+m)%m*g(k*a.y,m)%m+m)%m}else c=(((b.y-a.y)%m+m)%m*g(b.x-a.x,m)%m+m)%m;let d=((c*c-a.x-b.x)%m+m)%m,e=((c*(a.x-d)-a.y)%m+m)%m;return{x:d,y:e}}let v=!1;for(;!v;){v=!0,u+=2;let a="function"==typeof e?BigInt("0x"+e(u).toString(16)):null!=e&&c.isBN(e)?BigInt("0x"+e.toString(16)):BigInt("0x"+s.generate(32));if((a=function(a,b,c=!0){let d=a.toString(2).length-b.toString(2).length;return(d>0&&(a>>=BigInt(d)),!c&&a>=b)?a-b:a}(a,l,!0))<=j||a>=t)if(!(e instanceof c))continue;else throw Error("Invalid fixed custom K value (must be more than 1 and less than N-1)");let b=function(a,b){let c=b,d=null;for(;a>BigInt(0);)a%BigInt(2)===BigInt(1)&&(d=null===d?c:h(d,c)??d),c=h(c,c)??c,a>>=BigInt(1);if(null===d)throw Error("Scalar multiplication resulted in an invalid point.");return d}(a,n);if(null===b)if(!(e instanceof c))continue;else throw Error("Invalid fixed custom K value (must not create a point at infinity when multiplied by the generator point)");let f=(b.x%l+l)%l;if(f===i)if(!(e instanceof c))continue;else throw Error("Invalid fixed custom K value (when multiplied by G, the resulting x coordinate mod N must not be zero)");let m=(g(a,l)*(o+(f*p%l+l)%l)%l+l)%l;if(m===i)if(!(e instanceof c))continue;else throw Error("Invalid fixed custom K value (when used with the key, it cannot create a zero value for S)");return d&&m>l/k&&(m=l-m),new ac(new c(f.toString(16),16),new c(m.toString(16),16))}}else{let f=new ab;a=ae(a);let g=f.n.byteLength(),h=new ad(b.toArray("be",g),a.toArray("be",g)),i=f.n.subn(1);for(let j=0;;j++){let k="function"==typeof e?e(j):c.isBN(e)?e:new c(h.generate(g),16);if(null!=k)k=ae(k,!0);else throw Error("k is undefined");if(0>=k.cmpn(1)||k.cmp(i)>=0)if(!c.isBN(e))continue;else throw Error("Invalid fixed custom K value (must be more than 1 and less than N-1)");let l=f.g.mul(k);if(l.isInfinity())if(!c.isBN(e))continue;else throw Error("Invalid fixed custom K value (must not create a point at infinity when multiplied by the generator point)");let m=l.getX().umod(f.n);if(0===m.cmpn(0))if(!c.isBN(e))continue;else throw Error("Invalid fixed custom K value (when multiplied by G, the resulting x coordinate mod N must not be zero)");let n=k.invm(f.n).mul(m.mul(b).iadd(a));if(0===(n=n.umod(f.n)).cmpn(0))if(!c.isBN(e))continue;else throw Error("Invalid fixed custom K value (when used with the key, it cannot create a zero value for S)");return d&&n.cmp(f.n.ushrn(1))>0&&(n=f.n.sub(n)),new ac(m,n)}}throw Error("Failed to generate a valid signature")},ag=(a,b,c)=>{if("function"==typeof BigInt){let d=BigInt(0),e=BigInt(1),f=BigInt(2),g=BigInt(3),h=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F"),i=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141"),j={x:BigInt("0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798"),y:BigInt("0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8")},k=(a,b)=>(a%b+b)%b,l=(a,b)=>{let[c,f]=[a,b],[g,h]=[BigInt(1),BigInt(0)];for(;f!==d;){let a=c/f;[c,f]=[f,c-a*f],[g,h]=[h,g-a*h]}return c>e?d:k(g,b)},m=BigInt(4),n=BigInt(8),o=a=>{let b,c,i,j,l,o,p,q,r,{X:s,Y:t,Z:u}=a;if(t===d)return{X:d,Y:e,Z:d};let v=k(t*t,h),w=(b=k(s*v,h),k(m*b,h)),x=(c=k(s*s,h),k(g*c,h)),y=(i=k(x*x,h),j=k(f*w,h),k(i-j,h)),z=(l=k(w-y,h),p=k(x*l,h),o=k(v*v,h),q=k(n*o,h),k(p-q,h));return{X:y,Y:z,Z:(r=k(t*u,h),k(f*r,h))}},p=(a,b)=>{let c,g,i,j,l,m,n,p,q,r,s,t,u;if(a.Z===d)return b;if(b.Z===d)return a;let v=(c=a.Z,k(c*a.Z,h)),w=(g=b.Z,k(g*b.Z,h)),x=k(a.X*w,h),y=k(b.X*v,h),z=(i=a.Y,j=k(w*b.Z,h),k(i*j,h)),A=(l=b.Y,m=k(v*a.Z,h),k(l*m,h)),B=k(y-x,h),C=k(A-z,h);if(B===d)if(C===d)return o(a);else return{X:d,Y:e,Z:d};let D=k(B*B,h),E=k(B*D,h),F=k(x*D,h),G=(n=k(C*C,h),p=k(n-E,h),q=k(f*F,h),k(p-q,h)),H=(r=k(F-G,h),s=k(C*r,h),t=k(z*E,h),k(s-t,h));return{X:G,Y:H,Z:(u=k(a.Z*b.Z,h),k(B*u,h))}},q=(a,b)=>{let c={X:b.x,Y:b.y,Z:e},f={X:d,Y:e,Z:d},g=a.toString(2);for(let a=0;a<g.length;a++)f=o(f),"1"===g[a]&&(f=p(f,c));return f},r=BigInt("0x"+a.toString(16));if(null==c.x||null==c.y)throw Error("Invalid public key: missing coordinates.");return((a,b,c)=>{let{r:e,s:f}=c;if(e<=d||e>=i||f<=d||f>=i)return!1;let g=l(f,i);if(g===d)return!1;let m=k(a*g,i),n=k(e*g,i),o=p(q(m,j),q(n,b));if(o.Z===d)return!1;let r=l(o.Z,h);if(r===d)return!1;let s=k(r*r,h),t=k(o.X*s,h);return k(t,i)===e})(r,{x:BigInt("0x"+c.x.toString(16)),y:BigInt("0x"+c.y.toString(16))},{r:BigInt("0x"+b.r.toString(16)),s:BigInt("0x"+b.s.toString(16))})}{let d=new ab;a=ae(a);let e=b.r,f=b.s;if(0>e.cmpn(1)||e.cmp(d.n)>=0||0>f.cmpn(1)||f.cmp(d.n)>=0)return!1;let g=f.invm(d.n),h=g.mul(a).umod(d.n),i=g.mul(e).umod(d.n),j=d.g.jmulAdd(h,c,i);return!j.isInfinity()&&j.eqXToP(e)}};class ah extends aa{static fromPrivateKey(a){let b=new ab().g.mul(a);return new ah(b.x,b.y)}static fromString(a){let b=aa.fromString(a);return new ah(b.x,b.y)}static fromDER(a){let b=aa.fromDER(a);return new ah(b.x,b.y)}constructor(a,b=null,c=!0){if(a instanceof aa)super(a.getX(),a.getY());else{if(null===b&&c&&"string"==typeof a&&(66===a.length||130===a.length))throw Error('You are using the "new PublicKey()" constructor with a DER hex string. You need to use "PublicKey.fromString()" instead.');super(a,b,c)}}deriveSharedSecret(a){if(!this.validate())throw Error("Public key not valid for ECDH secret derivation");return this.mul(a)}verify(a,b,d){return ag(new c(I(a,d),16),b,this)}toDER(a){return"hex"===a?this.encode(!0,a):this.encode(!0)}toHash(a){let b=K(this.encode(!0));return"hex"===a?P(b):b}toAddress(a=[0]){if("string"==typeof a)if("testnet"===a||"test"===a)a=[111];else if("mainnet"===a||"main"===a)a=[0];else throw Error(`Invalid prefix ${a}`);return Y(this.toHash(),a)}deriveChild(a,b){let d=this.deriveSharedSecret(a),e=Q(b,"utf8"),f=L(d.encode(!0),e),g=new ab().g.mul(new c(f)),h=this.add(g);return new ah(h.x,h.y)}static fromMsgHashAndCompactSignature(a,b,d){let e=Q(b,d);if(65!==e.length)throw Error("Invalid Compact Signature");let f=e[0];if(f<27||f>=35)throw Error("Invalid Compact Byte");let g=e[0]-27;return g>3&&(g-=4),new ac(new c(e.slice(1,33)),new c(e.slice(33,65))).RecoverPublicKey(g,a)}}class ai{_rand;constructor(){const b=()=>{throw Error("No secure random number generator is available in this environment.")};if(this._rand=b,"object"==typeof self)self.crypto?.getRandomValues?this._rand=a=>{let b=new Uint8Array(a);return self.crypto.getRandomValues(b),[...b]}:this._rand=b;else try{const b=a.r(54799);"function"==typeof b.randomBytes&&(this._rand=a=>[...b.randomBytes(a)])}catch{this._rand=b}}generate(a){return this._rand(a)}}let aj=null,ak=a=>(null==aj&&(aj=new ai),aj.generate(a));a.s(["default",0,ak],60933);class al{x;y;constructor(a,b){const c=new ab().p;this.x=a.umod(c),this.y=b.umod(c)}toString(){return X(this.x.toArray())+"."+X(this.y.toArray())}static fromString(a){let[b,d]=a.split(".");return new al(new c(W(b)),new c(W(d)))}}class am{points;threshold;constructor(a,b){this.points=a,this.threshold=b??a.length}static fromPrivateKey(a,b){let d=new ab().p,e=[new al(new c(0),new c(a.toArray()))];for(let a=1;a<b;a++){let a=new c(ak(32)).umod(d),b=new c(ak(32)).umod(d);e.push(new al(a,b))}return new am(e)}valueAt(a){let b=new ab().p,d=new c(0);for(let c=0;c<this.threshold;c++){let e=this.points[c].y;for(let d=0;d<this.threshold;d++)if(c!==d){let f=this.points[d].x,g=this.points[c].x,h=a.sub(f).umod(b),i=g.sub(f).umod(b).invm(b),j=h.mul(i).umod(b);e=e.mul(j).umod(b)}d=d.add(e).umod(b)}return d}}a.s(["PointInFiniteField",()=>al,"default",()=>am],37883);class an{points;threshold;integrity;constructor(a,b,c){this.points=a,this.threshold=b,this.integrity=c}static fromBackupFormat(a){let b=0,c="";return new an(a.map((a,d)=>{let e=a.split(".");if(4!==e.length)throw Error("Invalid share format in share "+d.toString()+'. Expected format: "x.y.t.i" - received '+a);let[f,g,h,i]=e;if(void 0===h)throw Error("Threshold not found in share "+d.toString());if(void 0===i)throw Error("Integrity not found in share "+d.toString());let j=parseInt(h);if(0!==d&&b!==j)throw Error("Threshold mismatch in share "+d.toString());if(0!==d&&c!==i)throw Error("Integrity mismatch in share "+d.toString());return b=j,c=i,al.fromString([f,g].join("."))}),b,c)}toBackupFormat(){return this.points.map(a=>a.toString()+"."+this.threshold.toString()+"."+this.integrity)}}class ao extends c{static fromRandom(){return new ao(ak(32))}static fromString(a,b="hex"){return new ao(super.fromString(a,b).toArray())}static fromHex(a){return new ao(super.fromHex(a,"big"))}static fromWif(a,b=1){let c=Z(a,void 0,b);if(33!==c.data.length)throw Error("Invalid WIF length");if(1!==c.data[32])throw Error("Invalid WIF padding");return new ao(c.data.slice(0,32))}constructor(a=0,b=10,d="be",e="apply"){if(a instanceof c?(super(),a.copy(this)):super(a,b,d),"nocheck"!==e){const a=this.checkInField();if(!a.inField){if("error"===e)throw Error("Input is out of field");c.move(this,a.modN)}}}checkInField(){let a=new ab,b=this.mod(a.n);return{inField:0===this.cmp(b),modN:b}}isValid(){return this.checkInField().inField}sign(a,b,d=!0,e){return af(new c(I(a,b),16),this,d,e)}verify(a,b,d){return ag(new c(I(a,d),16),b,this.toPublicKey())}toPublicKey(){let a=new ab().g.mul(this);return new ah(a.x,a.y)}toWif(a=[128]){if(!this.isValid())throw Error("Value is out of field");return Y([...this.toArray("be",32),1],a)}toAddress(a=[0]){return this.toPublicKey().toAddress(a)}toHex(){return super.toHex(32)}toString(a="hex",b=64){return super.toString(a,b)}deriveSharedSecret(a){if(!a.validate())throw Error("Public key not valid for ECDH secret derivation");return a.mul(this)}deriveChild(a,b){let d=this.deriveSharedSecret(a),e=Q(b,"utf8"),f=L(d.encode(!0),e),g=new ab;return new ao(this.add(new c(f)).mod(g.n).toArray())}toKeyShares(a,b){if("number"!=typeof a||"number"!=typeof b)throw Error("threshold and totalShares must be numbers");if(a<2)throw Error("threshold must be at least 2");if(b<2)throw Error("totalShares must be at least 2");if(a>b)throw Error("threshold should be less than or equal to totalShares");let d=am.fromPrivateKey(this,a),e=[];for(let a=0;a<b;a++){let a=new c(ao.fromRandom().toArray()),b=d.valueAt(a);e.push(new al(a,b))}return new an(e,a,this.toPublicKey().toHash("hex").slice(0,8))}toBackupShares(a,b){return this.toKeyShares(a,b).toBackupFormat()}static fromBackupShares(a){return ao.fromKeyShares(an.fromBackupFormat(a))}static fromKeyShares(a){let{points:b,threshold:d,integrity:e}=a;if(d<2)throw Error("threshold must be at least 2");if(b.length<d)throw Error(`At least ${d} shares are required to reconstruct the private key`);for(let a=0;a<d;a++)for(let c=a+1;c<d;c++)if(b[a].x.eq(b[c].x))throw Error("Duplicate share detected, each must be unique.");let f=new ao(new am(b,d).valueAt(new c(0)).toArray());if(f.toPublicKey().toHash("hex").slice(0,8)!==e)throw Error("Integrity hash mismatch");return f}}a.s(["KeyShares",()=>an,"default",()=>ao],96745);class ap extends ac{static SIGHASH_ALL=1;static SIGHASH_NONE=2;static SIGHASH_SINGLE=3;static SIGHASH_FORKID=64;static SIGHASH_ANYONECANPAY=128;scope;static format(a){let b={sourceTXID:a.sourceTXID,sourceOutputIndex:a.sourceOutputIndex,sequence:a.inputSequence},c=[...a.otherInputs];function d(b){let c=new $;if(void 0===b)for(let b of a.outputs){let a=b.satoshis??0;c.writeUInt64LE(a);let d=b.lockingScript?.toBinary()??[];c.writeVarIntNum(d.length),c.write(d)}else{let d=a.outputs[b];if(void 0===d)throw Error(`Output at index ${b} does not exist`);let e=d.satoshis??0;c.writeUInt64LE(e);let f=d.lockingScript?.toBinary()??[];c.writeVarIntNum(f.length),c.write(f)}return J(c.toArray())}c.splice(a.inputIndex,0,b);let e=Array(32).fill(0),f=Array(32).fill(0),g=Array(32).fill(0);(a.scope&ap.SIGHASH_ANYONECANPAY)==0&&(e=(()=>{let a=new $;for(let b of c){if(void 0===b.sourceTXID){if(null==b.sourceTransaction)throw Error("Missing sourceTransaction for input");a.write(b.sourceTransaction.hash())}else a.writeReverse(Q(b.sourceTXID,"hex"));a.writeUInt32LE(b.sourceOutputIndex)}return J(a.toArray())})()),(a.scope&ap.SIGHASH_ANYONECANPAY)==0&&(31&a.scope)!==ap.SIGHASH_SINGLE&&(31&a.scope)!==ap.SIGHASH_NONE&&(f=(()=>{let a=new $;for(let b of c){let c=b.sequence??0xffffffff;a.writeUInt32LE(c)}return J(a.toArray())})()),(31&a.scope)!==ap.SIGHASH_SINGLE&&(31&a.scope)!==ap.SIGHASH_NONE?g=d():(31&a.scope)===ap.SIGHASH_SINGLE&&a.inputIndex<a.outputs.length&&(g=d(a.inputIndex));let h=new $;h.writeInt32LE(a.transactionVersion),h.write(e),h.write(f),h.writeReverse(Q(a.sourceTXID,"hex")),h.writeUInt32LE(a.sourceOutputIndex);let i=a.subscript.toBinary();h.writeVarIntNum(i.length),h.write(i),h.writeUInt64LE(a.sourceSatoshis);let j=b.sequence;return h.writeUInt32LE(j),h.write(g),h.writeUInt32LE(a.lockTime),h.writeUInt32LE(a.scope>>>0),h.toArray()}static fromChecksigFormat(a){if(0===a.length)return new ap(new c(1),new c(1),1);let b=a[a.length-1],d=a.slice(0,a.length-1),e=ac.fromDER(d);return new ap(e.r,e.s,b)}constructor(a,b,c){super(a,b),this.scope=c}hasLowS(){return!(this.s.ltn(1)||this.s.gt(new c("7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0","hex")))}toChecksigFormat(){return[...this.toDER(),this.scope]}}a.s(["default",()=>ap],56389)},7069,91010,84818,85183,a=>{"use strict";a.s([],7069);var b=a.i(89058),c=a.i(27872);a.i(81719),a.i(95320),a.i(31641);var d=a.i(96745),e=b;let f=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),g=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]].map(a=>new Uint8Array(a)),h=new Uint8Array(256),i=new Uint8Array(256);for(let a=0;a<256;a++){let b=(a<<1^27*((128&a)!=0))&255;h[a]=b,i[a]=b^a}function j(a,b,c){for(let d=0;d<4;d++){let e=b[c+d];for(let b=0;b<4;b++)a[b][d]^=e[b]}}function k(a){for(let b=0;b<4;b++)a[b]=f[a[b]]}function l(a,b){let c,d,e,l,m=[[],[],[],[]],n=[],o=Array.from(b);if(o.length<=16){for(;o.length<16;)o.unshift(0);l=11}else if(o.length<=24){for(;o.length<24;)o.unshift(0);l=13}else if(b.length<=32){for(;o.length<32;)o.unshift(0);l=15}else throw Error("Illegal key length: "+String(b.length));let p=function(a,b){let c=b.length/4,d=[];for(let a=0;a<b.length;a++)a%4==0&&d.push([]),d[a>>2].push(b[a]);for(let b=c;b<4*a;b++){d[b]=[];let a=d[b-1].slice();if(b%c==0){!function(a){let b=a[0];a[0]=a[1],a[1]=a[2],a[2]=a[3],a[3]=b}(a),k(a);let d=g[b/c];for(let b=0;b<4;b++)a[b]^=d[b]}else c>6&&b%c==4&&k(a);for(let e=0;e<4;e++)d[b][e]=d[b-c][e]^a[e]}return d}(l,o);for(let b=0;b<4;b++)m[0][b]=a[4*b],m[1][b]=a[4*b+1],m[2][b]=a[4*b+2],m[3][b]=a[4*b+3];for(j(m,p,0),e=1;e<l;e++){for(let a=0;a<4;a++)for(let b=0;b<4;b++)m[a][b]=f[m[a][b]];!function(a){let b=a[1][0];a[1][0]=a[1][1],a[1][1]=a[1][2],a[1][2]=a[1][3],a[1][3]=b,b=a[2][0];let c=a[2][1];a[2][0]=a[2][2],a[2][1]=a[2][3],a[2][2]=b,a[2][3]=c,b=a[3][3],a[3][3]=a[3][2],a[3][2]=a[3][1],a[3][1]=a[3][0],a[3][0]=b}(m),e+1<l&&function(a){for(let b=0;b<4;b++){let c=a[0][b],d=a[1][b],e=a[2][b],f=a[3][b];a[0][b]=h[c]^i[d]^e^f,a[1][b]=c^h[d]^i[e]^f,a[2][b]=c^d^h[e]^i[f],a[3][b]=i[c]^d^e^h[f]}}(m),j(m,p,4*e)}for(c=0;c<4;c++)for(d=0;d<4;d++)n.push(m[d][c]);return n}let m=function(a){return[(0xff000000&a)>>>24,(0xff0000&a)>>16,(65280&a)>>8,255&a]},n=function(a){return Array(a).fill(0)},o=[225].concat(n(15)),p=function(a,b){for(let c=0;c<a.length;c++)a[c]^=b[c]},q=function(a){let b,c=0,d=0;for(b=0;b<a.length;b++)d=c,c=1&a[b],a[b]=a[b]>>1,0!==d&&(a[b]=128|a[b]);return a},r=function(a,b){let c=b.slice(),d=n(16);for(let b=0;b<16;b++)for(let e=7;e>=0;e--)(a[b]&1<<e)!=0&&p(d,c),(1&c[15])!=0?(q(c),p(c,o)):q(c);return d},s=function(a){let b,c=a.slice();for(b=15;11!==b;b--)if(c[b]=c[b]+1,256===c[b])c[b]=0;else break;return c};function t(a,b){let c=n(16);for(let d=0;d<a.length;d+=16){let e=c.slice();for(let b=0;b<16;b++)e[b]^=a[d+b]??0;c=r(e,b)}return c}function u(a,b,c){if(0===a.length)return[];let d=Array(a.length),e=b,f=0,g=Math.ceil(a.length/16);for(let b=0;b<g;b++){let h=l(e,c),i=Math.min(16,a.length-f);for(let b=0;b<i;b++)d[f]=a[f]^h[b],f++;b+1<g&&(e=s(e))}return d}var v=a.i(60933),w=a.i(22787);class x extends e.default{static fromRandom(){return new x((0,v.default)(32))}encrypt(a,b){var c,d,e;let f,g,h,i,j=(0,v.default)(32),{result:k,authenticationTag:o}=(c=a=(0,w.toArray)(a,b),d=[],e=this.toArray("be",32),h=l(n(16),e),f=[...j],12===j.length?f=f.concat(n(3)).concat([1]):(j.length%16!=0&&(f=f.concat(n(16-j.length%16))),f=t((f=f.concat(n(8))).concat(n(4)).concat(m(8*j.length)),h)),i=u(c,s(f),e),g=d.slice(),0===d.length?g=g.concat(n(16)):d.length%16!=0&&(g=g.concat(n(16-d.length%16))),g=g.concat(i),0===i.length?g=g.concat(n(16)):i.length%16!=0&&(g=g.concat(n(16-i.length%16))),g=g.concat(n(4)).concat(m(8*d.length)).concat(n(4)).concat(m(8*i.length)),{result:i,authenticationTag:u(t(g,h),f,e)});return(0,w.encode)([...j,...k,...o],b)}decrypt(a,b){var c,d,e;let f,g,h,i,j=(a=(0,w.toArray)(a,b)).slice(0,32),k=a.slice(32),o=k.slice(-16),p=(c=k.slice(0,-16),d=[],e=this.toArray(),h=l(n(16),e),f=[...j],12===j.length?f=f.concat(n(3)).concat([1]):(j.length%16!=0&&(f=f.concat(n(16-j.length%16))),f=t((f=f.concat(n(8))).concat(n(4)).concat(m(8*j.length)),h)),i=u(c,s(f),e),(g=d.slice(),0===d.length?g=g.concat(n(16)):d.length%16!=0&&(g=g.concat(n(16-d.length%16))),g=g.concat(c),0===c.length?g=g.concat(n(16)):c.length%16!=0&&(g=g.concat(n(16-c.length%16))),u(t(g=g.concat(n(4)).concat(m(8*d.length)).concat(n(4)).concat(m(8*c.length)),h),f,e).join()!==o.join())?null:i);if(null===p)throw Error("Decryption failed!");return(0,w.encode)(p,b)}}a.s(["default",()=>x],91010),a.i(92189),a.i(15512);var y=a.i(88497);a.i(56389),a.i(37883),a.s(["default",()=>A],85183);var z=d;a.s(["PrivateKey",()=>z.default],84818);var z=d;class A{curve;constructor(){this.curve=new c.default}generateProof(a,b,c,d){let e=z.default.fromRandom(),f=e.toPublicKey(),g=c.mul(e),h=this.computeChallenge(b,c,d,g,f);return{R:f,SPrime:g,z:e.add(h.mul(a)).umod(this.curve.n)}}verifyProof(a,b,c,d){let{R:e,SPrime:f,z:g}=d,h=this.computeChallenge(a,b,c,f,e),i=this.curve.g.mul(g),j=e.add(a.mul(h));if(!i.eq(j))return!1;let k=b.mul(g),l=f.add(c.mul(h));return!!k.eq(l)}computeChallenge(a,c,d,e,f){let g=[...a.encode(!0),...c.encode(!0),...d.encode(!0),...e.encode(!0),...f.encode(!0)],h=(0,y.sha256)(g);return new b.default(h).umod(this.curve.n)}}},15778,48111,9215,72922,72216,76556,35581,18792,83818,43172,76735,91512,38498,41089,27921,25721,43337,79289,33128,22531,80997,43143,80110,63450,a=>{"use strict";let b={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_SPLIT:127,OP_LEFT:128,OP_NUM2BIN:128,OP_RIGHT:129,OP_BIN2NUM:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_NOP11:186,OP_NOP12:187,OP_NOP13:188,OP_NOP14:189,OP_NOP15:190,OP_NOP16:191,OP_NOP17:192,OP_NOP18:193,OP_NOP19:194,OP_NOP20:195,OP_NOP21:196,OP_NOP22:197,OP_NOP23:198,OP_NOP24:199,OP_NOP25:200,OP_NOP26:201,OP_NOP27:202,OP_NOP28:203,OP_NOP29:204,OP_NOP30:205,OP_NOP31:206,OP_NOP32:207,OP_NOP33:208,OP_NOP34:209,OP_NOP35:210,OP_NOP36:211,OP_NOP37:212,OP_NOP38:213,OP_NOP39:214,OP_NOP40:215,OP_NOP41:216,OP_NOP42:217,OP_NOP43:218,OP_NOP44:219,OP_NOP45:220,OP_NOP46:221,OP_NOP47:222,OP_NOP48:223,OP_NOP49:224,OP_NOP50:225,OP_NOP51:226,OP_NOP52:227,OP_NOP53:228,OP_NOP54:229,OP_NOP55:230,OP_NOP56:231,OP_NOP57:232,OP_NOP58:233,OP_NOP59:234,OP_NOP60:235,OP_NOP61:236,OP_NOP62:237,OP_NOP63:238,OP_NOP64:239,OP_NOP65:240,OP_NOP66:241,OP_NOP67:242,OP_NOP68:243,OP_NOP69:244,OP_NOP70:245,OP_NOP71:246,OP_NOP72:247,OP_NOP73:248,OP_NOP77:252,OP_SMALLDATA:249,OP_SMALLINTEGER:250,OP_PUBKEYS:251,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};for(let a in b)b[b[a]]=a;a.s(["default",0,b],15778);var c,d,e=a.i(22787),f=a.i(89058);class g{chunks;static fromASM(a){let c=[],d=a.split(" "),f=0;for(;f<d.length;){let a,g=d[f],h=0;if(g.startsWith("OP_")&&void 0!==b[g]&&(a=g,h=b[g]),"0"===g)h=0,c.push({op:h}),f+=1;else if("-1"===g)h=b.OP_1NEGATE,c.push({op:h}),f+=1;else if(void 0===a){let a=d[f];a.length%2!=0&&(a="0"+a);let g=(0,e.toArray)(a,"hex");if((0,e.encode)(g,"hex")!==a)throw Error("invalid hex string in script");let i=g.length;i>=0&&i<b.OP_PUSHDATA1?h=i:i<256?h=b.OP_PUSHDATA1:i<65536?h=b.OP_PUSHDATA2:i<0x100000000&&(h=b.OP_PUSHDATA4),c.push({data:g,op:h}),f+=1}else h===b.OP_PUSHDATA1||h===b.OP_PUSHDATA2||h===b.OP_PUSHDATA4?(c.push({data:(0,e.toArray)(d[f+2],"hex"),op:h}),f+=3):(c.push({op:h}),f+=1)}return new g(c)}static fromHex(a){if(0===a.length)return g.fromBinary([]);if(a.length%2!=0)throw Error("There is an uneven number of characters in the string which suggests it is not hex encoded.");if(!/^[0-9a-fA-F]+$/.test(a))throw Error("Some elements in this string are not hex encoded.");return g.fromBinary((0,e.toArray)(a,"hex"))}static fromBinary(a){a=[...a];let c=[],d=0,f=new e.Reader(a);for(;!f.eof();){let a=f.readUInt8();if(a===b.OP_RETURN&&0===d){c.push({op:a,data:f.read()});break}a===b.OP_IF||a===b.OP_NOTIF||a===b.OP_VERIF||a===b.OP_VERNOTIF?d++:a===b.OP_ENDIF&&d--;let e=0,g=[];if(a>0&&a<b.OP_PUSHDATA1)e=a,c.push({data:f.read(e),op:a});else if(a===b.OP_PUSHDATA1){try{e=f.readUInt8(),g=f.read(e)}catch{f.read()}c.push({data:g,op:a})}else if(a===b.OP_PUSHDATA2){try{e=f.readUInt16LE(),g=f.read(e)}catch{f.read()}c.push({data:g,op:a})}else if(a===b.OP_PUSHDATA4){try{e=f.readUInt32LE(),g=f.read(e)}catch{f.read()}c.push({data:g,op:a})}else c.push({op:a})}return new g(c)}constructor(a=[]){this.chunks=a}toASM(){let a="";for(let b=0;b<this.chunks.length;b++){let c=this.chunks[b];a+=this._chunkToString(c)}return a.slice(1)}toHex(){return(0,e.encode)(this.toBinary(),"hex")}toBinary(){let a=new e.Writer;for(let c=0;c<this.chunks.length;c++){let d=this.chunks[c],e=d.op;if(a.writeUInt8(e),e===b.OP_RETURN&&null!=d.data){a.write(d.data);break}null!=d.data&&(e<b.OP_PUSHDATA1?a.write(d.data):e===b.OP_PUSHDATA1?(a.writeUInt8(d.data.length),a.write(d.data)):e===b.OP_PUSHDATA2?(a.writeUInt16LE(d.data.length),a.write(d.data)):e===b.OP_PUSHDATA4&&(a.writeUInt32LE(d.data.length),a.write(d.data)))}return a.toArray()}writeScript(a){return this.chunks=this.chunks.concat(a.chunks),this}writeOpCode(a){return this.chunks.push({op:a}),this}setChunkOpCode(a,b){return this.chunks[a]={op:b},this}writeBn(a){if(a.cmpn(0)===b.OP_0)this.chunks.push({op:b.OP_0});else if(0===a.cmpn(-1))this.chunks.push({op:b.OP_1NEGATE});else if(a.cmpn(1)>=0&&0>=a.cmpn(16))this.chunks.push({op:a.toNumber()+b.OP_1-1});else{let b=a.toSm("little");this.writeBin(b)}return this}writeBin(a){let c;if(a.length>0&&a.length<b.OP_PUSHDATA1)c=a.length;else if(0===a.length)c=b.OP_0;else if(a.length<256)c=b.OP_PUSHDATA1;else if(a.length<65536)c=b.OP_PUSHDATA2;else if(a.length<0x100000000)c=b.OP_PUSHDATA4;else throw Error("You can't push that much data");return this.chunks.push({data:a,op:c}),this}writeNumber(a){return this.writeBn(new f.default(a)),this}removeCodeseparators(){let a=[];for(let c=0;c<this.chunks.length;c++)this.chunks[c].op!==b.OP_CODESEPARATOR&&a.push(this.chunks[c]);return this.chunks=a,this}findAndDelete(a){let b=a.toHex();for(let a=0;a<this.chunks.length;a++)b===new g([this.chunks[a]]).toHex()&&this.chunks.splice(a,1);return this}isPushOnly(){for(let a=0;a<this.chunks.length;a++)if(this.chunks[a].op>b.OP_16)return!1;return!0}isLockingScript(){throw Error("Not implemented")}isUnlockingScript(){throw Error("Not implemented")}_chunkToString(a){let c=a.op,d="";if(void 0===a.data){let a=b[c];d=`${d} ${a}`}else d=`${d} ${(0,e.toHex)(a.data)}`;return d}}a.s(["default",()=>g],48111);class h extends g{isLockingScript(){return!0}isUnlockingScript(){return!1}}a.s(["default",()=>h],9215);class i extends g{isLockingScript(){return!1}isUnlockingScript(){return!0}}a.s(["default",()=>i],72922);var j=a.i(88497),k=a.i(56389),l=a.i(95320),m=a.i(15512);let n=Object.freeze(new f.default(-1).toScriptNum()),o=Object.freeze(Array.from({length:17},(a,b)=>Object.freeze(new f.default(b).toScriptNum())));class p{sourceTXID;sourceOutputIndex;sourceSatoshis;lockingScript;transactionVersion;otherInputs;outputs;inputIndex;unlockingScript;inputSequence;lockTime;context;programCounter;lastCodeSeparator;stack;altStack;ifStack;memoryLimit;stackMem;altStackMem;constructor(a){this.sourceTXID=a.sourceTXID,this.sourceOutputIndex=a.sourceOutputIndex,this.sourceSatoshis=a.sourceSatoshis,this.lockingScript=a.lockingScript,this.transactionVersion=a.transactionVersion,this.otherInputs=a.otherInputs,this.outputs=a.outputs,this.inputIndex=a.inputIndex,this.unlockingScript=a.unlockingScript,this.inputSequence=a.inputSequence,this.lockTime=a.lockTime,this.memoryLimit=a.memoryLimit??32e6,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0,this.reset()}reset(){this.context="UnlockingScript",this.programCounter=0,this.lastCodeSeparator=null,this.stack=[],this.altStack=[],this.ifStack=[],this.stackMem=0,this.altStackMem=0}ensureStackMem(a){this.stackMem+a>this.memoryLimit&&this.scriptEvaluationError("Stack memory usage has exceeded "+String(this.memoryLimit)+" bytes")}ensureAltStackMem(a){this.altStackMem+a>this.memoryLimit&&this.scriptEvaluationError("Alt stack memory usage has exceeded "+String(this.memoryLimit)+" bytes")}pushStack(a){this.ensureStackMem(a.length),this.stack.push(a),this.stackMem+=a.length}pushStackCopy(a){this.ensureStackMem(a.length);let b=a.slice();this.stack.push(b),this.stackMem+=b.length}popStack(){0===this.stack.length&&this.scriptEvaluationError("Attempted to pop from an empty stack.");let a=this.stack.pop();return this.stackMem-=a.length,a}stackTop(a=-1){return(0===this.stack.length||this.stack.length<Math.abs(a)||a>=0&&a>=this.stack.length)&&this.scriptEvaluationError(`Stack underflow accessing element at index ${a}. Stack length is ${this.stack.length}.`),this.stack[this.stack.length+a]}pushAltStack(a){this.ensureAltStackMem(a.length),this.altStack.push(a),this.altStackMem+=a.length}popAltStack(){0===this.altStack.length&&this.scriptEvaluationError("Attempted to pop from an empty alt stack.");let a=this.altStack.pop();return this.altStackMem-=a.length,a}checkSignatureEncoding(a){if(0===a.length)return!0;if(!function(a){if(a.length<9||a.length>73||48!==a[0]||a[1]!==a.length-3)return!1;let b=a[2],c=a[3];if(2!==b||0===c||5+c>=a.length)return!1;let d=4+c,e=a[d],f=a[d+1];if(2!==e||0===f||(128&a[4])!=0||c>1&&0===a[4]&&(128&a[5])==0)return!1;let g=d+2;return(128&a[g])==0&&(!(f>1)||0!==a[g]||(128&a[g+1])!=0)&&c+f+7===a.length}(a))return this.scriptEvaluationError("The signature format is invalid."),!1;try{let b=k.default.fromChecksigFormat(a);if(!b.hasLowS())return this.scriptEvaluationError("The signature must have a low S value."),!1;if((b.scope&k.default.SIGHASH_FORKID)==0)return this.scriptEvaluationError("The signature must use SIGHASH_FORKID."),!1}catch(a){return this.scriptEvaluationError("The signature format is invalid."),!1}return!0}checkPublicKeyEncoding(a){if(0===a.length)return this.scriptEvaluationError("Public key is empty."),!1;if(a.length<33)return this.scriptEvaluationError("The public key is too short, it must be at least 33 bytes."),!1;if(4===a[0]){if(65!==a.length)return this.scriptEvaluationError("The non-compressed public key must be 65 bytes."),!1}else if(2!==a[0]&&3!==a[0])return this.scriptEvaluationError("The public key is in an unknown format."),!1;else if(33!==a.length)return this.scriptEvaluationError("The compressed public key must be 33 bytes."),!1;try{l.default.fromDER(a)}catch(a){return this.scriptEvaluationError("The public key is in an unknown format."),!1}return!0}verifySignature(a,b,c){let d=k.default.format({sourceTXID:this.sourceTXID,sourceOutputIndex:this.sourceOutputIndex,sourceSatoshis:this.sourceSatoshis,transactionVersion:this.transactionVersion,otherInputs:this.otherInputs,outputs:this.outputs,inputIndex:this.inputIndex,subscript:c,inputSequence:this.inputSequence,lockTime:this.lockTime,scope:a.scope}),e=new f.default(j.hash256(d));return(0,m.verify)(e,a,b)}step(){if(this.stackMem>this.memoryLimit)return this.scriptEvaluationError("Stack memory usage has exceeded "+String(this.memoryLimit)+" bytes"),!1;if(this.altStackMem>this.memoryLimit)return this.scriptEvaluationError("Alt stack memory usage has exceeded "+String(this.memoryLimit)+" bytes"),!1;"UnlockingScript"===this.context&&this.programCounter>=this.unlockingScript.chunks.length&&(this.context="LockingScript",this.programCounter=0);let a="UnlockingScript"===this.context?this.unlockingScript:this.lockingScript;if(this.programCounter>=a.chunks.length)return!1;let c=a.chunks[this.programCounter],d=c.op;void 0===d&&this.scriptEvaluationError(`Missing opcode in ${this.context} at pc=${this.programCounter}.`),Array.isArray(c.data)&&c.data.length>0x40000000&&this.scriptEvaluationError(`Data push > 1073741824 bytes (pc=${this.programCounter}).`);let h=!this.ifStack.includes(!1);if(h&&(d===b.OP_2MUL||d===b.OP_2DIV||d===b.OP_VERIF||d===b.OP_VERNOTIF||d===b.OP_VER)&&this.scriptEvaluationError(`This opcode is currently disabled. (Opcode: ${b[d]}, PC: ${this.programCounter})`),h&&d>=0&&d<=b.OP_PUSHDATA4){let a,d;a=c.data,d=c.op,Array.isArray(a)&&(0===a.length?d!==b.OP_0:1===a.length&&a[0]>=1&&a[0]<=16?d!==b.OP_1+(a[0]-1):1===a.length&&129===a[0]?d!==b.OP_1NEGATE:a.length<=75?d!==a.length:a.length<=255?d!==b.OP_PUSHDATA1:a.length<=65535&&d!==b.OP_PUSHDATA2)&&this.scriptEvaluationError(`This data is not minimally-encoded. (PC: ${this.programCounter})`),this.pushStack(Array.isArray(c.data)?c.data:[])}else if(h||d>=b.OP_IF&&d<=b.OP_ENDIF){let a,c,i,m,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;switch(d){case b.OP_1NEGATE:this.pushStackCopy(n);break;case b.OP_0:this.pushStackCopy(o[0]);break;case b.OP_1:case b.OP_2:case b.OP_3:case b.OP_4:case b.OP_5:case b.OP_6:case b.OP_7:case b.OP_8:case b.OP_9:case b.OP_10:case b.OP_11:case b.OP_12:case b.OP_13:case b.OP_14:case b.OP_15:case b.OP_16:w=d-(b.OP_1-1),this.pushStackCopy(o[w]);break;case b.OP_NOP:case b.OP_NOP2:case b.OP_NOP3:case b.OP_NOP1:case b.OP_NOP4:case b.OP_NOP5:case b.OP_NOP6:case b.OP_NOP7:case b.OP_NOP8:case b.OP_NOP9:case b.OP_NOP10:case b.OP_NOP11:case b.OP_NOP12:case b.OP_NOP13:case b.OP_NOP14:case b.OP_NOP15:case b.OP_NOP16:case b.OP_NOP17:case b.OP_NOP18:case b.OP_NOP19:case b.OP_NOP20:case b.OP_NOP21:case b.OP_NOP22:case b.OP_NOP23:case b.OP_NOP24:case b.OP_NOP25:case b.OP_NOP26:case b.OP_NOP27:case b.OP_NOP28:case b.OP_NOP29:case b.OP_NOP30:case b.OP_NOP31:case b.OP_NOP32:case b.OP_NOP33:case b.OP_NOP34:case b.OP_NOP35:case b.OP_NOP36:case b.OP_NOP37:case b.OP_NOP38:case b.OP_NOP39:case b.OP_NOP40:case b.OP_NOP41:case b.OP_NOP42:case b.OP_NOP43:case b.OP_NOP44:case b.OP_NOP45:case b.OP_NOP46:case b.OP_NOP47:case b.OP_NOP48:case b.OP_NOP49:case b.OP_NOP50:case b.OP_NOP51:case b.OP_NOP52:case b.OP_NOP53:case b.OP_NOP54:case b.OP_NOP55:case b.OP_NOP56:case b.OP_NOP57:case b.OP_NOP58:case b.OP_NOP59:case b.OP_NOP60:case b.OP_NOP61:case b.OP_NOP62:case b.OP_NOP63:case b.OP_NOP64:case b.OP_NOP65:case b.OP_NOP66:case b.OP_NOP67:case b.OP_NOP68:case b.OP_NOP69:case b.OP_NOP70:case b.OP_NOP71:case b.OP_NOP72:case b.OP_NOP73:case b.OP_NOP77:break;case b.OP_IF:case b.OP_NOTIF:y=!1,h&&(this.stack.length<1&&this.scriptEvaluationError("OP_IF and OP_NOTIF require at least one item on the stack when they are used!"),a=this.popStack(),y=this.castToBool(a),d===b.OP_NOTIF&&(y=!y)),this.ifStack.push(y);break;case b.OP_ELSE:0===this.ifStack.length&&this.scriptEvaluationError("OP_ELSE requires a preceeding OP_IF."),this.ifStack[this.ifStack.length-1]=!this.ifStack[this.ifStack.length-1];break;case b.OP_ENDIF:0===this.ifStack.length&&this.scriptEvaluationError("OP_ENDIF requires a preceeding OP_IF."),this.ifStack.pop();break;case b.OP_VERIFY:this.stack.length<1&&this.scriptEvaluationError("OP_VERIFY requires at least one item to be on the stack."),c=this.stackTop(),(y=this.castToBool(c))||this.scriptEvaluationError("OP_VERIFY requires the top stack value to be truthy."),this.popStack();break;case b.OP_RETURN:"UnlockingScript"===this.context?this.programCounter=this.unlockingScript.chunks.length:this.programCounter=this.lockingScript.chunks.length,this.ifStack=[],this.programCounter--;break;case b.OP_TOALTSTACK:this.stack.length<1&&this.scriptEvaluationError("OP_TOALTSTACK requires at oeast one item to be on the stack."),this.pushAltStack(this.popStack());break;case b.OP_FROMALTSTACK:this.altStack.length<1&&this.scriptEvaluationError("OP_FROMALTSTACK requires at least one item to be on the stack."),this.pushStack(this.popAltStack());break;case b.OP_2DROP:this.stack.length<2&&this.scriptEvaluationError("OP_2DROP requires at least two items to be on the stack."),this.popStack(),this.popStack();break;case b.OP_2DUP:this.stack.length<2&&this.scriptEvaluationError("OP_2DUP requires at least two items to be on the stack."),c=this.stackTop(-2),i=this.stackTop(-1),this.pushStackCopy(c),this.pushStackCopy(i);break;case b.OP_3DUP:this.stack.length<3&&this.scriptEvaluationError("OP_3DUP requires at least three items to be on the stack."),c=this.stackTop(-3),i=this.stackTop(-2),m=this.stackTop(-1),this.pushStackCopy(c),this.pushStackCopy(i),this.pushStackCopy(m);break;case b.OP_2OVER:this.stack.length<4&&this.scriptEvaluationError("OP_2OVER requires at least four items to be on the stack."),c=this.stackTop(-4),i=this.stackTop(-3),this.pushStackCopy(c),this.pushStackCopy(i);break;case b.OP_2ROT:{this.stack.length<6&&this.scriptEvaluationError("OP_2ROT requires at least six items to be on the stack.");let a=this.popStack(),b=this.popStack(),c=this.popStack(),d=this.popStack(),e=this.popStack(),f=this.popStack();this.pushStack(d),this.pushStack(c),this.pushStack(b),this.pushStack(a),this.pushStack(f),this.pushStack(e);break}case b.OP_2SWAP:{this.stack.length<4&&this.scriptEvaluationError("OP_2SWAP requires at least four items to be on the stack.");let a=this.popStack(),b=this.popStack(),c=this.popStack(),d=this.popStack();this.pushStack(b),this.pushStack(a),this.pushStack(d),this.pushStack(c);break}case b.OP_IFDUP:this.stack.length<1&&this.scriptEvaluationError("OP_IFDUP requires at least one item to be on the stack."),c=this.stackTop(),this.castToBool(c)&&this.pushStackCopy(c);break;case b.OP_DEPTH:this.pushStack(new f.default(this.stack.length).toScriptNum());break;case b.OP_DROP:this.stack.length<1&&this.scriptEvaluationError("OP_DROP requires at least one item to be on the stack."),this.popStack();break;case b.OP_DUP:this.stack.length<1&&this.scriptEvaluationError("OP_DUP requires at least one item to be on the stack."),this.pushStackCopy(this.stackTop());break;case b.OP_NIP:this.stack.length<2&&this.scriptEvaluationError("OP_NIP requires at least two items to be on the stack."),i=this.popStack(),this.popStack(),this.pushStack(i);break;case b.OP_OVER:this.stack.length<2&&this.scriptEvaluationError("OP_OVER requires at least two items to be on the stack."),this.pushStackCopy(this.stackTop(-2));break;case b.OP_PICK:case b.OP_ROLL:{this.stack.length<2&&this.scriptEvaluationError(`${b[d]} requires at least two items to be on the stack.`),((w=(s=f.default.fromScriptNum(this.popStack(),!0)).toNumber())<0||w>=this.stack.length)&&this.scriptEvaluationError(`${b[d]} requires the top stack element to be 0 or a positive number less than the current size of the stack.`);let a=this.stack[this.stack.length-1-w];d===b.OP_ROLL?(this.stack.splice(this.stack.length-1-w,1),this.stackMem-=a.length,this.pushStack(a)):this.pushStackCopy(a);break}case b.OP_ROT:this.stack.length<3&&this.scriptEvaluationError("OP_ROT requires at least three items to be on the stack."),r=this.popStack(),q=this.popStack(),p=this.popStack(),this.pushStack(q),this.pushStack(r),this.pushStack(p);break;case b.OP_SWAP:this.stack.length<2&&this.scriptEvaluationError("OP_SWAP requires at least two items to be on the stack."),q=this.popStack(),p=this.popStack(),this.pushStack(q),this.pushStack(p);break;case b.OP_TUCK:this.stack.length<2&&this.scriptEvaluationError("OP_TUCK requires at least two items to be on the stack."),c=this.stackTop(-1),this.ensureStackMem(c.length),this.stack.splice(this.stack.length-2,0,c.slice()),this.stackMem+=c.length;break;case b.OP_SIZE:this.stack.length<1&&this.scriptEvaluationError("OP_SIZE requires at least one item to be on the stack."),this.pushStack(new f.default(this.stackTop().length).toScriptNum());break;case b.OP_AND:case b.OP_OR:case b.OP_XOR:{this.stack.length<2&&this.scriptEvaluationError(`${b[d]} requires at least two items on the stack.`),i=this.popStack(),(c=this.popStack()).length!==i.length&&this.scriptEvaluationError(`${b[d]} requires the top two stack items to be the same size.`);let a=Array(c.length);for(let e=0;e<c.length;e++)d===b.OP_AND?a[e]=c[e]&i[e]:d===b.OP_OR?a[e]=c[e]|i[e]:a[e]=c[e]^i[e];this.pushStack(a);break}case b.OP_INVERT:{this.stack.length<1&&this.scriptEvaluationError("OP_INVERT requires at least one item to be on the stack.");let b=Array((a=this.popStack()).length);for(let c=0;c<a.length;c++)b[c]=255&~a[c];this.pushStack(b);break}case b.OP_LSHIFT:case b.OP_RSHIFT:{if(this.stack.length<2&&this.scriptEvaluationError(`${b[d]} requires at least two items to be on the stack.`),u=f.default.fromScriptNum(this.popStack(),!0),c=this.popStack(),(w=u.toNumber())<0&&this.scriptEvaluationError(`${b[d]} requires the top item on the stack not to be negative.`),0===c.length){this.pushStack([]);break}t=new f.default(c);let a=(d===b.OP_LSHIFT?t.ushln(w):t.ushrn(w)).toArray("le",c.length);this.pushStack(a);break}case b.OP_EQUAL:case b.OP_EQUALVERIFY:this.stack.length<2&&this.scriptEvaluationError(`${b[d]} requires at least two items to be on the stack.`),i=this.popStack(),y=function(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}(c=this.popStack(),i),this.pushStack(y?[1]:[]),d===b.OP_EQUALVERIFY&&(y||this.scriptEvaluationError("OP_EQUALVERIFY requires the top two stack items to be equal."),this.popStack());break;case b.OP_1ADD:case b.OP_1SUB:case b.OP_NEGATE:case b.OP_ABS:case b.OP_NOT:case b.OP_0NOTEQUAL:switch(this.stack.length<1&&this.scriptEvaluationError(`${b[d]} requires at least one item to be on the stack.`),s=f.default.fromScriptNum(this.popStack(),!0),d){case b.OP_1ADD:s=s.add(new f.default(1));break;case b.OP_1SUB:s=s.sub(new f.default(1));break;case b.OP_NEGATE:s=s.neg();break;case b.OP_ABS:s.isNeg()&&(s=s.neg());break;case b.OP_NOT:s=new f.default(+(0===s.cmpn(0)));break;case b.OP_0NOTEQUAL:s=new f.default(+(0!==s.cmpn(0)))}this.pushStack(s.toScriptNum());break;case b.OP_ADD:case b.OP_SUB:case b.OP_MUL:case b.OP_DIV:case b.OP_MOD:case b.OP_BOOLAND:case b.OP_BOOLOR:case b.OP_NUMEQUAL:case b.OP_NUMEQUALVERIFY:case b.OP_NUMNOTEQUAL:case b.OP_LESSTHAN:case b.OP_GREATERTHAN:case b.OP_LESSTHANOREQUAL:case b.OP_GREATERTHANOREQUAL:case b.OP_MIN:case b.OP_MAX:{this.stack.length<2&&this.scriptEvaluationError(`${b[d]} requires at least two items to be on the stack.`),i=this.popStack(),c=this.popStack(),u=f.default.fromScriptNum(i,!0),t=f.default.fromScriptNum(c,!0);let a=0;switch(d){case b.OP_MUL:a=t.byteLength()+u.byteLength();break;case b.OP_ADD:case b.OP_SUB:a=Math.max(t.byteLength(),u.byteLength())+1;break;default:a=Math.max(t.byteLength(),u.byteLength())}this.ensureStackMem(a);let e=new f.default(0);switch(d){case b.OP_ADD:e=t.add(u);break;case b.OP_SUB:e=t.sub(u);break;case b.OP_MUL:e=t.mul(u);break;case b.OP_DIV:0===u.cmpn(0)&&this.scriptEvaluationError("OP_DIV cannot divide by zero!"),e=t.div(u);break;case b.OP_MOD:0===u.cmpn(0)&&this.scriptEvaluationError("OP_MOD cannot divide by zero!"),e=t.mod(u);break;case b.OP_BOOLAND:e=new f.default(+(0!==t.cmpn(0)&&0!==u.cmpn(0)));break;case b.OP_BOOLOR:e=new f.default(+(0!==t.cmpn(0)||0!==u.cmpn(0)));break;case b.OP_NUMEQUAL:case b.OP_NUMEQUALVERIFY:e=new f.default(+(0===t.cmp(u)));break;case b.OP_NUMNOTEQUAL:e=new f.default(+(0!==t.cmp(u)));break;case b.OP_LESSTHAN:e=new f.default(+(0>t.cmp(u)));break;case b.OP_GREATERTHAN:e=new f.default(+(t.cmp(u)>0));break;case b.OP_LESSTHANOREQUAL:e=new f.default(+(0>=t.cmp(u)));break;case b.OP_GREATERTHANOREQUAL:e=new f.default(+(t.cmp(u)>=0));break;case b.OP_MIN:e=0>t.cmp(u)?t:u;break;case b.OP_MAX:e=t.cmp(u)>0?t:u}this.pushStack(e.toScriptNum()),d===b.OP_NUMEQUALVERIFY&&(this.castToBool(this.stackTop())||this.scriptEvaluationError("OP_NUMEQUALVERIFY requires the top stack item to be truthy."),this.popStack());break}case b.OP_WITHIN:this.stack.length<3&&this.scriptEvaluationError("OP_WITHIN requires at least three items to be on the stack."),v=f.default.fromScriptNum(this.popStack(),!0),u=f.default.fromScriptNum(this.popStack(),!0),y=(t=f.default.fromScriptNum(this.popStack(),!0)).cmp(u)>=0&&0>t.cmp(v),this.pushStack(y?[1]:[]);break;case b.OP_RIPEMD160:case b.OP_SHA1:case b.OP_SHA256:case b.OP_HASH160:case b.OP_HASH256:{this.stack.length<1&&this.scriptEvaluationError(`${b[d]} requires at least one item to be on the stack.`),a=this.popStack();let c=[];d===b.OP_RIPEMD160?c=j.ripemd160(a):d===b.OP_SHA1?c=j.sha1(a):d===b.OP_SHA256?c=j.sha256(a):d===b.OP_HASH160?c=j.hash160(a):d===b.OP_HASH256&&(c=j.hash256(a)),this.pushStack(c);break}case b.OP_CODESEPARATOR:this.lastCodeSeparator=this.programCounter;break;case b.OP_CHECKSIG:case b.OP_CHECKSIGVERIFY:if(this.stack.length<2&&this.scriptEvaluationError(`${b[d]} requires at least two items to be on the stack.`),C=this.popStack(),B=this.popStack(),this.checkSignatureEncoding(B)&&this.checkPublicKeyEncoding(C)||this.scriptEvaluationError(`${b[d]} requires correct encoding for the public key and signature.`),(A=new g(("UnlockingScript"===this.context?this.unlockingScript:this.lockingScript).chunks.slice(null===this.lastCodeSeparator?0:this.lastCodeSeparator+1))).findAndDelete(new g().writeBin(B)),z=!1,B.length>0)try{D=k.default.fromChecksigFormat(B),E=l.default.fromDER(C),z=this.verifySignature(D,E,A)}catch(a){z=!1}this.pushStack(z?[1]:[]),d===b.OP_CHECKSIGVERIFY&&(z||this.scriptEvaluationError("OP_CHECKSIGVERIFY requires that a valid signature is provided."),this.popStack());break;case b.OP_CHECKMULTISIG:case b.OP_CHECKMULTISIGVERIFY:{F=1,this.stack.length<F&&this.scriptEvaluationError(`${b[d]} requires at least 1 item for nKeys.`),((I=f.default.fromScriptNum(this.stackTop(-F),!0).toNumber())<0||I>0x7fffffff)&&this.scriptEvaluationError(`${b[d]} requires a key count between 0 and 2147483647.`),G=++F,F+=I,this.stack.length<F&&this.scriptEvaluationError(`${b[d]} stack too small for nKeys and keys. Need ${F}, have ${this.stack.length}.`),((J=f.default.fromScriptNum(this.stackTop(-F),!0).toNumber())<0||J>I)&&this.scriptEvaluationError(`${b[d]} requires the number of signatures to be no greater than the number of keys.`),H=++F,F+=J,this.stack.length<F&&this.scriptEvaluationError(`${b[d]} stack too small for N, keys, M, sigs, and dummy. Need ${F}, have ${this.stack.length}.`),A=new g(("UnlockingScript"===this.context?this.unlockingScript:this.lockingScript).chunks.slice(null===this.lastCodeSeparator?0:this.lastCodeSeparator+1));for(let a=0;a<J;a++)B=this.stackTop(-H-a),A.findAndDelete(new g().writeBin(B));for(z=!0;z&&J>0;){if(0===I){z=!1;break}if(B=this.stackTop(-H),C=this.stackTop(-G),this.checkSignatureEncoding(B)&&this.checkPublicKeyEncoding(C)||this.scriptEvaluationError(`${b[d]} requires correct encoding for the public key and signature.`),K=!1,B.length>0)try{D=k.default.fromChecksigFormat(B),E=l.default.fromDER(C),K=this.verifySignature(D,E,A)}catch(a){K=!1}K&&(H++,J--),G++,J>--I&&(z=!1)}let a=1+f.default.fromScriptNum(this.stackTop(-1),!1).toNumber()+1+f.default.fromScriptNum(this.stackTop(-(1+f.default.fromScriptNum(this.stackTop(-1),!1).toNumber()+1)),!1).toNumber()+1-1;for(;a>0;)this.popStack(),a--;this.stack.length<1&&this.scriptEvaluationError(`${b[d]} requires an extra item (dummy) to be on the stack.`),this.popStack().length>0&&this.scriptEvaluationError(`${b[d]} requires the extra stack item (dummy) to be empty.`),this.pushStack(z?[1]:[]),d===b.OP_CHECKMULTISIGVERIFY&&(z||this.scriptEvaluationError("OP_CHECKMULTISIGVERIFY requires that a sufficient number of valid signatures are provided."),this.popStack());break}case b.OP_CAT:{this.stack.length<2&&this.scriptEvaluationError("OP_CAT requires at least two items to be on the stack."),i=this.popStack();let a=(c=this.popStack()).concat(i);a.length>0x40000000&&this.scriptEvaluationError("It's not currently possible to push data larger than 1073741824 bytes."),this.pushStack(a);break}case b.OP_SPLIT:{this.stack.length<2&&this.scriptEvaluationError("OP_SPLIT requires at least two items to be on the stack.");let a=this.popStack(),b=this.popStack();((w=f.default.fromScriptNum(a,!0).toNumber())<0||w>b.length)&&this.scriptEvaluationError("OP_SPLIT requires the first stack item to be a non-negative number less than or equal to the size of the second-from-top stack item."),this.pushStack(b.slice(0,w)),this.pushStack(b.slice(w));break}case b.OP_NUM2BIN:{this.stack.length<2&&this.scriptEvaluationError("OP_NUM2BIN requires at least two items to be on the stack."),((x=f.default.fromScriptNum(this.popStack(),!0).toNumber())>0x40000000||x<0)&&this.scriptEvaluationError("It's not currently possible to push data larger than 1073741824 bytes or negative size.");let a=this.popStack();if((a=(0,e.minimallyEncode)(a)).length>x&&this.scriptEvaluationError("OP_NUM2BIN requires that the size expressed in the top stack item is large enough to hold the value expressed in the second-from-top stack item."),a.length===x){this.pushStack(a);break}let b=Array(x).fill(0),c=0;a.length>0&&(c=128&a[a.length-1],a[a.length-1]&=127);for(let c=0;c<a.length;c++)b[c]=a[c];0!==c&&(b[x-1]|=128),this.pushStack(b);break}case b.OP_BIN2NUM:{this.stack.length<1&&this.scriptEvaluationError("OP_BIN2NUM requires at least one item to be on the stack."),c=this.popStack();let a=(0,e.minimallyEncode)(c);!function(a,b=Number.MAX_SAFE_INTEGER){return!(a.length>b)&&(!(a.length>0)||(127&a[a.length-1])!=0||!(a.length<=1)&&(128&a[a.length-2])!=0)}(a)&&this.scriptEvaluationError("OP_BIN2NUM requires that the resulting number is valid."),this.pushStack(a);break}default:this.scriptEvaluationError(`Invalid opcode ${d} (pc=${this.programCounter}).`)}}return this.programCounter++,!0}validate(){for(this.unlockingScript.isPushOnly()||this.scriptEvaluationError("Unlocking scripts can only contain push operations, and no other opcodes.");this.step()&&("LockingScript"!==this.context||!(this.programCounter>=this.lockingScript.chunks.length)););return this.ifStack.length>0&&this.scriptEvaluationError("Every OP_IF, OP_NOTIF, or OP_ELSE must be terminated with OP_ENDIF prior to the end of the script."),1!==this.stack.length&&this.scriptEvaluationError(`The clean stack rule requires exactly one item to be on the stack after script execution, found ${this.stack.length}.`),0===this.stack.length?this.scriptEvaluationError("The top stack element must be truthy after script evaluation (stack is empty)."):this.castToBool(this.stackTop())||this.scriptEvaluationError("The top stack element must be truthy after script evaluation."),!0}castToBool(a){if(0===a.length)return!1;for(let b=0;b<a.length;b++)if(0!==a[b])return b!==a.length-1||128!==a[b];return!1}scriptEvaluationError(a){let b=`Context: ${this.context}, PC: ${this.programCounter}`,c=this.stack.map(a=>null!=a&&void 0!==a.length?(0,e.toHex)(a):null==a?"null/undef":"INVALID_STACK_ITEM").join(", "),d=this.altStack.map(a=>null!=a&&void 0!==a.length?(0,e.toHex)(a):null==a?"null/undef":"INVALID_STACK_ITEM").join(", "),f=`Stack: [${c}] (len: ${this.stack.length}, mem: ${this.stackMem})`,g=`AltStack: [${d}] (len: ${this.altStack.length}, mem: ${this.altStackMem})`,h=`IfStack: [${this.ifStack.join(", ")}]`;throw Error(`Script evaluation error: ${a}
TXID: ${this.sourceTXID}, OutputIdx: ${this.sourceOutputIndex}
${b}
${f}
${g}
${h}`)}}function q(a){if(null==a)throw Error("must have value");return a}a.s(["default",()=>p],72216);class r{lock(a){let c;if("string"==typeof a){let b=(0,e.fromBase58Check)(a);if(0!==b.prefix[0]&&111!==b.prefix[0])throw Error("only P2PKH is supported");c=b.data}else c=a;if(20!==c.length)throw Error("P2PKH hash length must be 20 bytes");return new h([{op:b.OP_DUP},{op:b.OP_HASH160},{op:c.length,data:c},{op:b.OP_EQUALVERIFY},{op:b.OP_CHECKSIG}])}unlock(a,b="all",c=!1,d,e){return{sign:async(f,g)=>{let h=k.default.SIGHASH_FORKID;"all"===b&&(h|=k.default.SIGHASH_ALL),"none"===b&&(h|=k.default.SIGHASH_NONE),"single"===b&&(h|=k.default.SIGHASH_SINGLE),c&&(h|=k.default.SIGHASH_ANYONECANPAY);let l=f.inputs[g],m=f.inputs.filter((a,b)=>b!==g),n=l.sourceTXID??l.sourceTransaction?.id("hex");if(null==n||void 0===n||""===n)throw Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(null==(d||=l.sourceTransaction?.outputs[l.sourceOutputIndex].satoshis)||void 0===d)throw Error("The sourceSatoshis or input sourceTransaction is required for transaction signing.");if(null==(e||=l.sourceTransaction?.outputs[l.sourceOutputIndex].lockingScript))throw Error("The lockingScript or input sourceTransaction is required for transaction signing.");let o=k.default.format({sourceTXID:n,sourceOutputIndex:q(l.sourceOutputIndex),sourceSatoshis:d,transactionVersion:f.version,otherInputs:m,inputIndex:g,outputs:f.outputs,inputSequence:q(l.sequence),subscript:e,lockTime:f.lockTime,scope:h}),p=a.sign((0,j.sha256)(o)),r=new k.default(p.r,p.s,h).toChecksigFormat(),s=a.toPublicKey().encode(!0);return new i([{op:r.length,data:r},{op:s.length,data:s}])},estimateLength:async()=>108}}}a.s(["default",()=>r],76556),a.s(["default",()=>J],79289);class s{value;constructor(a){this.value=a}async computeFee(a){let b,c=a=>a>0x100000000?9:a>65536?5:a>253?3:1;b=4+c(a.inputs.length);for(let d=0;d<a.inputs.length;d++){let e,f=a.inputs[d];if(b+=40,"object"==typeof f.unlockingScript)e=f.unlockingScript.toBinary().length;else if("object"==typeof f.unlockingScriptTemplate)e=await f.unlockingScriptTemplate.estimateLength(a,d);else throw Error("All inputs must have an unlocking script or an unlocking script template for sat/kb fee computation.");b+=c(e),b+=e}for(let d of(b+=c(a.outputs.length),a.outputs)){b+=8;let a=d.lockingScript.toBinary().length;b+=c(a),b+=a}return Math.ceil((b+=4)/1e3*this.value)}}a.s(["default",()=>s],35581);class t{https;constructor(a){this.https=a}async request(a,b){return await new Promise((c,d)=>{let e=this.https.request(a,b,a=>{let b="";a.on("data",a=>{b+=a}),a.on("end",()=>{let d=a.statusCode>=200&&a.statusCode<=299,e=a.headers["content-type"],f=""!==b&&"string"==typeof e&&e.startsWith("application/json")?JSON.parse(b):b;c({status:a.statusCode,statusText:a.statusMessage,ok:d,data:f})})});e.on("error",a=>{d(a)}),null!==b.data&&void 0!==b.data&&e.write(JSON.stringify(b.data)),e.end()})}}a.s(["NodejsHttpClient",()=>t],18792);class u{fetch;constructor(a){this.fetch=a}async request(a,b){let c={method:b.method,headers:b.headers,body:JSON.stringify(b.data)},d=await this.fetch(a,c),e=d.headers.get("Content-Type"),f=e?.startsWith("application/json")?await d.json():await d.text();return{ok:d.ok,status:d.status,statusText:d.statusText,data:f}}}function v(){try{let b=a.r(24836);return new t(b)}catch(a){return{async request(){throw Error("No method available to perform HTTP request")}}}}a.s(["FetchHttpClient",()=>u],83818),a.s(["defaultHttpClient",()=>v],43172);var w=a.i(60933);function x(){return`ts-sdk-${(0,e.toHex)((0,w.default)(16))}`}class y{URL;apiKey;deploymentId;callbackUrl;callbackToken;headers;httpClient;constructor(a,b){if(this.URL=a,"string"==typeof b)this.apiKey=b,this.httpClient=v(),this.deploymentId=x(),this.callbackToken=void 0,this.callbackUrl=void 0;else{const{apiKey:a,deploymentId:c,httpClient:d,callbackToken:e,callbackUrl:f,headers:g}=b??{};this.apiKey=a,this.httpClient=d??v(),this.deploymentId=c??x(),this.callbackToken=e,this.callbackUrl=f,this.headers=g}}requestHeaders(){let a={"Content-Type":"application/json","XDeployment-ID":this.deploymentId};if(null!=this.apiKey&&""!==this.apiKey&&(a.Authorization=`Bearer ${this.apiKey}`),null!=this.callbackUrl&&""!==this.callbackUrl&&(a["X-CallbackUrl"]=this.callbackUrl),null!=this.callbackToken&&""!==this.callbackToken&&(a["X-CallbackToken"]=this.callbackToken),null!=this.headers)for(let b in this.headers)a[b]=this.headers[b];return a}async broadcast(a){let b;try{b=a.toHexEF()}catch(c){if("All inputs must have source transactions when serializing to EF format"===c.message)b=a.toHex();else throw c}let c={method:"POST",headers:this.requestHeaders(),data:{rawTx:b}};try{let a=await this.httpClient.request(`${this.URL}/v1/tx`,c);if(a.ok){let{txid:b,extraInfo:c,txStatus:d,competingTxs:e}=a.data,f={status:"success",txid:b,message:`${d} ${c}`};return null!=e&&(f.competingTxs=e),f}{let b=typeof a.status,c={status:"error",code:"number"===b||"string"===b?a.status.toString():"ERR_UNKNOWN",description:"Unknown error"},d=a.data;if("string"==typeof d)try{d=JSON.parse(a.data)}catch{}return"object"==typeof d&&(null!==d&&(c.more=d),null!=d&&"string"==typeof d.txid&&(c.txid=d.txid),null!=d&&"detail"in d&&"string"==typeof d.detail&&(c.description=d.detail)),c}}catch(a){return{status:"error",code:"500",description:"string"==typeof a.message?a.message:"Internal Server Error"}}}async broadcastMany(a){let b=a.map(a=>{try{return{rawTx:a.toHexEF()}}catch(b){if("All inputs must have source transactions when serializing to EF format"===b.message)return{rawTx:a.toHex()};throw b}}),c={method:"POST",headers:this.requestHeaders(),data:b};try{return(await this.httpClient.request(`${this.URL}/v1/txs`,c)).data}catch(c){let b={status:"error",code:"500",description:"string"==typeof c.message?c.message:"Internal Server Error"};return a.map(()=>b)}}}function z(a=!1,b={}){return new y(a?"https://arc-test.taal.com":"https://arc.taal.com",b)}a.s(["default",()=>y],76735),a.s(["defaultBroadcaster",()=>z],91512);class A{network;apiKey;URL;httpClient;constructor(a="main",b={}){const{apiKey:c,httpClient:d}=b;this.network=a,this.URL=`https://api.whatsonchain.com/v1/bsv/${a}`,this.httpClient=d??v(),this.apiKey=c??""}async isValidRootForHeight(a,b){let c={method:"GET",headers:this.getHttpHeaders()},d=await this.httpClient.request(`${this.URL}/block/${b}/header`,c);if(d.ok){let{merkleroot:b}=d.data;return b===a}if(404===d.status)return!1;throw Error(`Failed to verify merkleroot for height ${b} because of an error: ${JSON.stringify(d.data)} `)}async currentHeight(){try{let a={method:"GET",headers:this.getHttpHeaders()},b=await this.httpClient.request(`${this.URL}/block/headers`,a);if(b.ok)return b.data[0].height;throw Error(`Failed to get current height because of an error: ${JSON.stringify(b.data)} `)}catch(a){throw Error(`Failed to get current height because of an error: ${a instanceof Error?a.message:String(a)}`)}}getHttpHeaders(){let a={Accept:"application/json"};return"string"==typeof this.apiKey&&""!==this.apiKey.trim()&&(a.Authorization=this.apiKey),a}}function B(){return new A}a.s(["default",()=>A],38498),a.s(["defaultChainTracker",()=>B],41089),a.s(["ATOMIC_BEEF",()=>H,"BEEF_V1",()=>F,"BEEF_V2",()=>G,"Beef",()=>I,"TX_DATA_FORMAT",()=>d],43337);class C{blockHeight;path;static fromHex(a){return C.fromBinary((0,e.toArray)(a,"hex"))}static fromReader(a,b=!0){let c,d,f,g=a.readVarIntNum(),h=a.readUInt8(),i=Array(h).fill(null).map(()=>[]);for(let b=0;b<h;b++){for(f=a.readVarIntNum();f>0;){d=a.readVarIntNum(),c=a.readUInt8();let g={offset:d};(1&c)!=0?g.duplicate=!0:((2&c)!=0&&(g.txid=!0),g.hash=(0,e.toHex)(a.read(32).reverse())),Array.isArray(i[b])&&0!==i[b].length||(i[b]=[]),i[b].push(g),f--}i[b].sort((a,b)=>a.offset-b.offset)}return new C(g,i,b)}static fromBinary(a){let b=new e.Reader(a);return C.fromReader(b)}static fromCoinbaseTxidAndHeight(a,b){return new C(b,[[{offset:0,hash:a,txid:!0}]])}constructor(a,b,c=!0){let d;this.blockHeight=a,this.path=b;const e=Array(this.path.length).fill(0).map(()=>new Set);this.path.forEach((a,b)=>{if(0===a.length&&0===b)throw Error(`Empty level at height: ${b}`);let d=new Set;a.forEach(a=>{if(d.has(a.offset))throw Error(`Duplicate offset: ${a.offset}, at height: ${b}`);if(d.add(a.offset),0===b){if(!0!==a.duplicate)for(let b=1;b<this.path.length;b++)e[b].add(a.offset>>b^1)}else if(c&&!e[b].has(a.offset))throw Error(`Invalid offset: ${a.offset}, at height: ${b}, with legal offsets: ${Array.from(e[b]).join(", ")}`)})}),this.path[0].forEach((a,b)=>{if(0===b&&(d=this.computeRoot(a.hash)),d!==this.computeRoot(a.hash))throw Error("Mismatched roots")})}toBinary(){let a=new e.Writer;a.writeVarIntNum(this.blockHeight);let b=this.path.length;a.writeUInt8(b);for(let c=0;c<b;c++){let b=Object.keys(this.path[c]).length;for(let d of(a.writeVarIntNum(b),this.path[c])){a.writeVarIntNum(d.offset);let b=0;d?.duplicate===!0&&(b|=1),d?.txid!==void 0&&null!==d.txid&&(b|=2),a.writeUInt8(b),(1&b)==0&&a.write((0,e.toArray)(d.hash,"hex").reverse())}}return a.toArray()}toHex(){return(0,e.toHex)(this.toBinary())}indexOf(a){let b=this.path[0].find(b=>b.hash===a);if(null==b)throw Error(`Transaction ID ${a} not found in the Merkle Path`);return b.offset}computeRoot(a){if("string"!=typeof a){let b=this.path[0].find(a=>!!a?.hash);if(null==b)throw Error("No valid leaf found in the Merkle Path");a=b.hash}if("string"!=typeof a)throw Error("Transaction ID is undefined");let b=this.indexOf(a);if("number"!=typeof b)throw Error(`This proof does not contain the txid: ${a??"undefined"}`);let c=a=>(0,e.toHex)((0,j.hash256)((0,e.toArray)(a,"hex").reverse()).reverse()),d=a;if(1===this.path.length&&1===this.path[0].length)return d;for(let a=0;a<this.path.length;a++){this.path[a];let e=b>>a^1,f=this.findOrComputeLeaf(a,e);if("object"!=typeof f)throw Error(`Missing hash for index ${b} at height ${a}`);d=c(!0===f.duplicate?(d??"")+(d??""):e%2!=0?(f.hash??"")+(d??""):(d??"")+(f.hash??""))}return d}findOrComputeLeaf(a,b){let c=a=>(0,e.toHex)((0,j.hash256)((0,e.toArray)(a,"hex").reverse()).reverse()),d=this.path[a].find(a=>a.offset===b);if(null!=d)return d;if(0===a)return;let f=a-1,g=b<<1,h=this.findOrComputeLeaf(f,g);if(null==h||null==h.hash||""===h.hash)return;let i=this.findOrComputeLeaf(f,g+1);if(null!=i)return{offset:b,hash:c(!0===i.duplicate?h.hash+h.hash:(i.hash??"")+(h.hash??""))}}async verify(a,b){let c=this.computeRoot(a);if(0===this.indexOf(a)){let a=await b.currentHeight();if(this.blockHeight+100<a)return!1}return await b.isValidRootForHeight(c,this.blockHeight)}combine(a){if(this.blockHeight!==a.blockHeight)throw Error("You cannot combine paths which do not have the same block height.");if(this.computeRoot()!==a.computeRoot())throw Error("You cannot combine paths which do not have the same root.");let b=[];for(let c=0;c<this.path.length;c++){b.push([]);for(let a=0;a<this.path[c].length;a++)b[c].push(this.path[c][a]);for(let d=0;d<a.path[c].length;d++)if(void 0===b[c].find(b=>b.offset===a.path[c][d].offset))b[c].push(a.path[c][d]);else if(a.path[c][d]?.txid!==void 0&&a.path[c][d]?.txid!==null){let e=b[c].find(b=>b.offset===a.path[c][d].offset);null!=e&&(e.txid=!0)}}this.path=b,this.trim()}trim(){let a=(a,b)=>{(0===b.length||b.slice(-1)[0]!==a)&&b.push(a)},b=(a,b)=>{for(let c=a.length;c>=0;c--){let d=this.path[b].findIndex(b=>b.offset===a[c]);d>=0&&this.path[b].splice(d,1)}},c=b=>{let c=[];for(let d of b)a(d>>1,c);return c},d=[],e=[];for(let a=0;a<this.path.length;a++)this.path[a].sort((a,b)=>a.offset-b.offset);for(let b=0;b<this.path[0].length;b++){let c=this.path[0][b];if(!0===c.txid)a(c.offset>>1,d);else{let d=c.offset%2==1,f=this.path[0][b+(d?-1:1)];void 0!==f.txid&&null!==f.txid&&f.txid||a(f.offset,e)}}b(e,0);for(let a=1;a<this.path.length;a++)e=d,d=c(d),b(e,a)}}a.s(["default",()=>C],27921),a.s(["default",()=>D],25721);class D{_bumpIndex;_tx;_rawTx;_txid;inputTxids=[];isValid=void 0;get bumpIndex(){return this._bumpIndex}set bumpIndex(a){this._bumpIndex=a,this.updateInputTxids()}get hasProof(){return void 0!==this._bumpIndex}get isTxidOnly(){return void 0!==this._txid&&null!==this._txid&&null==this._rawTx&&null==this._tx}get txid(){if(void 0!==this._txid&&null!==this._txid&&""!==this._txid)return this._txid;if(null!=this._tx)return this._txid=this._tx.id("hex"),this._txid;if(null!=this._rawTx)return this._txid=(0,e.toHex)((0,j.hash256)(this._rawTx)),this._txid;throw Error("Internal")}get tx(){return null!=this._tx?this._tx:null!=this._rawTx?(this._tx=J.fromBinary(this._rawTx),this._tx):void 0}get rawTx(){return null!=this._rawTx?this._rawTx:null!=this._tx?(this._rawTx=this._tx.toBinary(),this._rawTx):void 0}constructor(a,b){"string"==typeof a?this._txid=a:Array.isArray(a)?this._rawTx=a:this._tx=a,this.bumpIndex=b,this.updateInputTxids()}static fromTx(a,b){return new D(a,b)}static fromRawTx(a,b){return new D(a,b)}static fromTxid(a,b){return new D(a,b)}updateInputTxids(){if(this.hasProof||null==this.tx)this.inputTxids=[];else{let a={};for(let b of this.tx.inputs)void 0!==b.sourceTXID&&null!==b.sourceTXID&&""!==b.sourceTXID&&(a[b.sourceTXID]=!0);this.inputTxids=Object.keys(a)}}toWriter(a,b){let c=b=>{a.writeUInt8(b)},f=()=>{if(null==this._txid)throw Error("Transaction ID (_txid) is undefined");a.writeReverse((0,e.toArray)(this._txid,"hex"))},g=()=>{if(null!=this._rawTx)a.write(this._rawTx);else if(null!=this._tx)a.write(this._tx.toBinary());else throw Error("a valid serialized Transaction is expected")},h=()=>{void 0===this.bumpIndex?c(d.RAWTX):(c(d.RAWTX_AND_BUMP_INDEX),a.writeVarIntNum(this.bumpIndex))};b===G?this.isTxidOnly?(c(d.TXID_ONLY),f()):(void 0!==this.bumpIndex?(c(d.RAWTX_AND_BUMP_INDEX),a.writeVarIntNum(this.bumpIndex)):c(d.RAWTX),g()):(g(),h())}static fromReader(a,b){let c,f,g;if(b===G){let b=a.readUInt8();b===d.TXID_ONLY?g=D.fromTxid((0,e.toHex)(a.readReverse(32))):(b===d.RAWTX_AND_BUMP_INDEX&&(f=a.readVarIntNum()),c=J.fromReader(a),g=D.fromTx(c,f))}else c=J.fromReader(a),f=0!==a.readUInt8()?a.readVarIntNum():void 0,g=D.fromTx(c,f);return g}}function E(a){if(null==a)throw Error("Expected a valid value, but got undefined.");return a}let F=0xefbe0001,G=0xefbe0002,H=0x1010101;(c=d||(d={}))[c.RAWTX=0]="RAWTX",c[c.RAWTX_AND_BUMP_INDEX=1]="RAWTX_AND_BUMP_INDEX",c[c.TXID_ONLY=2]="TXID_ONLY";class I{bumps=[];txs=[];version=G;atomicTxid=void 0;constructor(a=G){this.version=a}findTxid(a){return this.txs.find(b=>b.txid===a)}makeTxidOnly(a){let b=this.txs.findIndex(b=>b.txid===a);if(-1===b)return;let c=this.txs[b];return c.isTxidOnly?c:(this.txs.splice(b,1),c=this.mergeTxidOnly(a))}findBump(a){return this.bumps.find(b=>b.path[0].some(b=>b.hash===a))}findTransactionForSigning(a){let b=this.findTxid(a);if(null!=b&&null!=b.tx){for(let a of b.tx.inputs)if(null==a.sourceTransaction){let b=this.findTxid(E(a.sourceTXID));null!=b&&(a.sourceTransaction=b.tx)}return b.tx}}findAtomicTransaction(a){let b=this.findTxid(a);if(null==b||null==b.tx)return;let c=(a,b)=>{let d=a.findBump(b.id("hex"));if(null!=d)b.merklePath=d;else for(let d of b.inputs){if(null==d.sourceTransaction){let b=a.findTxid(E(d.sourceTXID));null!=b&&(d.sourceTransaction=b.tx)}if(null!=d.sourceTransaction){let b=a.findBump(d.sourceTransaction.id("hex"));null!=b?d.sourceTransaction.merklePath=b:c(a,d.sourceTransaction)}}};return c(this,b.tx),b.tx}mergeBump(a){let b;for(let c=0;c<this.bumps.length;c++){let d=this.bumps[c];if(d===a)return c;if(d.blockHeight===a.blockHeight&&d.computeRoot()===a.computeRoot()){d.combine(a),b=c;break}}void 0===b&&(b=this.bumps.length,this.bumps.push(a));let c=this.bumps[b];for(let a of this.txs){let d=a.txid;if(null==a.bumpIndex){for(let e of c.path[0])if(e.hash===d){a.bumpIndex=b,e.txid=!0;break}}}return b}mergeRawTx(a,b){let c=new D(a,b);return this.removeExistingTxid(c.txid),this.txs.push(c),this.tryToValidateBumpIndex(c),c}mergeTransaction(a){let b,c=a.id("hex");this.removeExistingTxid(c),null!=a.merklePath&&(b=this.mergeBump(a.merklePath));let d=new D(a,b);if(this.txs.push(d),this.tryToValidateBumpIndex(d),void 0===(b=d.bumpIndex))for(let b of a.inputs)null!=b.sourceTransaction&&this.mergeTransaction(b.sourceTransaction);return d}removeExistingTxid(a){let b=this.txs.findIndex(b=>b.txid===a);b>=0&&this.txs.splice(b,1)}mergeTxidOnly(a){let b=this.txs.find(b=>b.txid===a);return null==b&&(b=new D(a),this.txs.push(b),this.tryToValidateBumpIndex(b)),b}mergeBeefTx(a){let b=this.findTxid(a.txid);if(a.isTxidOnly&&null==b?b=this.mergeTxidOnly(a.txid):null!=a._tx&&(null==b||b.isTxidOnly)?b=this.mergeTransaction(a._tx):null!=a._rawTx&&(null==b||b.isTxidOnly)&&(b=this.mergeRawTx(a._rawTx)),null==b)throw Error(`Failed to merge BeefTx for txid: ${a.txid}`);return b}mergeBeef(a){let b=Array.isArray(a)?I.fromBinary(a):a;for(let a of b.bumps)this.mergeBump(a);for(let a of b.txs)this.mergeBeefTx(a)}isValid(a){return this.verifyValid(a).valid}async verify(a,b){let c=this.verifyValid(b);if(!c.valid)return!1;for(let b of Object.keys(c.roots))if(!await a.isValidRootForHeight(c.roots[b],Number(b)))return!1;return!0}verifyValid(a){let b={valid:!1,roots:{}},c=this.sortTxs();if(c.missingInputs.length>0||c.notValid.length>0||c.txidOnly.length>0&&!0!==a||c.withMissingInputs.length>0)return b;let d={};for(let c of this.txs)if(c.isTxidOnly){if(!0!==a)return b;d[c.txid]=!0}let e=(a,c)=>{let d=a.computeRoot(c);return(void 0===b.roots[a.blockHeight]||""===b.roots[a.blockHeight])&&(b.roots[a.blockHeight]=d),b.roots[a.blockHeight]===d};for(let a of this.bumps)for(let c of a.path[0])if(!0===c.txid&&"string"==typeof c.hash&&c.hash.length>0&&(d[c.hash]=!0,!e(a,c.hash)))return b;for(let a of this.txs)if(void 0!==a.bumpIndex&&null==this.bumps[a.bumpIndex].path[0].find(b=>b.hash===a.txid))return b;for(let a of this.txs){for(let c of a.inputTxids)if(!d[c])return b;d[a.txid]=!0}return b.valid=!0,b}toWriter(a){for(let b of(a.writeUInt32LE(this.version),a.writeVarIntNum(this.bumps.length),this.bumps))a.write(b.toBinary());for(let b of(a.writeVarIntNum(this.txs.length),this.txs))b.toWriter(a,this.version)}toBinary(){this.sortTxs();let a=new e.Writer;return this.toWriter(a),a.toArray()}toBinaryAtomic(a){this.sortTxs();let b=this.findTxid(a);if(null==b)throw Error(`${a} does not exist in this Beef`);let c=this.txs[this.txs.length-1]===b?this:this.clone();if(c!==this){let b=this.txs.findIndex(b=>b.txid===a);c.txs.splice(b+1)}let d=new e.Writer;return d.writeUInt32LE(H),d.writeReverse((0,e.toArray)(a,"hex")),c.toWriter(d),d.toArray()}toHex(){return(0,e.toHex)(this.toBinary())}static fromReader(a){let b,c=a.readUInt32LE();if(c===H&&(b=(0,e.toHex)(a.readReverse(32)),c=a.readUInt32LE()),c!==F&&c!==G)throw Error(`Serialized BEEF must start with ${F} or ${G} but starts with ${c}`);let d=new I(c),f=a.readVarIntNum();for(let b=0;b<f;b++){let b=C.fromReader(a,!1);d.bumps.push(b)}let g=a.readVarIntNum();for(let b=0;b<g;b++){let b=D.fromReader(a,c);d.txs.push(b)}return d.atomicTxid=b,d}static fromBinary(a){let b=new e.Reader(a);return I.fromReader(b)}static fromString(a,b="hex"){let c=(0,e.toArray)(a,b),d=new e.Reader(c);return I.fromReader(d)}tryToValidateBumpIndex(a){if(void 0!==a.bumpIndex)return!0;let b=a.txid;for(let c=0;c<this.bumps.length;c++){let d=this.bumps[c].path[0].findIndex(a=>a.hash===b);if(d>=0)return a.bumpIndex=c,this.bumps[c].path[0][d].txid=!0,!0}return!1}sortTxs(){let a={},b={},c=[],d=[],e=[];for(let f of this.txs)b[f.txid]=f,f.isValid=f.hasProof,f.isValid?(a[f.txid]=!0,d.push(f)):f.isTxidOnly&&0===f.inputTxids.length?(a[f.txid]=!0,e.push(f)):c.push(f);let f={},g=[],h=c;for(let a of(c=[],h)){let d=!1;for(let c of a.inputTxids)void 0===b[c]&&(f[c]=!0,d=!0);d?g.push(a):c.push(a)}for(;c.length>0;){let b=c;for(let e of(c=[],b))e.inputTxids.every(b=>a[b])?(a[e.txid]=!0,d.push(e)):c.push(e);if(b.length===c.length)break}let i=c;return this.txs=g.concat(i).concat(e).concat(d),{missingInputs:Object.keys(f),notValid:i.map(a=>a.txid),valid:Object.keys(a),withMissingInputs:g.map(a=>a.txid),txidOnly:e.map(a=>a.txid)}}clone(){let a=new I;return a.version=this.version,a.bumps=Array.from(this.bumps),a.txs=Array.from(this.txs),a}trimKnownTxids(a){for(let b=0;b<this.txs.length;){let c=this.txs[b];c.isTxidOnly&&a.includes(c.txid)?this.txs.splice(b,1):b++}}getValidTxids(){return this.sortTxs().valid}toLogString(){let a="";a+=`BEEF with ${this.bumps.length} BUMPS and ${this.txs.length} Transactions, isValid ${this.isValid().toString()}
`;let b=-1;for(let c of this.bumps)b++,a+=`  BUMP ${b}
    block: ${c.blockHeight}
    txids: [
${c.path[0].filter(a=>!0===a.txid).map(a=>`      '${a.hash??""}'`).join(",\n")}
    ]
`;for(let c of(b=-1,this.txs))b++,a+=`  TX ${b}
    txid: ${c.txid}
`,void 0!==c.bumpIndex&&(a+=`    bumpIndex: ${c.bumpIndex}
`),c.isTxidOnly?a+="    txidOnly\n":a+=`    rawTx length=${c.rawTx?.length??0}
`,c.inputTxids.length>0&&(a+=`    inputs: [
${c.inputTxids.map(a=>`      '${a}'`).join(",\n")}
    ]
`);return a}addComputedLeaves(){let a=a=>(0,e.toHex)((0,j.hash256)((0,e.toArray)(a,"hex").reverse()).reverse());for(let b of this.bumps)for(let c=1;c<b.path.length;c++)for(let d of b.path[c-1])if("string"==typeof d.hash&&(1&d.offset)==0){let e=b.path[c-1].find(a=>a.offset===d.offset+1),f=d.offset>>1;void 0!==e&&"string"==typeof e.hash&&b.path[c].every(a=>a.offset!==f)&&b.path[c].push({offset:f,hash:a(e.hash+d.hash)})}}}class J{version;inputs;outputs;lockTime;metadata;merklePath;cachedHash;static addPathOrInputs(a,b,c){if("number"==typeof a.pathIndex){let b=c[a.pathIndex];if("object"!=typeof b)throw Error("Invalid merkle path index found in BEEF!");a.tx.merklePath=b}else for(let d of a.tx.inputs){if(void 0===d.sourceTXID)throw Error("Input sourceTXID is undefined");let a=b[d.sourceTXID];if("object"!=typeof a)throw Error(`Reference to unknown TXID in BEEF: ${d.sourceTXID??"undefined"}`);d.sourceTransaction=a.tx,this.addPathOrInputs(a,b,c)}}static fromBEEF(a,b){let{tx:c}=J.fromAnyBeef(a,b);return c}static fromAtomicBEEF(a){let{tx:b,txid:c,beef:d}=J.fromAnyBeef(a);if(c!==d.atomicTxid)if(d.atomicTxid)throw Error(`Transaction with TXID ${d.atomicTxid} not found in BEEF data.`);else throw Error("beef must conform to BRC-95 and must contain the subject txid.");return b}static fromAnyBeef(a,b){let c=I.fromBinary(a);if(c.txs.length<1)throw Error("beef must include at least one transaction.");let d=b||c.atomicTxid||c.txs.slice(-1)[0].txid,e=c.findAtomicTransaction(d);if(null==e)if(b)throw Error(`Transaction with TXID ${d} not found in BEEF data.`);else throw Error("beef does not contain transaction for atomic txid.");return{tx:e,beef:c,txid:d}}static fromEF(a){let b=new e.Reader(a),c=b.readUInt32LE();if("0000000000ef"!==(0,e.toHex)(b.read(6)))throw Error("Invalid EF marker");let d=b.readVarIntNum(),f=[];for(let a=0;a<d;a++){let a=(0,e.toHex)(b.readReverse(32)),c=b.readUInt32LE(),d=b.readVarIntNum(),g=b.read(d),j=i.fromBinary(g),k=b.readUInt32LE(),l=b.readUInt64LEBn().toNumber(),m=b.readVarIntNum(),n=b.read(m),o=h.fromBinary(n),p=new J(void 0,[],[],void 0);p.outputs=Array(c+1).fill(null),p.outputs[c]={satoshis:l,lockingScript:o},f.push({sourceTransaction:p,sourceTXID:a,sourceOutputIndex:c,unlockingScript:j,sequence:k})}let g=b.readVarIntNum(),j=[];for(let a=0;a<g;a++){let a=b.readUInt64LEBn().toNumber(),c=b.readVarIntNum(),d=b.read(c),e=h.fromBinary(d);j.push({satoshis:a,lockingScript:e})}return new J(c,f,j,b.readUInt32LE())}static parseScriptOffsets(a){let b=new e.Reader(a),c=[],d=[];b.pos+=4;let f=b.readVarIntNum();for(let a=0;a<f;a++){b.pos+=36;let d=b.readVarIntNum();c.push({vin:a,offset:b.pos,length:d}),b.pos+=d+4}let g=b.readVarIntNum();for(let a=0;a<g;a++){b.pos+=8;let c=b.readVarIntNum();d.push({vout:a,offset:b.pos,length:c}),b.pos+=c}return{inputs:c,outputs:d}}static fromReader(a){let b=a.readUInt32LE(),c=a.readVarIntNum(),d=[];for(let b=0;b<c;b++){let b=(0,e.toHex)(a.readReverse(32)),c=a.readUInt32LE(),f=a.readVarIntNum(),g=a.read(f),h=i.fromBinary(g),j=a.readUInt32LE();d.push({sourceTXID:b,sourceOutputIndex:c,unlockingScript:h,sequence:j})}let f=a.readVarIntNum(),g=[];for(let b=0;b<f;b++){let b=a.readUInt64LEBn().toNumber(),c=a.readVarIntNum(),d=a.read(c),e=h.fromBinary(d);g.push({satoshis:b,lockingScript:e})}return new J(b,d,g,a.readUInt32LE())}static fromBinary(a){let b=new e.Reader(a);return J.fromReader(b)}static fromHex(a){return J.fromBinary((0,e.toArray)(a,"hex"))}static fromHexEF(a){return J.fromEF((0,e.toArray)(a,"hex"))}static fromHexBEEF(a,b){return J.fromBEEF((0,e.toArray)(a,"hex"),b)}constructor(a=1,b=[],c=[],d=0,e={},f){this.version=a,this.inputs=b,this.outputs=c,this.lockTime=d,this.metadata=e,this.merklePath=f}addInput(a){if(void 0===a.sourceTXID&&void 0===a.sourceTransaction)throw Error("A reference to an an input transaction is required. If the input transaction itself cannot be referenced, its TXID must still be provided.");void 0===a.sequence&&(a.sequence=0xffffffff),this.cachedHash=void 0,this.inputs.push(a)}addOutput(a){if(this.cachedHash=void 0,!0!==a.change){if(void 0===a.satoshis)throw Error("either satoshis must be defined or change must be set to true");if(a.satoshis<0)throw Error("satoshis must be a positive integer or zero")}if(null==a.lockingScript)throw Error("lockingScript must be defined");this.outputs.push(a)}addP2PKHOutput(a,b){let c=new r().lock(a);if(void 0===b)return this.addOutput({lockingScript:c,change:!0});this.addOutput({lockingScript:c,satoshis:b})}updateMetadata(a){this.metadata={...this.metadata,...a}}async fee(a=new s(1),b="equal"){if(this.cachedHash=void 0,"number"==typeof a){let b=a;a={computeFee:async()=>b}}let c=await a.computeFee(this),d=this.calculateChange(c);if(d<=0){this.outputs=this.outputs.filter(a=>!0!==a.change);return}this.distributeChange(d,b)}calculateChange(a){let b=0;for(let a of this.inputs){if("object"!=typeof a.sourceTransaction)throw Error("Source transactions are required for all inputs during fee computation");b+=a.sourceTransaction.outputs[a.sourceOutputIndex].satoshis??0}for(let c of(b-=a,this.outputs))!0!==c.change&&void 0!==c.satoshis&&(b-=c.satoshis);return b}distributeChange(a,b){let c=0,d=this.outputs.filter(a=>a.change);if("random"===b?c=this.distributeRandomChange(a,d):"equal"===b&&(c=this.distributeEqualChange(a,d)),c<a){let b=this.outputs[this.outputs.length-1];void 0!==b.satoshis?b.satoshis+=a-c:b.satoshis=a-c}}distributeRandomChange(a,b){let c=0,d=a,e=Array(b.length).fill(1);d-=b.length,c+=b.length;for(let a=0;a<b.length-1;a++){let b=this.benfordNumber(0,d);e[a]=e[a]+b,c+=b,d-=b}for(let a of this.outputs)!0===a.change&&(a.satoshis=e.shift());return c}distributeEqualChange(a,b){let c=0,d=Math.floor(a/b.length);for(let a of b)c+=d,a.satoshis=d;return c}benfordNumber(a,b){return Math.floor(a+(b-a)*Math.log10(1+1/(Math.floor(9*Math.random())+1))/Math.log10(10))}getFee(){let a=0;for(let b of this.inputs){if("object"!=typeof b.sourceTransaction)throw Error("Source transactions or sourceSatoshis are required for all inputs to calculate fee");a+=b.sourceTransaction.outputs[b.sourceOutputIndex].satoshis??0}let b=0;for(let a of this.outputs)b+=a.satoshis??0;return a-b}async sign(){for(let a of(this.cachedHash=void 0,this.outputs))if(void 0===a.satoshis)if(!0===a.change)throw Error("There are still change outputs with uncomputed amounts. Use the fee() method to compute the change amounts and transaction fees prior to signing.");else throw Error("One or more transaction outputs is missing an amount. Ensure all output amounts are provided before signing.");let a=await Promise.all(this.inputs.map(async(a,b)=>"object"==typeof this.inputs[b].unlockingScriptTemplate?await this.inputs[b]?.unlockingScriptTemplate?.sign(this,b):await Promise.resolve(void 0)));for(let b=0,c=this.inputs.length;b<c;b++)"object"==typeof this.inputs[b].unlockingScriptTemplate&&(this.inputs[b].unlockingScript=a[b])}async broadcast(a=z()){return await a.broadcast(this)}toBinary(){let a=new e.Writer;for(let b of(a.writeUInt32LE(this.version),a.writeVarIntNum(this.inputs.length),this.inputs)){if(void 0===b.sourceTXID)if(null!=b.sourceTransaction)a.write(b.sourceTransaction.hash());else throw Error("sourceTransaction is undefined");else a.writeReverse((0,e.toArray)(b.sourceTXID,"hex"));if(a.writeUInt32LE(b.sourceOutputIndex),null==b.unlockingScript)throw Error("unlockingScript is undefined");let c=b.unlockingScript.toBinary();a.writeVarIntNum(c.length),a.write(c),a.writeUInt32LE(b.sequence??0)}for(let b of(a.writeVarIntNum(this.outputs.length),this.outputs)){a.writeUInt64LE(b.satoshis??0);let c=b.lockingScript.toBinary();a.writeVarIntNum(c.length),a.write(c)}return a.writeUInt32LE(this.lockTime),a.toArray()}toEF(){let a=new e.Writer;for(let b of(a.writeUInt32LE(this.version),a.write([0,0,0,0,0,239]),a.writeVarIntNum(this.inputs.length),this.inputs)){if(void 0===b.sourceTransaction)throw Error("All inputs must have source transactions when serializing to EF format");if(void 0===b.sourceTXID?a.write(b.sourceTransaction.hash()):a.write((0,e.toArray)(b.sourceTXID,"hex").reverse()),a.writeUInt32LE(b.sourceOutputIndex),null==b.unlockingScript)throw Error("unlockingScript is undefined");let c=b.unlockingScript.toBinary();a.writeVarIntNum(c.length),a.write(c),a.writeUInt32LE(b.sequence??0),a.writeUInt64LE(b.sourceTransaction.outputs[b.sourceOutputIndex].satoshis??0);let d=b.sourceTransaction.outputs[b.sourceOutputIndex].lockingScript.toBinary();a.writeVarIntNum(d.length),a.write(d)}for(let b of(a.writeVarIntNum(this.outputs.length),this.outputs)){a.writeUInt64LE(b.satoshis??0);let c=b.lockingScript.toBinary();a.writeVarIntNum(c.length),a.write(c)}return a.writeUInt32LE(this.lockTime),a.toArray()}toHexEF(){return(0,e.toHex)(this.toEF())}toHex(){return(0,e.toHex)(this.toBinary())}toHexBEEF(){return(0,e.toHex)(this.toBEEF())}toHexAtomicBEEF(){return(0,e.toHex)(this.toAtomicBEEF())}hash(a){let b;return(null!=this.cachedHash?b=this.cachedHash:(b=(0,j.hash256)(this.toBinary()),this.cachedHash=b),"hex"===a)?(0,e.toHex)(b):b}id(a){let b=[...this.hash()];return(b.reverse(),"hex"===a)?(0,e.toHex)(b):b}async verify(a=B(),b,c){let d=new Set,e=[this];for(;e.length>0;){let f=e.shift(),g=f?.id("hex")??"";if(null!=g&&""!==g&&d.has(g))continue;if("object"==typeof f?.merklePath){if("scripts only"===a){null!=g&&d.add(g);continue}else if(await f.merklePath.verify(g,a)){d.add(g);continue}}if(void 0!==b){if(void 0===f)throw Error("Transaction is undefined");let a=J.fromEF(f.toEF());if(delete a.outputs[0].satoshis,a.outputs[0].change=!0,await a.fee(b),f.getFee()<a.getFee())throw Error(`Verification failed because the transaction ${g} has an insufficient fee and has not been mined.`)}let h=0;if(void 0===f)throw Error("Transaction is undefined");for(let a=0;a<f.inputs.length;a++){let b=f.inputs[a];if("object"!=typeof b.sourceTransaction)throw Error(`Verification failed because the input at index ${a} of transaction ${g} is missing an associated source transaction. This source transaction is required for transaction verification because there is no merkle proof for the transaction spending a UTXO it contains.`);if("object"!=typeof b.unlockingScript)throw Error(`Verification failed because the input at index ${a} of transaction ${g} is missing an associated unlocking script. This script is required for transaction verification because there is no merkle proof for the transaction spending the UTXO.`);let i=b.sourceTransaction.outputs[b.sourceOutputIndex];h+=i.satoshis??0;let j=b.sourceTransaction.id("hex");d.has(j)||e.push(b.sourceTransaction);let k=f.inputs.filter((b,c)=>c!==a);if(void 0===b.sourceTXID&&(b.sourceTXID=j),!new p({sourceTXID:b.sourceTXID,sourceOutputIndex:b.sourceOutputIndex,lockingScript:i.lockingScript,sourceSatoshis:i.satoshis??0,transactionVersion:f.version,otherInputs:k,unlockingScript:b.unlockingScript,inputSequence:b.sequence??0,inputIndex:a,outputs:f.outputs,lockTime:f.lockTime,memoryLimit:c}).validate())return!1}let i=0;for(let a of f.outputs){if("number"!=typeof a.satoshis)throw Error("Every output must have a defined amount during transaction verification.");i+=a.satoshis}if(i>h)return!1;d.add(g)}return!0}toBEEF(a){let b=new e.Writer;b.writeUInt32LE(F);let c=[],d=[],f=b=>{let e={tx:b},g="object"==typeof b.merklePath;if(g){let a=!1;for(let d=0;d<c.length;d++){if(c[d]===b.merklePath){e.pathIndex=d,a=!0;break}if(null!==b.merklePath&&void 0!==b.merklePath&&c[d].blockHeight===b.merklePath.blockHeight&&c[d].computeRoot()===b.merklePath.computeRoot()){c[d].combine(b.merklePath),e.pathIndex=d,a=!0;break}}a||(e.pathIndex=c.length,null!==b.merklePath&&void 0!==b.merklePath&&c.push(b.merklePath))}if(d.some(a=>a.tx.id("hex")===b.id("hex"))||d.unshift(e),!g)for(let c=0;c<b.inputs.length;c++){let d=b.inputs[c];if("object"==typeof d.sourceTransaction)f(d.sourceTransaction);else if(!1===a)throw Error("A required source transaction is missing!")}};for(let a of(f(this),b.writeVarIntNum(c.length),c))b.write(a.toBinary());for(let a of(b.writeVarIntNum(d.length),d))b.write(a.tx.toBinary()),"number"==typeof a.pathIndex?(b.writeUInt8(1),b.writeVarIntNum(a.pathIndex)):b.writeUInt8(0);return b.toArray()}toAtomicBEEF(a){let b=new e.Writer;b.writeUInt32LE(0x1010101),b.write(this.hash());let c=this.toBEEF(a);return b.write(c),b.toArray()}}let K="Bitcoin Signed Message:\n",L=a=>{let b=new e.Writer;b.writeVarIntNum(K.length),b.write((0,e.toArray)(K,"utf8")),b.writeVarIntNum(a.length),b.write(a);let c=b.toArray();return j.hash256(c)};a.s(["magicHash",0,L,"sign",0,(a,b,c="base64")=>{let d=L(a),e=m.sign(new f.default(d),b,!0);if("raw"===c)return e;let g=new f.default(d),h=e.CalculateRecoveryFactor(b.toPublicKey(),g);return e.toCompact(h,!0,"base64")},"verify",0,(a,b,c)=>{let d=L(a);return m.verify(new f.default(d),b,c)}],33128);var M=a.i(27872),N=a.i(96745);class O{versionBytesNum;depth;parentFingerPrint;childIndex;chainCode;privKey;pubKey;constants={pubKey:0x488b21e,privKey:0x488ade4};constructor(a,b,c,d,e,f,g){this.versionBytesNum=a,this.depth=b,this.parentFingerPrint=c,this.childIndex=d,this.chainCode=e,this.privKey=f,this.pubKey=g}fromRandom(){return this.versionBytesNum=this.constants.privKey,this.depth=0,this.parentFingerPrint=[0,0,0,0],this.childIndex=0,this.chainCode=(0,w.default)(32),this.privKey=N.default.fromRandom(),this.pubKey=this.privKey.toPublicKey(),this}static fromRandom(){return new this().fromRandom()}static fromString(a){return new this().fromString(a)}fromString(a){let b=(0,e.fromBase58Check)(a);return this.fromBinary([...b.prefix,...b.data])}static fromSeed(a){return new this().fromSeed(a)}fromSeed(a){if(a.length<16)throw Error("Need more than 128 bits of entropy");if(a.length>64)throw Error("More than 512 bits of entropy is nonstandard");let b=j.sha512hmac((0,e.toArray)("Bitcoin seed","utf8"),a);return this.depth=0,this.parentFingerPrint=[0,0,0,0],this.childIndex=0,this.chainCode=b.slice(32,64),this.versionBytesNum=this.constants.privKey,this.privKey=new N.default(b.slice(0,32)),this.pubKey=this.privKey.toPublicKey(),this}static fromBinary(a){return new this().fromBinary(a)}fromBinary(a){if(78!==a.length)throw Error("incorrect bip32 data length");let b=new e.Reader(a);this.versionBytesNum=b.readUInt32BE(),this.depth=b.readUInt8(),this.parentFingerPrint=b.read(4),this.childIndex=b.readUInt32BE(),this.chainCode=b.read(32);let c=b.read(33),d=this.versionBytesNum===this.constants.privKey,f=this.versionBytesNum===this.constants.pubKey;if(d&&0===c[0])this.privKey=new N.default(c.slice(1,33)),this.pubKey=this.privKey.toPublicKey();else if(f&&(2===c[0]||3===c[0]))this.pubKey=l.default.fromString((0,e.toHex)(c));else throw Error("Invalid key");return this}toString(){let a=this.toBinary();return(0,e.toBase58Check)(a,[])}derive(a){if("m"===a)return this;let b=a.split("/"),c=this;for(let[a,d]of b.entries()){if(0===a){if("m"!==d)throw Error("invalid path");continue}if(parseInt(d.replace("'",""),10).toString()!==d.replace("'",""))throw Error("invalid path");let b=d.length>1&&"'"===d[d.length-1],e=0x7fffffff&parseInt(b?d.slice(0,d.length-1):d,10);b&&(e+=0x80000000),c=c.deriveChild(e)}return c}deriveChild(a){if("number"!=typeof a)throw Error("i must be a number");let b=[];b.push(a>>24&255),b.push(a>>16&255),b.push(a>>8&255),b.push(255&a);let c=[...b],d=(0x80000000&a)!=0,e=this.versionBytesNum===this.constants.privKey;if(d&&(null===this.privKey||void 0===this.privKey||!e))throw Error("Cannot do private key derivation without private key");let g=null;if(null!==this.privKey&&void 0!==this.privKey){let a=null;a=d?[0,...this.privKey.toArray("be",32),...c]:[...this.pubKey.encode(!0),...c];let b=j.sha512hmac(this.chainCode,a),e=new f.default(b.slice(0,32)),h=b.slice(32,64),i=e.add(this.privKey).mod(new M.default().n);(g=new O).chainCode=h,g.privKey=new N.default(i.toArray()),g.pubKey=g.privKey.toPublicKey()}else{let a=[...this.pubKey.encode(!0),...c],b=j.sha512hmac(this.chainCode,a),d=new f.default(b.slice(0,32)),e=b.slice(32,64),h=new M.default().g.mul(d),i=this.pubKey,k=h.add(i),m=new l.default(k.x,k.y);(g=new O).chainCode=e,g.pubKey=m}g.childIndex=a;let h=j.hash160(this.pubKey.encode(!0));return g.parentFingerPrint=h.slice(0,4),g.versionBytesNum=this.versionBytesNum,g.depth=this.depth+1,g}toPublic(){let a=new O(this.versionBytesNum,this.depth,this.parentFingerPrint,this.childIndex,this.chainCode,this.privKey,this.pubKey);return a.versionBytesNum=this.constants.pubKey,a.privKey=void 0,a}toBinary(){let a=this.versionBytesNum===this.constants.privKey,b=this.versionBytesNum===this.constants.pubKey;if(a)return new e.Writer().writeUInt32BE(this.versionBytesNum).writeUInt8(this.depth).write(this.parentFingerPrint).writeUInt32BE(this.childIndex).write(this.chainCode).writeUInt8(0).write(this.privKey.toArray("be",32)).toArray();if(b)return new e.Writer().writeUInt32BE(this.versionBytesNum).writeUInt8(this.depth).write(this.parentFingerPrint).writeUInt32BE(this.childIndex).write(this.chainCode).write(this.pubKey.encode(!0)).toArray();throw Error("bip32: invalid versionBytesNum byte")}isPrivate(){return this.versionBytesNum===this.constants.privKey}}a.s(["default",()=>O],22531);let P={value:["abandon","ability","able","about","above","absent","absorb","abstract","absurd","abuse","access","accident","account","accuse","achieve","acid","acoustic","acquire","across","act","action","actor","actress","actual","adapt","add","addict","address","adjust","admit","adult","advance","advice","aerobic","affair","afford","afraid","again","age","agent","agree","ahead","aim","air","airport","aisle","alarm","album","alcohol","alert","alien","all","alley","allow","almost","alone","alpha","already","also","alter","always","amateur","amazing","among","amount","amused","analyst","anchor","ancient","anger","angle","angry","animal","ankle","announce","annual","another","answer","antenna","antique","anxiety","any","apart","apology","appear","apple","approve","april","arch","arctic","area","arena","argue","arm","armed","armor","army","around","arrange","arrest","arrive","arrow","art","artefact","artist","artwork","ask","aspect","assault","asset","assist","assume","asthma","athlete","atom","attack","attend","attitude","attract","auction","audit","august","aunt","author","auto","autumn","average","avocado","avoid","awake","aware","away","awesome","awful","awkward","axis","baby","bachelor","bacon","badge","bag","balance","balcony","ball","bamboo","banana","banner","bar","barely","bargain","barrel","base","basic","basket","battle","beach","bean","beauty","because","become","beef","before","begin","behave","behind","believe","below","belt","bench","benefit","best","betray","better","between","beyond","bicycle","bid","bike","bind","biology","bird","birth","bitter","black","blade","blame","blanket","blast","bleak","bless","blind","blood","blossom","blouse","blue","blur","blush","board","boat","body","boil","bomb","bone","bonus","book","boost","border","boring","borrow","boss","bottom","bounce","box","boy","bracket","brain","brand","brass","brave","bread","breeze","brick","bridge","brief","bright","bring","brisk","broccoli","broken","bronze","broom","brother","brown","brush","bubble","buddy","budget","buffalo","build","bulb","bulk","bullet","bundle","bunker","burden","burger","burst","bus","business","busy","butter","buyer","buzz","cabbage","cabin","cable","cactus","cage","cake","call","calm","camera","camp","can","canal","cancel","candy","cannon","canoe","canvas","canyon","capable","capital","captain","car","carbon","card","cargo","carpet","carry","cart","case","cash","casino","castle","casual","cat","catalog","catch","category","cattle","caught","cause","caution","cave","ceiling","celery","cement","census","century","cereal","certain","chair","chalk","champion","change","chaos","chapter","charge","chase","chat","cheap","check","cheese","chef","cherry","chest","chicken","chief","child","chimney","choice","choose","chronic","chuckle","chunk","churn","cigar","cinnamon","circle","citizen","city","civil","claim","clap","clarify","claw","clay","clean","clerk","clever","click","client","cliff","climb","clinic","clip","clock","clog","close","cloth","cloud","clown","club","clump","cluster","clutch","coach","coast","coconut","code","coffee","coil","coin","collect","color","column","combine","come","comfort","comic","common","company","concert","conduct","confirm","congress","connect","consider","control","convince","cook","cool","copper","copy","coral","core","corn","correct","cost","cotton","couch","country","couple","course","cousin","cover","coyote","crack","cradle","craft","cram","crane","crash","crater","crawl","crazy","cream","credit","creek","crew","cricket","crime","crisp","critic","crop","cross","crouch","crowd","crucial","cruel","cruise","crumble","crunch","crush","cry","crystal","cube","culture","cup","cupboard","curious","current","curtain","curve","cushion","custom","cute","cycle","dad","damage","damp","dance","danger","daring","dash","daughter","dawn","day","deal","debate","debris","decade","december","decide","decline","decorate","decrease","deer","defense","define","defy","degree","delay","deliver","demand","demise","denial","dentist","deny","depart","depend","deposit","depth","deputy","derive","describe","desert","design","desk","despair","destroy","detail","detect","develop","device","devote","diagram","dial","diamond","diary","dice","diesel","diet","differ","digital","dignity","dilemma","dinner","dinosaur","direct","dirt","disagree","discover","disease","dish","dismiss","disorder","display","distance","divert","divide","divorce","dizzy","doctor","document","dog","doll","dolphin","domain","donate","donkey","donor","door","dose","double","dove","draft","dragon","drama","drastic","draw","dream","dress","drift","drill","drink","drip","drive","drop","drum","dry","duck","dumb","dune","during","dust","dutch","duty","dwarf","dynamic","eager","eagle","early","earn","earth","easily","east","easy","echo","ecology","economy","edge","edit","educate","effort","egg","eight","either","elbow","elder","electric","elegant","element","elephant","elevator","elite","else","embark","embody","embrace","emerge","emotion","employ","empower","empty","enable","enact","end","endless","endorse","enemy","energy","enforce","engage","engine","enhance","enjoy","enlist","enough","enrich","enroll","ensure","enter","entire","entry","envelope","episode","equal","equip","era","erase","erode","erosion","error","erupt","escape","essay","essence","estate","eternal","ethics","evidence","evil","evoke","evolve","exact","example","excess","exchange","excite","exclude","excuse","execute","exercise","exhaust","exhibit","exile","exist","exit","exotic","expand","expect","expire","explain","expose","express","extend","extra","eye","eyebrow","fabric","face","faculty","fade","faint","faith","fall","false","fame","family","famous","fan","fancy","fantasy","farm","fashion","fat","fatal","father","fatigue","fault","favorite","feature","february","federal","fee","feed","feel","female","fence","festival","fetch","fever","few","fiber","fiction","field","figure","file","film","filter","final","find","fine","finger","finish","fire","firm","first","fiscal","fish","fit","fitness","fix","flag","flame","flash","flat","flavor","flee","flight","flip","float","flock","floor","flower","fluid","flush","fly","foam","focus","fog","foil","fold","follow","food","foot","force","forest","forget","fork","fortune","forum","forward","fossil","foster","found","fox","fragile","frame","frequent","fresh","friend","fringe","frog","front","frost","frown","frozen","fruit","fuel","fun","funny","furnace","fury","future","gadget","gain","galaxy","gallery","game","gap","garage","garbage","garden","garlic","garment","gas","gasp","gate","gather","gauge","gaze","general","genius","genre","gentle","genuine","gesture","ghost","giant","gift","giggle","ginger","giraffe","girl","give","glad","glance","glare","glass","glide","glimpse","globe","gloom","glory","glove","glow","glue","goat","goddess","gold","good","goose","gorilla","gospel","gossip","govern","gown","grab","grace","grain","grant","grape","grass","gravity","great","green","grid","grief","grit","grocery","group","grow","grunt","guard","guess","guide","guilt","guitar","gun","gym","habit","hair","half","hammer","hamster","hand","happy","harbor","hard","harsh","harvest","hat","have","hawk","hazard","head","health","heart","heavy","hedgehog","height","hello","helmet","help","hen","hero","hidden","high","hill","hint","hip","hire","history","hobby","hockey","hold","hole","holiday","hollow","home","honey","hood","hope","horn","horror","horse","hospital","host","hotel","hour","hover","hub","huge","human","humble","humor","hundred","hungry","hunt","hurdle","hurry","hurt","husband","hybrid","ice","icon","idea","identify","idle","ignore","ill","illegal","illness","image","imitate","immense","immune","impact","impose","improve","impulse","inch","include","income","increase","index","indicate","indoor","industry","infant","inflict","inform","inhale","inherit","initial","inject","injury","inmate","inner","innocent","input","inquiry","insane","insect","inside","inspire","install","intact","interest","into","invest","invite","involve","iron","island","isolate","issue","item","ivory","jacket","jaguar","jar","jazz","jealous","jeans","jelly","jewel","job","join","joke","journey","joy","judge","juice","jump","jungle","junior","junk","just","kangaroo","keen","keep","ketchup","key","kick","kid","kidney","kind","kingdom","kiss","kit","kitchen","kite","kitten","kiwi","knee","knife","knock","know","lab","label","labor","ladder","lady","lake","lamp","language","laptop","large","later","latin","laugh","laundry","lava","law","lawn","lawsuit","layer","lazy","leader","leaf","learn","leave","lecture","left","leg","legal","legend","leisure","lemon","lend","length","lens","leopard","lesson","letter","level","liar","liberty","library","license","life","lift","light","like","limb","limit","link","lion","liquid","list","little","live","lizard","load","loan","lobster","local","lock","logic","lonely","long","loop","lottery","loud","lounge","love","loyal","lucky","luggage","lumber","lunar","lunch","luxury","lyrics","machine","mad","magic","magnet","maid","mail","main","major","make","mammal","man","manage","mandate","mango","mansion","manual","maple","marble","march","margin","marine","market","marriage","mask","mass","master","match","material","math","matrix","matter","maximum","maze","meadow","mean","measure","meat","mechanic","medal","media","melody","melt","member","memory","mention","menu","mercy","merge","merit","merry","mesh","message","metal","method","middle","midnight","milk","million","mimic","mind","minimum","minor","minute","miracle","mirror","misery","miss","mistake","mix","mixed","mixture","mobile","model","modify","mom","moment","monitor","monkey","monster","month","moon","moral","more","morning","mosquito","mother","motion","motor","mountain","mouse","move","movie","much","muffin","mule","multiply","muscle","museum","mushroom","music","must","mutual","myself","mystery","myth","naive","name","napkin","narrow","nasty","nation","nature","near","neck","need","negative","neglect","neither","nephew","nerve","nest","net","network","neutral","never","news","next","nice","night","noble","noise","nominee","noodle","normal","north","nose","notable","note","nothing","notice","novel","now","nuclear","number","nurse","nut","oak","obey","object","oblige","obscure","observe","obtain","obvious","occur","ocean","october","odor","off","offer","office","often","oil","okay","old","olive","olympic","omit","once","one","onion","online","only","open","opera","opinion","oppose","option","orange","orbit","orchard","order","ordinary","organ","orient","original","orphan","ostrich","other","outdoor","outer","output","outside","oval","oven","over","own","owner","oxygen","oyster","ozone","pact","paddle","page","pair","palace","palm","panda","panel","panic","panther","paper","parade","parent","park","parrot","party","pass","patch","path","patient","patrol","pattern","pause","pave","payment","peace","peanut","pear","peasant","pelican","pen","penalty","pencil","people","pepper","perfect","permit","person","pet","phone","photo","phrase","physical","piano","picnic","picture","piece","pig","pigeon","pill","pilot","pink","pioneer","pipe","pistol","pitch","pizza","place","planet","plastic","plate","play","please","pledge","pluck","plug","plunge","poem","poet","point","polar","pole","police","pond","pony","pool","popular","portion","position","possible","post","potato","pottery","poverty","powder","power","practice","praise","predict","prefer","prepare","present","pretty","prevent","price","pride","primary","print","priority","prison","private","prize","problem","process","produce","profit","program","project","promote","proof","property","prosper","protect","proud","provide","public","pudding","pull","pulp","pulse","pumpkin","punch","pupil","puppy","purchase","purity","purpose","purse","push","put","puzzle","pyramid","quality","quantum","quarter","question","quick","quit","quiz","quote","rabbit","raccoon","race","rack","radar","radio","rail","rain","raise","rally","ramp","ranch","random","range","rapid","rare","rate","rather","raven","raw","razor","ready","real","reason","rebel","rebuild","recall","receive","recipe","record","recycle","reduce","reflect","reform","refuse","region","regret","regular","reject","relax","release","relief","rely","remain","remember","remind","remove","render","renew","rent","reopen","repair","repeat","replace","report","require","rescue","resemble","resist","resource","response","result","retire","retreat","return","reunion","reveal","review","reward","rhythm","rib","ribbon","rice","rich","ride","ridge","rifle","right","rigid","ring","riot","ripple","risk","ritual","rival","river","road","roast","robot","robust","rocket","romance","roof","rookie","room","rose","rotate","rough","round","route","royal","rubber","rude","rug","rule","run","runway","rural","sad","saddle","sadness","safe","sail","salad","salmon","salon","salt","salute","same","sample","sand","satisfy","satoshi","sauce","sausage","save","say","scale","scan","scare","scatter","scene","scheme","school","science","scissors","scorpion","scout","scrap","screen","script","scrub","sea","search","season","seat","second","secret","section","security","seed","seek","segment","select","sell","seminar","senior","sense","sentence","series","service","session","settle","setup","seven","shadow","shaft","shallow","share","shed","shell","sheriff","shield","shift","shine","ship","shiver","shock","shoe","shoot","shop","short","shoulder","shove","shrimp","shrug","shuffle","shy","sibling","sick","side","siege","sight","sign","silent","silk","silly","silver","similar","simple","since","sing","siren","sister","situate","six","size","skate","sketch","ski","skill","skin","skirt","skull","slab","slam","sleep","slender","slice","slide","slight","slim","slogan","slot","slow","slush","small","smart","smile","smoke","smooth","snack","snake","snap","sniff","snow","soap","soccer","social","sock","soda","soft","solar","soldier","solid","solution","solve","someone","song","soon","sorry","sort","soul","sound","soup","source","south","space","spare","spatial","spawn","speak","special","speed","spell","spend","sphere","spice","spider","spike","spin","spirit","split","spoil","sponsor","spoon","sport","spot","spray","spread","spring","spy","square","squeeze","squirrel","stable","stadium","staff","stage","stairs","stamp","stand","start","state","stay","steak","steel","stem","step","stereo","stick","still","sting","stock","stomach","stone","stool","story","stove","strategy","street","strike","strong","struggle","student","stuff","stumble","style","subject","submit","subway","success","such","sudden","suffer","sugar","suggest","suit","summer","sun","sunny","sunset","super","supply","supreme","sure","surface","surge","surprise","surround","survey","suspect","sustain","swallow","swamp","swap","swarm","swear","sweet","swift","swim","swing","switch","sword","symbol","symptom","syrup","system","table","tackle","tag","tail","talent","talk","tank","tape","target","task","taste","tattoo","taxi","teach","team","tell","ten","tenant","tennis","tent","term","test","text","thank","that","theme","then","theory","there","they","thing","this","thought","three","thrive","throw","thumb","thunder","ticket","tide","tiger","tilt","timber","time","tiny","tip","tired","tissue","title","toast","tobacco","today","toddler","toe","together","toilet","token","tomato","tomorrow","tone","tongue","tonight","tool","tooth","top","topic","topple","torch","tornado","tortoise","toss","total","tourist","toward","tower","town","toy","track","trade","traffic","tragic","train","transfer","trap","trash","travel","tray","treat","tree","trend","trial","tribe","trick","trigger","trim","trip","trophy","trouble","truck","true","truly","trumpet","trust","truth","try","tube","tuition","tumble","tuna","tunnel","turkey","turn","turtle","twelve","twenty","twice","twin","twist","two","type","typical","ugly","umbrella","unable","unaware","uncle","uncover","under","undo","unfair","unfold","unhappy","uniform","unique","unit","universe","unknown","unlock","until","unusual","unveil","update","upgrade","uphold","upon","upper","upset","urban","urge","usage","use","used","useful","useless","usual","utility","vacant","vacuum","vague","valid","valley","valve","van","vanish","vapor","various","vast","vault","vehicle","velvet","vendor","venture","venue","verb","verify","version","very","vessel","veteran","viable","vibrant","vicious","victory","video","view","village","vintage","violin","virtual","virus","visa","visit","visual","vital","vivid","vocal","voice","void","volcano","volume","vote","voyage","wage","wagon","wait","walk","wall","walnut","want","warfare","warm","warrior","wash","wasp","waste","water","wave","way","wealth","weapon","wear","weasel","weather","web","wedding","weekend","weird","welcome","west","wet","whale","what","wheat","wheel","when","where","whip","whisper","wide","width","wife","wild","will","win","window","wine","wing","wink","winner","winter","wire","wisdom","wise","wish","witness","wolf","woman","wonder","wood","wool","word","work","world","worry","worth","wrap","wreck","wrestle","wrist","write","wrong","yard","year","yellow","you","young","youth","zebra","zero","zone","zoo"],space:" "};class Q{mnemonic;seed;Wordlist;constructor(a,b,c=P){this.mnemonic=a??"",this.seed=b??[],this.Wordlist=c}toBinary(){let a=new e.Writer;if(""!==this.mnemonic){let b=(0,e.toArray)(this.mnemonic,"utf8");a.writeVarIntNum(b.length),a.write(b)}else a.writeVarIntNum(0);return this.seed.length>0?(a.writeVarIntNum(this.seed.length),a.write(this.seed)):a.writeVarIntNum(0),a.toArray()}fromBinary(a){let b=new e.Reader(a),c=b.readVarIntNum();c>0&&(this.mnemonic=(0,e.encode)(b.read(c),"utf8"));let d=b.readVarIntNum();return d>0&&(this.seed=b.read(d)),this}fromRandom(a){if((null==a||isNaN(a)||0===a)&&(a=128),a%32!=0)throw Error("bits must be multiple of 32");if(a<128)throw Error("bits must be at least 128");let b=(0,w.default)(a/8);return this.entropy2Mnemonic(b),this.mnemonic2Seed(),this}static fromRandom(a){return new this().fromRandom(a)}fromEntropy(a){return this.entropy2Mnemonic(a),this}static fromEntropy(a){return new this().fromEntropy(a)}fromString(a){return this.mnemonic=a,this}static fromString(a){return new this().fromString(a)}toString(){return this.mnemonic}toSeed(a){return this.mnemonic2Seed(a),this.seed}entropy2Mnemonic(a){if(a.length<16)throw Error("Entropy is less than 128 bits. It must be 128 bits or more.");let b=j.sha256(a),c="",d=8*a.length;for(let b=0;b<a.length;b++)c+=("00000000"+a[b].toString(2)).slice(-8);let e=b[0].toString(2);if((c+=e=("00000000"+e).slice(-8).slice(0,d/32)).length%11!=0)throw Error("internal error - entropy not an even multiple of 11 bits - "+c.length.toString());let f="";for(let a=0;a<c.length/11;a++){""!==f&&(f+=this.Wordlist.space);let b=parseInt(c.slice(11*a,(a+1)*11),2);f+=this.Wordlist.value[b]}return this.mnemonic=f,this}check(){let a=this.mnemonic.split(this.Wordlist.space),b="";for(let c=0;c<a.length;c++){let d=this.Wordlist.value.indexOf(a[c]);if(d<0)return!1;b+=("00000000000"+d.toString(2)).slice(-11)}if(b.length%11!=0)throw Error("internal error - entropy not an even multiple of 11 bits - "+b.length.toString());let c=b.length/33,d=b.slice(-c),e=b.slice(0,b.length-c),f=[];for(let a=0;a<e.length/8;a++)f.push(parseInt(b.slice(8*a,(a+1)*8),2));let g=j.sha256(f.slice(0,e.length/8))[0].toString(2);return(g=("00000000"+g).slice(-8).slice(0,c))===d}mnemonic2Seed(a=""){let b=this.mnemonic;if(!this.check())throw Error("Mnemonic does not pass the check - was the mnemonic typed incorrectly? Are there extra spaces?");if("string"!=typeof a)throw Error("passphrase must be a string or undefined");b=b.normalize("NFKD"),a=a.normalize("NFKD");let c=(0,e.toArray)(b,"utf8"),d=[...(0,e.toArray)("mnemonic","utf8"),...(0,e.toArray)(a,"utf8")];return this.seed=j.pbkdf2(c,d,2048,64,"sha512"),this}isValid(a=""){let b;try{this.mnemonic2Seed(a),b=!0}catch{b=!1}return b}static isValid(a,b=""){return new Q(a).isValid(b)}}a.s(["default",()=>Q],80997);var R=a.i(81719);function S(a){let b,c,d,e;0===this._tables[0][0][0]&&this._precompute();let f=this._tables[0][4],g=this._tables[1],h=a.length,i=1;if(4!==h&&6!==h&&8!==h)throw Error("invalid aes key size");for(this._key=[c=a.slice(0),d=[]],e=h;e<4*h+28;e++)b=c[e-1],(e%h==0||8===h&&e%h==4)&&(b=f[b>>>24]<<24^f[b>>16&255]<<16^f[b>>8&255]<<8^f[255&b],e%h==0&&(b=b<<8^b>>>24^i<<24,i=i<<1^(i>>7)*283)),c[e]=c[e-h]^b;for(let a=0;e>0;a++,e--)b=c[(3&a)!=0?e:e-4],e<=4||a<4?d[a]=b:d[a]=g[0][f[b>>>24]]^g[1][f[b>>16&255]]^g[2][f[b>>8&255]]^g[3][f[255&b]]}S.prototype={encrypt:function(a){return this._crypt(a,0)},decrypt:function(a){return this._crypt(a,1)},_tables:[[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)]],_precompute:function(){let a,b,c,d,e,f,g,h,i=this._tables[0],j=this._tables[1],k=i[4],l=j[4],m=new Uint8Array(256),n=new Uint8Array(256);for(a=0;a<256;a++)n[(m[a]=a<<1^(a>>7)*283)^a]=a;for(b=c=0;0===k[b];b^=0!==d?d:1,c=0!==n[c]?n[c]:1)for(a=0,f=(f=c^c<<1^c<<2^c<<3^c<<4)>>8^255&f^99,k[b]=f,l[f]=b,h=0x1010101*m[e=m[d=m[b]]]^65537*e^257*d^0x1010100*b,g=257*m[f]^0x1010100*f;a<4;a++)i[a][b]=g=g<<24^g>>>8,j[a][f]=h=h<<24^h>>>8},_crypt:function(a,b){let c,d,e,f;if(4!==a.length)throw Error("invalid aes block size");let g=this._key[b],h=a[0]^g[0],i=a[1===b?3:1]^g[1],j=a[2]^g[2],k=a[1===b?1:3]^g[3],l=g.length/4-2,m=4,n=new Uint32Array(4),o=this._tables[b],p=o[0],q=o[1],r=o[2],s=o[3],t=o[4];for(f=0;f<l;f++)c=p[h>>>24]^q[i>>16&255]^r[j>>8&255]^s[255&k]^g[m],d=p[i>>>24]^q[j>>16&255]^r[k>>8&255]^s[255&h]^g[m+1],e=p[j>>>24]^q[k>>16&255]^r[h>>8&255]^s[255&i]^g[m+2],k=p[k>>>24]^q[h>>16&255]^r[i>>8&255]^s[255&j]^g[m+3],m+=4,h=c,i=d,j=e;for(f=0;f<4;f++)n[1===b?3&-f:f]=t[h>>>24]<<24^t[i>>16&255]<<16^t[j>>8&255]<<8^t[255&k]^g[m++],c=h,h=i,i=j,j=k,k=c;return n}};class T{static encrypt(a,b){let c=T.buf2Words(b),d=T.buf2Words(a),e=new S(c).encrypt(d);return T.words2Buf(e)}static decrypt(a,b){let c=T.buf2Words(a),d=new S(T.buf2Words(b)).decrypt(c);return T.words2Buf(d)}static buf2Words(a){if(a.length%4!=0)throw Error("buf length must be a multiple of 4");let b=[];for(let c=0;c<a.length/4;c++){let d=0x1000000*a[4*c]+(a[4*c+1]<<16|a[4*c+2]<<8|a[4*c+3]);b.push(d)}return b}static words2Buf(a){let b=Array(4*a.length);for(let c=0;c<a.length;c++){let d=a[c];b[4*c]=d>>>24&255,b[4*c+1]=d>>>16&255,b[4*c+2]=d>>>8&255,b[4*c+3]=255&d}return b}}class U{static buf2BlocksBuf(a,b){let c=b/8,d=[];for(let e=0;e<=a.length/c;e++){let f=a.slice(e*c,e*c+c);f.length<b&&(f=U.pkcs7Pad(f,b)),d.push(f)}return d}static blockBufs2Buf(a){let b=a[a.length-1];return b=U.pkcs7Unpad(b),a[a.length-1]=b,a.flat()}static encrypt(a,b,c,d){let e=8*b.length,f=U.buf2BlocksBuf(a,e);return U.encryptBlocks(f,b,c,d).flat()}static decrypt(a,b,c,d){let e=b.length,f=[];for(let b=0;b<a.length/e;b++)f.push(a.slice(b*e,b*e+e));let g=U.decryptBlocks(f,b,c,d);return U.blockBufs2Buf(g)}static encryptBlock(a,b,c,d){let e=U.xorBufs(a,b);return c.encrypt(e,d)}static decryptBlock(a,b,c,d){let e=c.decrypt(a,d);return U.xorBufs(e,b)}static encryptBlocks(a,b,c,d){let e=[];for(let f=0;f<a.length;f++){let g=a[f],h=U.encryptBlock(g,b,c,d);e.push(h),b=h}return e}static decryptBlocks(a,b,c,d){let e=[];for(let f=0;f<a.length;f++){let g=a[f],h=U.decryptBlock(g,b,c,d);e.push(h),b=g}return e}static pkcs7Pad(a,b){let c=b/8-a.length,d=Array(c);return d.fill(c),[...a,...d]}static pkcs7Unpad(a){let b=a[a.length-1],c=a.slice(a.length-b,a.length),d=Array(b);if(d.fill(b),(0,e.toHex)(c)!==(0,e.toHex)(d))throw Error("invalid padding");return a.slice(0,a.length-b)}static xorBufs(a,b){if(a.length!==b.length)throw Error("bufs must have the same length");let c=Array(a.length);for(let d=0;d<a.length;d++)c[d]=a[d]^b[d];return c}}class V{static encrypt(a,b,c,d=!0){c=c??(0,w.default)(16);let e=U.encrypt(a,c,T,b);return d?[...c,...e]:[...e]}static decrypt(a,b,c){if(null!=c)return U.decrypt(a,c,T,b);{c=a.slice(0,16);let d=a.slice(16);return U.decrypt(d,c,T,b)}}}class W{static ivkEkM(a,b){let c=b.mul(a),d=new l.default(c.x,c.y).encode(!0),e=j.sha512(d);return{iv:e.slice(0,16),kE:e.slice(16,32),kM:e.slice(32,64)}}static electrumEncrypt(a,b,c,d=!1){let f,g=null;null==c&&(c=N.default.fromRandom()),d||(g=c.toPublicKey().encode(!0));let{iv:h,kE:i,kM:k}=W.ivkEkM(c,b),l=V.encrypt(a,i,h,!1),m=(0,e.toArray)("BIE1","utf8");f=null!=g&&g.length>0?[...m,...g,...l]:[...m,...l];let n=j.sha256hmac(k,f);return[...f,...n]}static electrumDecrypt(a,b,c){let d=a.slice(0,4);if("BIE1"!==(0,e.encode)(d,"utf8"))throw Error("Invalid Magic");let f=4,g=null;if(a.length-f-32>=33){let b=a[f];2===b||3===b?(g=a.slice(f,f+33),f+=33):4===b&&(g=a.slice(f,f+65),f+=65)}if(null!==g)null==c&&(c=l.default.fromString((0,e.toHex)(g)));else if(null==c)throw Error("Sender public key is required");let{iv:h,kE:i,kM:k}=W.ivkEkM(b,c),m=a.slice(f,a.length-32),n=a.slice(a.length-32,a.length),o=j.sha256hmac(k,a.slice(0,a.length-32));if((0,e.toHex)(n)!==(0,e.toHex)(o))throw Error("Invalid checksum");return V.decrypt(m,i,h)}static bitcoreEncrypt(a,b,c,d){null==c&&(c=N.default.fromRandom()),null==d&&(d=(0,w.default)(16));let e=c,f=c.toPublicKey().encode(!0),g=b.mul(e).getX().toArray("be",32),h=j.sha512(g),i=h.slice(0,32),k=h.slice(32,64),l=V.encrypt(a,i,d),m=j.sha256hmac(k,[...l]);return[...f,...l,...m]}static bitcoreDecrypt(a,b){let c=l.default.fromString((0,e.toHex)(a.slice(0,33))).mul(b);if(c.eq(new R.default(0,0)))throw Error("P equals 0");let d=c.getX().toArray("be",32),f=j.sha512(d),g=f.slice(0,32),h=f.slice(32,64),i=a.slice(33,a.length-32),k=a.slice(a.length-32,a.length),m=j.sha256hmac(h,i);if((0,e.toHex)(k)!==(0,e.toHex)(m))throw Error("Invalid checksum");return[...V.decrypt(i,g)]}}function X(a,b){let c=new J(0,[],[],0);return c.outputs=Array(a.vout+1).fill(null),c.outputs[a.vout]={satoshis:a.satoshis,lockingScript:h.fromHex(a.script)},{sourceTransaction:c,sourceTXID:a.txid,sourceOutputIndex:a.vout,unlockingScriptTemplate:b,sequence:0xffffffff}}a.s(["default",()=>W],43143),a.s(["default",()=>X],80110),a.s([],63450)},47784,65998,96892,6982,39066,8118,42575,15515,98118,86864,66406,72024,38556,44608,48351,63545,54348,78702,63321,42221,27317,57785,33366,98139,32539,7601,48501,20211,82463,91330,24030,2405,69435,36277,8048,66904,4679,83487,51740,8198,8010,70843,64756,53967,71660,38053,3886,24656,29601,40625,71133,39430,16259,18996,54e3,39287,33434,57397,39351,20283,36488,82378,41363,90310,57166,3043,29877,71825,60787,96209,a=>{"use strict";a.i(7069),a.s([],65998);var b,c,d,e,f,g,h=a.i(15778),i=a.i(48111),j=a.i(9215),k=a.i(72922);a.i(72216),a.s([],34292);var l=a.i(76556),m=a.i(96745),n=a.i(56389),o=a.i(88497);class p{type="raw";constructor(a="raw"){this.type=a}lock(a){let b=[{op:h.default.OP_OVER},{op:h.default.OP_3},{op:h.default.OP_SPLIT},{op:h.default.OP_NIP},{op:h.default.OP_1},{op:h.default.OP_SPLIT},{op:h.default.OP_SWAP},{op:h.default.OP_SPLIT},{op:h.default.OP_DROP}];return"raw"!==this.type&&b.push({op:h.default["OP_"+this.type]}),b.push({op:a.length,data:a}),b.push({op:h.default.OP_EQUALVERIFY}),b.push({op:h.default.OP_CHECKSIG}),new j.default(b)}unlock(a,b,c="all",d=!1){return{sign:async(e,f)=>{void 0===b&&(b=m.default.fromRandom());let g=n.default.SIGHASH_FORKID;"all"===c&&(g|=n.default.SIGHASH_ALL),"none"===c&&(g|=n.default.SIGHASH_NONE),"single"===c&&(g|=n.default.SIGHASH_SINGLE),d&&(g|=n.default.SIGHASH_ANYONECANPAY);let h=[...e.inputs],[j]=h.splice(f,1);if("object"!=typeof j.sourceTransaction)throw Error("The source transaction is needed for transaction signing.");let l=n.default.format({sourceTXID:j.sourceTransaction?.id("hex")??"",sourceOutputIndex:j.sourceOutputIndex??0,sourceSatoshis:j.sourceTransaction?.outputs[j.sourceOutputIndex]?.satoshis??0,transactionVersion:e.version,otherInputs:h,inputIndex:f,outputs:e.outputs,inputSequence:j.sequence??0xffffffff,subscript:j.sourceTransaction?.outputs[j.sourceOutputIndex]?.lockingScript??new i.default,lockTime:e.lockTime,scope:g}),p=b.sign((0,o.sha256)(l),void 0,!0,a),q=new n.default(p.r,p.s,g).toChecksigFormat(),r=b.toPublicKey().encode(!0);return new k.default([{op:q.length,data:q},{op:r.length,data:r}])},estimateLength:async()=>108}}}var q=j,r=a.i(22787),r=r,s=o,t=a.i(31641),t=t,u=a.i(95320),u=u;function v(a){if(null==a)throw Error("must have value");return a}let w=a=>0===a.length||1===a.length&&0===a[0]?{op:0}:1===a.length&&a[0]>0&&a[0]<=16?{op:80+a[0]}:1===a.length&&129===a[0]?{op:79}:a.length<=75?{op:a.length,data:a}:a.length<=255?{op:76,data:a}:a.length<=65535?{op:77,data:a}:{op:78,data:a};class x{wallet;originator;static decode(a){let b=u.default.fromString(r.toHex(v(a.chunks[0].data))),c=[];for(let b=2;b<a.chunks.length;b++){let d=a.chunks[b+1]?.op,e=a.chunks[b].data??[];if(0===e.length&&(a.chunks[b].op>=80&&a.chunks[b].op<=95?e=[a.chunks[b].op-80]:0===a.chunks[b].op?e=[0]:79===a.chunks[b].op&&(e=[129])),c.push(e),d===h.default.OP_DROP||d===h.default.OP_2DROP)break}return{fields:c,lockingPublicKey:b}}constructor(a,b){this.wallet=a,this.originator=b}async lock(a,b,c,d,e=!1,f=!0,g="before"){let{publicKey:i}=await this.wallet.getPublicKey({protocolID:b,keyID:c,counterparty:d,forSelf:e},this.originator),j=[],k=[];if(j.push({op:i.length/2,data:r.toArray(i,"hex")}),j.push({op:h.default.OP_CHECKSIG}),f){let e=a.reduce((a,b)=>[...a,...b],[]),{signature:f}=await this.wallet.createSignature({data:e,protocolID:b,keyID:c,counterparty:d},this.originator);a.push(f)}for(let b of a)k.push(w(b));let l=a.length;for(;l>1;)k.push({op:h.default.OP_2DROP}),l-=2;return new q.default((0!==l&&k.push({op:h.default.OP_DROP}),"before"===g)?[...j,...k]:[...k,...j])}unlock(a,b,c,d="all",e=!1,f,g){return{sign:async(h,i)=>{let j=n.default.SIGHASH_FORKID;"all"===d&&(j|=n.default.SIGHASH_ALL),"none"===d&&(j|=n.default.SIGHASH_NONE),"single"===d&&(j|=n.default.SIGHASH_SINGLE),e&&(j|=n.default.SIGHASH_ANYONECANPAY);let l=h.inputs[i],m=h.inputs.filter((a,b)=>b!==i),o=l.sourceTXID??l.sourceTransaction?.id("hex");if(null==o||void 0===o)throw Error("The input sourceTXID or sourceTransaction is required for transaction signing.");if(null==(f||=l.sourceTransaction?.outputs[l.sourceOutputIndex].satoshis)||void 0===f)throw Error("The sourceSatoshis or input sourceTransaction is required for transaction signing.");if(null==(g||=l.sourceTransaction?.outputs[l.sourceOutputIndex].lockingScript))throw Error("The lockingScript or input sourceTransaction is required for transaction signing.");let p=n.default.format({sourceTXID:o,sourceOutputIndex:v(l.sourceOutputIndex),sourceSatoshis:f,transactionVersion:h.version,otherInputs:m,inputIndex:i,outputs:h.outputs,inputSequence:l.sequence??0xffffffff,subscript:g,lockTime:h.lockTime,scope:j}),q=s.sha256(p),{signature:r}=await this.wallet.createSignature({data:q,protocolID:a,keyID:b,counterparty:c},this.originator),u=t.default.fromDER([...r]),w=new n.default(u.r,u.s,j).toChecksigFormat();return new k.default([{op:w.length,data:w}])},estimateLength:async()=>73}}}var y=a.i(79289);function z(a){return"success"===a.status}function A(a){return"error"===a.status}a.i(27921),a.s(["isBroadcastFailure",()=>A,"isBroadcastResponse",()=>z],96892),a.i(25721);var B=a.i(43337),C=B;class D extends C.Beef{knownTo={};constructor(a){if(super(),null!=a)for(const b of a)this.addParty(b)}isParty(a){return Object.keys(this.knownTo).includes(a)}addParty(a){if(this.isParty(a))throw Error(`Party ${a} already exists.`);this.knownTo[a]={}}getKnownTxidsForParty(a){let b=this.knownTo[a];if(void 0===b)throw Error(`Party ${a} is unknown.`);return Object.keys(b)}getTrimmedBeefForParty(a){let b=this.getKnownTxidsForParty(a),c=this.clone();return c.trimKnownTxids(b),c}addKnownTxidsForParty(a,b){this.isParty(a)||this.addParty(a);let c=this.knownTo[a];for(let a of b)c[a]=!0,this.mergeTxidOnly(a)}mergeBeefFromParty(a,b){let c=Array.isArray(b)?C.Beef.fromBinary(b):b,d=c.getValidTxids();this.mergeBeef(c),this.addKnownTxidsForParty(a,d)}}a.s(["default",0,D],6982),a.s([],39066),a.i(35581),a.s([],8118),a.i(76735);var E=a.i(43172);class F{network;URL;httpClient;constructor(a="main",b=(0,E.defaultHttpClient)()){this.network=a,this.URL=`https://api.whatsonchain.com/v1/bsv/${a}/tx/raw`,this.httpClient=b}async broadcast(a){let b=a.toHex();try{let a=await this.httpClient.request(this.URL,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/plain"},data:{txhex:b}});if(!a.ok)return{status:"error",code:a.status.toString()??"ERR_UNKNOWN",description:a.data??"Unknown error"};{let b=a.data;return{status:"success",txid:b,message:"broadcast successful"}}}catch(a){return{status:"error",code:"500",description:"string"==typeof a.message?a.message:"Internal Server Error"}}}}a.s(["default",()=>F],42575);class G{https;constructor(a){this.https=a}async request(a,b){return await new Promise((c,d)=>{let e=this.https.request(a,b,a=>{let b="";a.on("data",a=>{b+=a}),a.on("end",()=>{let d=a.statusCode>=200&&a.statusCode<=299,e=a.headers["content-type"],f=""!==b&&"string"==typeof e&&e.startsWith("application/json")?JSON.parse(b):b;c({status:a.statusCode,statusText:a.statusMessage,ok:d,data:f})})});e.on("error",a=>{d(a)}),null!==b.data&&void 0!==b.data&&e.write(Buffer.from(b.data)),e.end()})}}function H(){try{let b=a.r(24836);return new G(b)}catch(a){return{async request(){throw Error("No method available to perform HTTP request")}}}}a.s(["binaryHttpClient",()=>H],15515),a.i(18792),a.i(83818),a.s([],98118);class I{URL;httpClient;constructor(a,b=H()){this.URL=a,this.httpClient=b}async broadcast(a){let b={method:"POST",headers:{"Content-Type":"application/octet-stream"},data:new Blob([new Uint8Array(a.toEF())])};try{let c=await this.httpClient.request(this.URL,b);if(!c.ok)return{status:"error",code:c.status.toString()??"ERR_UNKNOWN",description:c.data??"Unknown error"};{let b=a.id("hex");return{status:"success",txid:b,message:"broadcast successful"}}}catch(a){return{status:"error",code:"500",description:"string"==typeof a.message?a.message:"Internal Server Error"}}}}a.s(["default",()=>I],86864),a.i(91512),a.s([],66406),a.i(38498),a.i(41089),a.s([],72024);var J=u,K=t,L=a.i(27872),M=a.i(60933),N=r;let O="42423301";a.s(["sign",0,(a,b,c)=>{let d="object"!=typeof c;if(d){let a=new L.default,b=new m.default(1),d=a.g.mul(b);c=new J.default(d.x,d.y)}let e=(0,M.default)(32),f=(0,N.toBase64)(e),g=`2-message signing-${f}`,h=b.deriveChild(c,g).sign(a).toDER(),i=b.toPublicKey().encode(!0);return[...(0,N.toArray)(O,"hex"),...i,...d?[0]:c.encode(!0),...e,...h]},"verify",0,(a,b,c)=>{let d=new N.Reader(b),e=(0,N.toHex)(d.read(4));if(e!==O)throw Error(`Message version mismatch: Expected ${O}, received ${e}`);let f=J.default.fromString((0,N.toHex)(d.read(33))),[g]=d.read(1);if(0===g)c=new m.default(1);else{let a=d.read(32),b=(0,N.toHex)([g,...a]);if("object"!=typeof c)throw Error(`This signature can only be verified with knowledge of a specific private key. The associated public key is: ${b}`);let e=c.toPublicKey().encode(!0,"hex");if(b!==e)throw Error(`The recipient public key is ${e} but the signature requres the recipient to have public key ${b}`)}let h=(0,N.toBase64)(d.read(32)),i=(0,N.toHex)(d.read(d.bin.length-d.pos)),j=K.default.fromDER(i,"hex"),k=`2-message signing-${h}`;return f.deriveChild(c,k).verify(a,j)}],38556);var P=u,Q=a.i(91010),R=r;let S="42421033";a.s(["decrypt",0,(a,b)=>{let c=new R.Reader(a),d=(0,R.toHex)(c.read(4));if(d!==S)throw Error(`Message version mismatch: Expected ${S}, received ${d}`);let e=P.default.fromString((0,R.toHex)(c.read(33))),f=(0,R.toHex)(c.read(33)),g=b.toPublicKey().encode(!0,"hex");if(f!==g)throw Error(`The encrypted message expects a recipient public key of ${f}, but the provided key is ${g}`);let h=(0,R.toBase64)(c.read(32)),i=c.read(c.bin.length-c.pos),j=`2-message encryption-${h}`,k=e.deriveChild(b,j),l=b.deriveChild(e,j),m=k.deriveSharedSecret(l);return new Q.default(m.encode(!0).slice(1)).decrypt(i)},"encrypt",0,(a,b,c)=>{let d=(0,M.default)(32),e=(0,R.toBase64)(d),f=`2-message encryption-${e}`,g=b.deriveChild(c,f),h=c.deriveChild(b,f),i=g.deriveSharedSecret(h),j=new Q.default(i.encode(!0).slice(1)).encrypt(a),k=b.toPublicKey().encode(!0);return[...(0,R.toArray)(S,"hex"),...k,...c.encode(!0),...d,...j]}],44608),a.s([],48351),a.i(63450);var T=a.i(89058);class U{static generate(a,b){let c=this.withDefaultOptions(b);return V(a,this.getCounter(c.timestamp,c.period),c)}static validate(a,b,c){let d=this.withDefaultValidateOptions(c);if((b=b.trim()).length!==d.digits)return!1;let e=this.getCounter(d.timestamp,d.period),f=[e];for(let a=1;a<=d.skew;a++)f.push(e+a),f.push(e-a);for(let c of f)if(b===V(a,c,d))return!0;return!1}static getCounter(a,b){return Math.floor(Math.floor(a/1e3)/b)}static withDefaultOptions(a){return{digits:2,algorithm:"SHA-1",period:30,timestamp:Date.now(),...a}}static withDefaultValidateOptions(a){return{skew:1,...this.withDefaultOptions(a)}}}function V(a,b,c){let d=(function(a,b,c){switch(c){case"SHA-1":return new o.SHA1HMAC(a).update(b);case"SHA-256":return new o.SHA256HMAC(a).update(b);case"SHA-512":return new o.SHA512HMAC(a).update(b);default:throw Error("unsupported HMAC algorithm")}})(a,new T.default(b).toArray("be",8),c.algorithm).digest(),e=15&d[d.length-1],f=d.slice(e,e+4);return(0x7fffffff&new T.default(f).toNumber()).toString().slice(-c.digits)}a.s(["TOTP",()=>U],63545),a.s([],54348),(b=e||(e={}))[b.Silent=0]="Silent",b[b.App=1]="App",b[b.Counterparty=2]="Counterparty",a.s(["SecurityLevels",()=>e],78702);var W=a.i(84818),u=u,s=o,r=r;class X{rootKey;identityKey;constructor(a){"anyone"===a?this.rootKey=new W.PrivateKey(1):this.rootKey=a,this.identityKey=this.rootKey.toPublicKey().toString()}derivePublicKey(a,b,c,d=!1){return(c=this.normalizeCounterparty(c),d)?this.rootKey.deriveChild(c,this.computeInvoiceNumber(a,b)).toPublicKey():c.deriveChild(this.rootKey,this.computeInvoiceNumber(a,b))}derivePrivateKey(a,b,c){return c=this.normalizeCounterparty(c),this.rootKey.deriveChild(c,this.computeInvoiceNumber(a,b))}deriveSymmetricKey(a,b,c){"anyone"===c&&(c=new W.PrivateKey(1).toPublicKey()),c=this.normalizeCounterparty(c);let d=this.derivePublicKey(a,b,c),e=this.derivePrivateKey(a,b,c);return new Q.default(e.deriveSharedSecret(d)?.x?.toArray()??[])}revealCounterpartySecret(a){if("self"===a)throw Error("Counterparty secrets cannot be revealed for counterparty=self.");a=this.normalizeCounterparty(a);let b=this.rootKey.toPublicKey();if(this.rootKey.deriveChild(b,"test").toHex()===this.rootKey.deriveChild(a,"test").toHex())throw Error("Counterparty secrets cannot be revealed for counterparty=self.");return this.rootKey.deriveSharedSecret(a).encode(!0)}revealSpecificSecret(a,b,c){a=this.normalizeCounterparty(a);let d=this.rootKey.deriveSharedSecret(a),e=r.toArray(this.computeInvoiceNumber(b,c),"utf8");return s.sha256hmac(d.encode(!0),e)}normalizeCounterparty(a){if(null==a)throw Error("counterparty must be self, anyone or a public key!");return"self"===a?this.rootKey.toPublicKey():"anyone"===a?new W.PrivateKey(1).toPublicKey():"string"==typeof a?u.default.fromString(a):a}computeInvoiceNumber(a,b){let c=a[0];if(!Number.isInteger(c)||c<0||c>2)throw Error("Protocol security level must be 0, 1, or 2");let d=a[1].toLowerCase().trim();if(b.length>800)throw Error("Key IDs must be 800 characters or less");if(b.length<1)throw Error("Key IDs must be 1 character or more");if(d.length>400)if(d.startsWith("specific linkage revelation ")){if(d.length>430)throw Error("Specific linkage revelation protocol names must be 430 characters or less")}else throw Error("Protocol names must be 400 characters or less");if(d.length<5)throw Error("Protocol names must be 5 characters or more");if(d.includes("  "))throw Error('Protocol names cannot contain multiple consecutive spaces ("  ")');if(!/^[a-z0-9 ]+$/g.test(d))throw Error("Protocol names can only contain letters, numbers and spaces");if(d.endsWith(" protocol"))throw Error('No need to end your protocol name with " protocol"');return`${c}-${d}-${b}`}}a.s(["KeyDeriver",()=>X,"default",0,X],63321);var u=u;class Y{keyDeriver;cache;maxCacheSize;constructor(a,b){this.keyDeriver=new X(a),this.cache=new Map;const c=b?.maxCacheSize;this.maxCacheSize=null!=c&&!isNaN(c)&&c>0?c:1e3}derivePublicKey(a,b,c,d=!1){let e=this.generateCacheKey("derivePublicKey",a,b,c,d);if(this.cache.has(e)){let a=this.cacheGet(e);if(void 0===a)throw Error("Cached value is undefined");return a}{let f=this.keyDeriver.derivePublicKey(a,b,c,d);return this.cacheSet(e,f),f}}derivePrivateKey(a,b,c){let d=this.generateCacheKey("derivePrivateKey",a,b,c);if(this.cache.has(d)){let a=this.cacheGet(d);if(void 0===a)throw Error("Cached value is undefined");return a}{let e=this.keyDeriver.derivePrivateKey(a,b,c);return this.cacheSet(d,e),e}}deriveSymmetricKey(a,b,c){let d=this.generateCacheKey("deriveSymmetricKey",a,b,c);if(this.cache.has(d)){let a=this.cacheGet(d);if(void 0===a)throw Error("Cached value is undefined");return a}{let e=this.keyDeriver.deriveSymmetricKey(a,b,c);return this.cacheSet(d,e),e}}revealCounterpartySecret(a){let b=this.generateCacheKey("revealCounterpartySecret",a);if(this.cache.has(b)){let a=this.cacheGet(b);if(void 0===a)throw Error("Cached value is undefined");return a}{let c=this.keyDeriver.revealCounterpartySecret(a);return this.cacheSet(b,c),c}}revealSpecificSecret(a,b,c){let d=this.generateCacheKey("revealSpecificSecret",a,b,c);if(this.cache.has(d)){let a=this.cacheGet(d);if(void 0===a)throw Error("Cached value is undefined");return a}{let e=this.keyDeriver.revealSpecificSecret(a,b,c);return this.cacheSet(d,e),e}}generateCacheKey(a,...b){let c=b.map(a=>this.serializeArgument(a)).join("|");return`${a}|${c}`}serializeArgument(a){return a instanceof u.default||a instanceof W.PrivateKey?a.toString():Array.isArray(a)?a.map(a=>this.serializeArgument(a)).join(","):"object"==typeof a&&null!==a?JSON.stringify(a):String(a)}cacheGet(a){let b=this.cache.get(a);return this.cache.delete(a),void 0!==b&&this.cache.set(a,b),b}cacheSet(a,b){if(this.cache.size>=this.maxCacheSize){let a=this.cache.keys().next().value;this.cache.delete(a)}this.cache.set(a,b)}}a.s(["default",()=>Y],42221);var s=o,Z=a.i(15512),Z=Z,t=t,$=a.i(85183),$=$,u=u,_=a.i(81719),_=_;let aa=class{keyDeriver;constructor(a){"string"!=typeof a.identityKey&&(a=new X(a)),this.keyDeriver=a}async getPublicKey(a){if(a.identityKey){if(null==this.keyDeriver)throw Error("keyDeriver is undefined");return{publicKey:this.keyDeriver.rootKey.toPublicKey().toString()}}if(null==a.protocolID||null==a.keyID||""===a.keyID)throw Error("protocolID and keyID are required if identityKey is false or undefined.");return{publicKey:(this.keyDeriver??(()=>{throw Error("keyDeriver is undefined")})()).derivePublicKey(a.protocolID,a.keyID,a.counterparty??"self",a.forSelf).toString()}}async revealCounterpartyKeyLinkage(a){let{publicKey:b}=await this.getPublicKey({identityKey:!0});if(null==this.keyDeriver)throw Error("keyDeriver is undefined");let c=this.keyDeriver.revealCounterpartySecret(a.counterparty),d=new $.default().generateProof(this.keyDeriver.rootKey,this.keyDeriver.rootKey.toPublicKey(),u.default.fromString(a.counterparty),_.default.fromDER(c)),e=[...d.R.encode(!0),...d.SPrime.encode(!0),...d.z.toArray()],f=new Date().toISOString(),{ciphertext:g}=await this.encrypt({plaintext:c,protocolID:[2,"counterparty linkage revelation"],keyID:f,counterparty:a.verifier}),{ciphertext:h}=await this.encrypt({plaintext:e,protocolID:[2,"counterparty linkage revelation"],keyID:f,counterparty:a.verifier});return{prover:b,verifier:a.verifier,counterparty:a.counterparty,revelationTime:f,encryptedLinkage:g,encryptedLinkageProof:h}}async revealSpecificKeyLinkage(a){let{publicKey:b}=await this.getPublicKey({identityKey:!0});if(null==this.keyDeriver)throw Error("keyDeriver is undefined");let c=this.keyDeriver.revealSpecificSecret(a.counterparty,a.protocolID,a.keyID),{ciphertext:d}=await this.encrypt({plaintext:c,protocolID:[2,`specific linkage revelation ${a.protocolID[0]} ${a.protocolID[1]}`],keyID:a.keyID,counterparty:a.verifier}),{ciphertext:e}=await this.encrypt({plaintext:[0],protocolID:[2,`specific linkage revelation ${a.protocolID[0]} ${a.protocolID[1]}`],keyID:a.keyID,counterparty:a.verifier});return{prover:b,verifier:a.verifier,counterparty:a.counterparty,protocolID:a.protocolID,keyID:a.keyID,encryptedLinkage:d,encryptedLinkageProof:e,proofType:0}}async encrypt(a){if(null==this.keyDeriver)throw Error("keyDeriver is undefined");return{ciphertext:this.keyDeriver.deriveSymmetricKey(a.protocolID,a.keyID,a.counterparty??"self").encrypt(a.plaintext)}}async decrypt(a){if(null==this.keyDeriver)throw Error("keyDeriver is undefined");return{plaintext:this.keyDeriver.deriveSymmetricKey(a.protocolID,a.keyID,a.counterparty??"self").decrypt(a.ciphertext)}}async createHmac(a){if(null==this.keyDeriver)throw Error("keyDeriver is undefined");let b=this.keyDeriver.deriveSymmetricKey(a.protocolID,a.keyID,a.counterparty??"self");return{hmac:s.sha256hmac(b.toArray(),a.data)}}async verifyHmac(a){if(null==this.keyDeriver)throw Error("keyDeriver is undefined");let b=this.keyDeriver.deriveSymmetricKey(a.protocolID,a.keyID,a.counterparty??"self"),c=s.sha256hmac(b.toArray(),a.data).toString()===a.hmac.toString();if(!c){let a=Error("HMAC is not valid");throw a.code="ERR_INVALID_HMAC",a}return{valid:c}}async createSignature(a){if(null==a.hashToDirectlySign&&null==a.data)throw Error("args.data or args.hashToDirectlySign must be valid");let b=a.hashToDirectlySign??s.sha256(a.data??[]),c=(this.keyDeriver??(()=>{throw Error("keyDeriver is undefined")})()).derivePrivateKey(a.protocolID,a.keyID,a.counterparty??"anyone");return{signature:Z.sign(new T.default(b),c,!0).toDER()}}async verifySignature(a){if(null==a.hashToDirectlyVerify&&null==a.data)throw Error("args.data or args.hashToDirectlyVerify must be valid");let b=a.hashToDirectlyVerify??s.sha256(a.data??[]),c=(this.keyDeriver??(()=>{throw Error("keyDeriver is undefined")})()).derivePublicKey(a.protocolID,a.keyID,a.counterparty??"self",a.forSelf),d=Z.verify(new T.default(b),t.default.fromDER(a.signature),c);if(!d){let a=Error("Signature is not valid");throw a.code="ERR_INVALID_SIGNATURE",a}return{valid:d}}};a.s(["default",0,aa],27317);class ab{CWI;constructor(){throw Error("The window.CWI substrate requires a global window object.")}async createAction(a,b){return await this.CWI.createAction(a,b)}async signAction(a,b){return await this.CWI.signAction(a,b)}async abortAction(a,b){return await this.CWI.abortAction(a,b)}async listActions(a,b){return await this.CWI.listActions(a,b)}async internalizeAction(a,b){return await this.CWI.internalizeAction(a,b)}async listOutputs(a,b){return await this.CWI.listOutputs(a,b)}async relinquishOutput(a,b){return await this.CWI.relinquishOutput(a,b)}async getPublicKey(a,b){return await this.CWI.getPublicKey(a,b)}async revealCounterpartyKeyLinkage(a,b){return await this.CWI.revealCounterpartyKeyLinkage(a,b)}async revealSpecificKeyLinkage(a,b){return await this.CWI.revealSpecificKeyLinkage(a,b)}async encrypt(a,b){return await this.CWI.encrypt(a,b)}async decrypt(a,b){return await this.CWI.decrypt(a,b)}async createHmac(a,b){return await this.CWI.createHmac(a,b)}async verifyHmac(a,b){return await this.CWI.verifyHmac(a,b)}async createSignature(a,b){return await this.CWI.createSignature(a,b)}async verifySignature(a,b){return await this.CWI.verifySignature(a,b)}async acquireCertificate(a,b){return await this.CWI.acquireCertificate(a,b)}async listCertificates(a,b){return await this.CWI.listCertificates(a,b)}async proveCertificate(a,b){return await this.CWI.proveCertificate(a,b)}async relinquishCertificate(a,b){return await this.CWI.relinquishCertificate(a,b)}async discoverByIdentityKey(a,b){return await this.CWI.discoverByIdentityKey(a,b)}async discoverByAttributes(a,b){return await this.CWI.discoverByAttributes(a,b)}async isAuthenticated(a,b){return await this.CWI.isAuthenticated(a,b)}async waitForAuthentication(a,b){return await this.CWI.waitForAuthentication(a,b)}async getHeight(a,b){return await this.CWI.getHeight(a,b)}async getHeaderForHeight(a,b){return await this.CWI.getHeaderForHeight(a,b)}async getNetwork(a,b){return await this.CWI.getNetwork(a,b)}async getVersion(a,b){return await this.CWI.getVersion(a,b)}}a.s(["default",()=>ab],57785);var ac=r;class ad extends Error{code;isError=!0;constructor(a,b=1,c){super(a),this.code=b,this.name=this.constructor.name,null!=c&&""!==c?this.stack=c:Error.captureStackTrace(this,this.constructor)}}(c=f||(f={}))[c.unknownError=1]="unknownError",c[c.unsupportedAction=2]="unsupportedAction",c[c.invalidHmac=3]="invalidHmac",c[c.invalidSignature=4]="invalidSignature",c[c.reviewActions=5]="reviewActions",a.s(["WalletError",()=>ad,"default",0,ad,"walletErrors",()=>f],33366);class ae{domain;constructor(a="*"){throw Error("The XDM substrate requires a global window object.")}async invoke(a,b){return await new Promise((c,d)=>{let e=ac.toBase64((0,M.default)(12)),f=a=>{"CWI"===a.data.type&&a.isTrusted&&a.data.id===e&&!0!==a.data.isInvocation&&("function"==typeof window.removeEventListener&&window.removeEventListener("message",f),"error"===a.data.status?d(new ad(a.data.description,a.data.code)):c(a.data.result))};window.addEventListener("message",f),window.parent.postMessage({type:"CWI",isInvocation:!0,id:e,call:a,args:b},this.domain)})}async createAction(a){return await this.invoke("createAction",a)}async signAction(a){return await this.invoke("signAction",a)}async abortAction(a){return await this.invoke("abortAction",a)}async listActions(a){return await this.invoke("listActions",a)}async internalizeAction(a){return await this.invoke("internalizeAction",a)}async listOutputs(a){return await this.invoke("listOutputs",a)}async relinquishOutput(a){return await this.invoke("relinquishOutput",a)}async getPublicKey(a){return await this.invoke("getPublicKey",a)}async revealCounterpartyKeyLinkage(a){return await this.invoke("revealCounterpartyKeyLinkage",a)}async revealSpecificKeyLinkage(a){return await this.invoke("revealSpecificKeyLinkage",a)}async encrypt(a){return await this.invoke("encrypt",a)}async decrypt(a){return await this.invoke("decrypt",a)}async createHmac(a){return await this.invoke("createHmac",a)}async verifyHmac(a){return await this.invoke("verifyHmac",a)}async createSignature(a){return await this.invoke("createSignature",a)}async verifySignature(a){return await this.invoke("verifySignature",a)}async acquireCertificate(a){return await this.invoke("acquireCertificate",a)}async listCertificates(a){return await this.invoke("listCertificates",a)}async proveCertificate(a){return await this.invoke("proveCertificate",a)}async relinquishCertificate(a){return await this.invoke("relinquishCertificate",a)}async discoverByIdentityKey(a){return await this.invoke("discoverByIdentityKey",a)}async discoverByAttributes(a){return await this.invoke("discoverByAttributes",a)}async isAuthenticated(a){return await this.invoke("isAuthenticated",a)}async waitForAuthentication(a){return await this.invoke("waitForAuthentication",a)}async getHeight(a){return await this.invoke("getHeight",a)}async getHeaderForHeight(a){return await this.invoke("getHeaderForHeight",a)}async getNetwork(a){return await this.invoke("getNetwork",a)}async getVersion(a){return await this.invoke("getVersion",a)}}a.s(["default",()=>ae],98139);var af=r,ag=t;class ah{type;serialNumber;subject;certifier;revocationOutpoint;fields;signature;constructor(a,b,c,d,e,f,g){this.type=a,this.serialNumber=b,this.subject=c,this.certifier=d,this.revocationOutpoint=e,this.fields=f,this.signature=g}toBinary(a=!0){let b=new af.Writer,c=af.toArray(this.type,"base64");b.write(c);let d=af.toArray(this.serialNumber,"base64");b.write(d);let e=af.toArray(this.subject,"hex");b.write(e);let f=af.toArray(this.certifier,"hex");b.write(f);let[g,h]=this.revocationOutpoint.split("."),i=af.toArray(g,"hex");b.write(i),b.writeVarIntNum(Number(h));let j=Object.keys(this.fields).sort();for(let a of(b.writeVarIntNum(j.length),j)){let c=this.fields[a],d=af.toArray(a,"utf8");b.writeVarIntNum(d.length),b.write(d);let e=af.toArray(c,"utf8");b.writeVarIntNum(e.length),b.write(e)}if(a&&(this.signature??"").length>0){let a=af.toArray(this.signature,"hex");b.write(a)}return b.toArray()}static fromBinary(a){let b,c=new af.Reader(a),d=c.read(32),e=af.toBase64(d),f=c.read(32),g=af.toBase64(f),h=c.read(33),i=af.toHex(h),j=c.read(33),k=af.toHex(j),l=c.read(32),m=af.toHex(l),n=c.readVarIntNum(),o=`${m}.${n}`,p=c.readVarIntNum(),q={};for(let a=0;a<p;a++){let a=c.readVarIntNum(),b=c.read(a),d=af.toUTF8(b),e=c.readVarIntNum(),f=c.read(e),g=af.toUTF8(f);q[d]=g}if(!c.eof()){let a=c.read();b=ag.default.fromDER(a).toString("hex")}return new ah(e,g,i,k,o,q,b)}async verify(){let a=new aa("anyone"),b=this.toBinary(!1),c=this.signature??"",{valid:d}=await a.verifySignature({signature:af.toArray(c,"hex"),data:b,protocolID:[2,"certificate signature"],keyID:`${this.type} ${this.serialNumber}`,counterparty:this.certifier});return d}async sign(a){if(null!=this.signature&&this.signature.length>0)throw Error(`Certificate has already been signed! Signature present: ${this.signature}`);this.certifier=(await a.getPublicKey({identityKey:!0})).publicKey;let b=this.toBinary(!1),{signature:c}=await a.createSignature({data:b,protocolID:[2,"certificate signature"],keyID:`${this.type} ${this.serialNumber}`});this.signature=af.toHex(c)}static getCertificateFieldEncryptionDetails(a,b){return{protocolID:[2,"certificate field encryption"],keyID:b?`${b} ${a}`:a}}}a.s(["default",()=>ah],32539);var ai=r;(d=g||(g={}))[d.createAction=1]="createAction",d[d.signAction=2]="signAction",d[d.abortAction=3]="abortAction",d[d.listActions=4]="listActions",d[d.internalizeAction=5]="internalizeAction",d[d.listOutputs=6]="listOutputs",d[d.relinquishOutput=7]="relinquishOutput",d[d.getPublicKey=8]="getPublicKey",d[d.revealCounterpartyKeyLinkage=9]="revealCounterpartyKeyLinkage",d[d.revealSpecificKeyLinkage=10]="revealSpecificKeyLinkage",d[d.encrypt=11]="encrypt",d[d.decrypt=12]="decrypt",d[d.createHmac=13]="createHmac",d[d.verifyHmac=14]="verifyHmac",d[d.createSignature=15]="createSignature",d[d.verifySignature=16]="verifySignature",d[d.acquireCertificate=17]="acquireCertificate",d[d.listCertificates=18]="listCertificates",d[d.proveCertificate=19]="proveCertificate",d[d.relinquishCertificate=20]="relinquishCertificate",d[d.discoverByIdentityKey=21]="discoverByIdentityKey",d[d.discoverByAttributes=22]="discoverByAttributes",d[d.isAuthenticated=23]="isAuthenticated",d[d.waitForAuthentication=24]="waitForAuthentication",d[d.getHeight=25]="getHeight",d[d.getHeaderForHeight=26]="getHeaderForHeight",d[d.getNetwork=27]="getNetwork",d[d.getVersion=28]="getVersion";let aj=g;a.s(["default",0,aj],7601);class ak{wire;constructor(a){this.wire=a}async transmit(a,b="",c=[]){let d=new ai.Writer;d.writeUInt8(aj[a]);let e=ai.toArray(b,"utf8");d.writeUInt8(e.length),d.write(e),c.length>0&&d.write(c);let f=d.toArray(),g=await this.wire.transmitToWallet(f),h=new ai.Reader(g),i=h.readUInt8();if(0===i)return h.read();{let a=h.readVarIntNum(),b=h.read(a),c=ai.toUTF8(b),d=h.readVarIntNum(),e=h.read(d);throw new ad(c,i,ai.toUTF8(e))}}async createAction(a,b){let c=new ai.Writer,d=ai.toArray(a.description,"utf8");if(c.writeVarIntNum(d.length),c.write(d),null!=a.inputBEEF?(c.writeVarIntNum(a.inputBEEF.length),c.write(a.inputBEEF)):c.writeVarIntNum(-1),null!=a.inputs)for(let b of(c.writeVarIntNum(a.inputs.length),a.inputs)){if(c.write(this.encodeOutpoint(b.outpoint)),null!=b.unlockingScript&&""!==b.unlockingScript){let a=ai.toArray(b.unlockingScript,"hex");c.writeVarIntNum(a.length),c.write(a)}else c.writeVarIntNum(-1),c.writeVarIntNum(b.unlockingScriptLength??0);let a=ai.toArray(b.inputDescription,"utf8");c.writeVarIntNum(a.length),c.write(a),"number"==typeof b.sequenceNumber?c.writeVarIntNum(b.sequenceNumber):c.writeVarIntNum(-1)}else c.writeVarIntNum(-1);if(null!=a.outputs)for(let b of(c.writeVarIntNum(a.outputs.length),a.outputs)){let a=ai.toArray(b.lockingScript,"hex");c.writeVarIntNum(a.length),c.write(a),c.writeVarIntNum(b.satoshis);let d=ai.toArray(b.outputDescription,"utf8");if(c.writeVarIntNum(d.length),c.write(d),null!=b.basket&&""!==b.basket){let a=ai.toArray(b.basket,"utf8");c.writeVarIntNum(a.length),c.write(a)}else c.writeVarIntNum(-1);if(null!=b.customInstructions&&""!==b.customInstructions){let a=ai.toArray(b.customInstructions,"utf8");c.writeVarIntNum(a.length),c.write(a)}else c.writeVarIntNum(-1);if(null!=b.tags)for(let a of(c.writeVarIntNum(b.tags.length),b.tags)){let b=ai.toArray(a,"utf8");c.writeVarIntNum(b.length),c.write(b)}else c.writeVarIntNum(-1)}else c.writeVarIntNum(-1);if("number"==typeof a.lockTime?c.writeVarIntNum(a.lockTime):c.writeVarIntNum(-1),"number"==typeof a.version?c.writeVarIntNum(a.version):c.writeVarIntNum(-1),null!=a.labels)for(let b of(c.writeVarIntNum(a.labels.length),a.labels)){let a=ai.toArray(b,"utf8");c.writeVarIntNum(a.length),c.write(a)}else c.writeVarIntNum(-1);if(null!=a.options){if(c.writeInt8(1),"boolean"==typeof a.options.signAndProcess?c.writeInt8(+!!a.options.signAndProcess):c.writeInt8(-1),"boolean"==typeof a.options.acceptDelayedBroadcast?c.writeInt8(+!!a.options.acceptDelayedBroadcast):c.writeInt8(-1),"known"===a.options.trustSelf?c.writeInt8(1):c.writeInt8(-1),null!=a.options.knownTxids)for(let b of(c.writeVarIntNum(a.options.knownTxids.length),a.options.knownTxids)){let a=ai.toArray(b,"hex");c.write(a)}else c.writeVarIntNum(-1);if("boolean"==typeof a.options.returnTXIDOnly?c.writeInt8(+!!a.options.returnTXIDOnly):c.writeInt8(-1),"boolean"==typeof a.options.noSend?c.writeInt8(+!!a.options.noSend):c.writeInt8(-1),null!=a.options.noSendChange)for(let b of(c.writeVarIntNum(a.options.noSendChange.length),a.options.noSendChange))c.write(this.encodeOutpoint(b));else c.writeVarIntNum(-1);if(null!=a.options.sendWith)for(let b of(c.writeVarIntNum(a.options.sendWith.length),a.options.sendWith)){let a=ai.toArray(b,"hex");c.write(a)}else c.writeVarIntNum(-1);"boolean"==typeof a.options.randomizeOutputs?c.writeInt8(+!!a.options.randomizeOutputs):c.writeInt8(-1)}else c.writeInt8(0);let e=await this.transmit("createAction",b,c.toArray()),f=new ai.Reader(e),g={};if(1===f.readInt8()){let a=f.read(32);g.txid=ai.toHex(a)}if(1===f.readInt8()){let a=f.readVarIntNum();g.tx=f.read(a)}let h=f.readVarIntNum();if(h>=0){g.noSendChange=[];for(let a=0;a<h;a++){let a=this.readOutpoint(f);g.noSendChange.push(a)}}let i=f.readVarIntNum();if(i>=0){g.sendWithResults=[];for(let a=0;a<i;a++){let a=f.read(32),b=ai.toHex(a),c=f.readInt8(),d="unproven";1===c?d="unproven":2===c?d="sending":3===c&&(d="failed"),g.sendWithResults.push({txid:b,status:d})}}if(1===f.readInt8()){let a=f.readVarIntNum(),b=f.read(a),c=f.readVarIntNum(),d=f.read(c);g.signableTransaction={tx:b,reference:ai.toBase64(d)}}return g}async signAction(a,b){let c=new ai.Writer,d=Object.keys(a.spends);for(let b of(c.writeVarIntNum(d.length),d)){c.writeVarIntNum(Number(b));let d=a.spends[Number(b)],e=ai.toArray(d.unlockingScript,"hex");c.writeVarIntNum(e.length),c.write(e),"number"==typeof d.sequenceNumber?c.writeVarIntNum(d.sequenceNumber):c.writeVarIntNum(-1)}let e=ai.toArray(a.reference,"base64");if(c.writeVarIntNum(e.length),c.write(e),null!=a.options)if(c.writeInt8(1),"boolean"==typeof a.options.acceptDelayedBroadcast?c.writeInt8(+!!a.options.acceptDelayedBroadcast):c.writeInt8(-1),"boolean"==typeof a.options.returnTXIDOnly?c.writeInt8(+!!a.options.returnTXIDOnly):c.writeInt8(-1),"boolean"==typeof a.options.noSend?c.writeInt8(+!!a.options.noSend):c.writeInt8(-1),null!=a.options.sendWith)for(let b of(c.writeVarIntNum(a.options.sendWith.length),a.options.sendWith)){let a=ai.toArray(b,"hex");c.write(a)}else c.writeVarIntNum(-1);else c.writeInt8(0);let f=await this.transmit("signAction",b,c.toArray()),g=new ai.Reader(f),h={};if(1===g.readInt8()){let a=g.read(32);h.txid=ai.toHex(a)}if(1===g.readInt8()){let a=g.readVarIntNum();h.tx=g.read(a)}let i=g.readVarIntNum();if(i>=0){h.sendWithResults=[];for(let a=0;a<i;a++){let a=g.read(32),b=ai.toHex(a),c=g.readInt8(),d="unproven";1===c?d="unproven":2===c?d="sending":3===c&&(d="failed"),h.sendWithResults.push({txid:b,status:d})}}return h}async abortAction(a,b){return await this.transmit("abortAction",b,ai.toArray(a.reference,"base64")),{aborted:!0}}async listActions(a,b){let c=new ai.Writer;for(let b of(c.writeVarIntNum(a.labels.length),a.labels)){let a=ai.toArray(b,"utf8");c.writeVarIntNum(a.length),c.write(a)}for(let b of("any"===a.labelQueryMode?c.writeInt8(1):"all"===a.labelQueryMode?c.writeInt8(2):c.writeInt8(-1),[a.includeLabels,a.includeInputs,a.includeInputSourceLockingScripts,a.includeInputUnlockingScripts,a.includeOutputs,a.includeOutputLockingScripts]))"boolean"==typeof b?c.writeInt8(+!!b):c.writeInt8(-1);"number"==typeof a.limit?c.writeVarIntNum(a.limit):c.writeVarIntNum(-1),"number"==typeof a.offset?c.writeVarIntNum(a.offset):c.writeVarIntNum(-1),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1);let d=await this.transmit("listActions",b,c.toArray()),e=new ai.Reader(d),f=e.readVarIntNum(),g=[];for(let a=0;a<f;a++){let a,b=e.read(32),c=ai.toHex(b),d=e.readVarIntNum(),f=e.readInt8();switch(f){case 1:a="completed";break;case 2:a="unprocessed";break;case 3:a="sending";break;case 4:a="unproven";break;case 5:a="unsigned";break;case 6:a="nosend";break;case 7:a="nonfinal";break;case 8:a="failed";break;default:throw Error(`Unknown status code: ${f}`)}let h=1===e.readInt8(),i=e.readVarIntNum(),j=e.read(i),k={txid:c,satoshis:d,status:a,isOutgoing:h,description:ai.toUTF8(j),version:0,lockTime:0},l=e.readVarIntNum();if(l>=0){k.labels=[];for(let a=0;a<l;a++){let a=e.readVarIntNum(),b=e.read(a);k.labels.push(ai.toUTF8(b))}}k.version=e.readVarIntNum(),k.lockTime=e.readVarIntNum();let m=e.readVarIntNum();if(m>=0){k.inputs=[];for(let a=0;a<m;a++){let a,b,c=this.readOutpoint(e),d=e.readVarIntNum(),f=e.readVarIntNum();if(f>=0){let b=e.read(f);a=ai.toHex(b)}let g=e.readVarIntNum();if(g>=0){let a=e.read(g);b=ai.toHex(a)}let h=e.readVarIntNum(),i=e.read(h),j=ai.toUTF8(i),l=e.readVarIntNum();k.inputs.push({sourceOutpoint:c,sourceSatoshis:d,sourceLockingScript:a,unlockingScript:b,inputDescription:j,sequenceNumber:l})}}let n=e.readVarIntNum();if(n>=0){k.outputs=[];for(let a=0;a<n;a++){let a,b,c,d=e.readVarIntNum(),f=e.readVarIntNum(),g=e.readVarIntNum();if(g>=0){let b=e.read(g);a=ai.toHex(b)}let h=1===e.readInt8(),i=e.readVarIntNum(),j=e.read(i),l=ai.toUTF8(j),m=e.readVarIntNum();if(m>=0){let a=e.read(m);b=ai.toUTF8(a)}let n=e.readVarIntNum(),o=[];if(n>=0)for(let a=0;a<n;a++){let a=e.readVarIntNum(),b=e.read(a);o.push(ai.toUTF8(b))}let p=e.readVarIntNum();if(p>=0){let a=e.read(p);c=ai.toUTF8(a)}k.outputs.push({outputIndex:d,satoshis:f,lockingScript:a,spendable:h,outputDescription:l,basket:b,tags:o,customInstructions:c})}}g.push(k)}return{totalActions:f,actions:g}}async internalizeAction(a,b){let c=new ai.Writer;for(let b of(c.writeVarIntNum(a.tx.length),c.write(a.tx),c.writeVarIntNum(a.outputs.length),a.outputs))if(c.writeVarIntNum(b.outputIndex),"wallet payment"===b.protocol){if(null==b.paymentRemittance)throw Error("Payment remittance is required for wallet payment");c.writeUInt8(1),c.write(ai.toArray(b.paymentRemittance.senderIdentityKey,"hex"));let a=ai.toArray(b.paymentRemittance.derivationPrefix,"base64");c.writeVarIntNum(a.length),c.write(a);let d=ai.toArray(b.paymentRemittance.derivationSuffix,"base64");c.writeVarIntNum(d.length),c.write(d)}else{c.writeUInt8(2);let a=ai.toArray(b.insertionRemittance?.basket,"utf8");if(c.writeVarIntNum(a.length),c.write(a),"string"==typeof b.insertionRemittance?.customInstructions&&""!==b.insertionRemittance.customInstructions){let a=ai.toArray(b.insertionRemittance.customInstructions,"utf8");c.writeVarIntNum(a.length),c.write(a)}else c.writeVarIntNum(-1);if("object"==typeof b.insertionRemittance?.tags)for(let a of(c.writeVarIntNum(b.insertionRemittance.tags.length),b.insertionRemittance.tags)){let b=ai.toArray(a,"utf8");c.writeVarIntNum(b.length),c.write(b)}else c.writeVarIntNum(0)}if("object"==typeof a.labels)for(let b of(c.writeVarIntNum(a.labels.length),a.labels)){let a=ai.toArray(b,"utf8");c.writeVarIntNum(a.length),c.write(a)}else c.writeVarIntNum(-1);let d=ai.toArray(a.description);return c.writeVarIntNum(d.length),c.write(d),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1),await this.transmit("internalizeAction",b,c.toArray()),{accepted:!0}}async listOutputs(a,b){let c,d=new ai.Writer,e=ai.toArray(a.basket,"utf8");if(d.writeVarIntNum(e.length),d.write(e),"object"==typeof a.tags)for(let b of(d.writeVarIntNum(a.tags.length),a.tags)){let a=ai.toArray(b,"utf8");d.writeVarIntNum(a.length),d.write(a)}else d.writeVarIntNum(0);"all"===a.tagQueryMode?d.writeInt8(1):"any"===a.tagQueryMode?d.writeInt8(2):d.writeInt8(-1),"locking scripts"===a.include?d.writeInt8(1):"entire transactions"===a.include?d.writeInt8(2):d.writeInt8(-1),"boolean"==typeof a.includeCustomInstructions?d.writeInt8(+!!a.includeCustomInstructions):d.writeInt8(-1),"boolean"==typeof a.includeTags?d.writeInt8(+!!a.includeTags):d.writeInt8(-1),"boolean"==typeof a.includeLabels?d.writeInt8(+!!a.includeLabels):d.writeInt8(-1),"number"==typeof a.limit?d.writeVarIntNum(a.limit):d.writeVarIntNum(-1),"number"==typeof a.offset?d.writeVarIntNum(a.offset):d.writeVarIntNum(-1),d.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1);let f=await this.transmit("listOutputs",b,d.toArray()),g=new ai.Reader(f),h=g.readVarIntNum(),i=g.readVarIntNum();i>=0&&(c=g.read(i));let j=[];for(let a=0;a<h;a++){let a={spendable:!0,outpoint:this.readOutpoint(g),satoshis:g.readVarIntNum()},b=g.readVarIntNum();b>=0&&(a.lockingScript=ai.toHex(g.read(b)));let c=g.readVarIntNum();c>=0&&(a.customInstructions=ai.toUTF8(g.read(c)));let d=g.readVarIntNum();if(-1!==d){let b=[];for(let a=0;a<d;a++){let a=g.readVarIntNum();b.push(ai.toUTF8(g.read(a)))}a.tags=b}let e=g.readVarIntNum();if(-1!==e){let b=[];for(let a=0;a<e;a++){let a=g.readVarIntNum();b.push(ai.toUTF8(g.read(a)))}a.labels=b}j.push(a)}return{totalOutputs:h,BEEF:c,outputs:j}}async relinquishOutput(a,b){let c=new ai.Writer,d=ai.toArray(a.basket,"utf8");return c.writeVarIntNum(d.length),c.write(d),c.write(this.encodeOutpoint(a.output)),await this.transmit("relinquishOutput",b,c.toArray()),{relinquished:!0}}encodeOutpoint(a){let b=new ai.Writer,[c,d]=a.split(".");return b.write(ai.toArray(c,"hex")),b.writeVarIntNum(Number(d)),b.toArray()}readOutpoint(a){let b=ai.toHex(a.read(32)),c=a.readVarIntNum();return`${b}.${c}`}async getPublicKey(a,b){let c=new ai.Writer;c.writeUInt8(+!!a.identityKey),a.identityKey?c.write(this.encodePrivilegedParams(a.privileged,a.privilegedReason)):(c.write(this.encodeKeyRelatedParams(a.protocolID??=[e.Silent,"default"],a.keyID??="",a.counterparty,a.privileged,a.privilegedReason)),"boolean"==typeof a.forSelf?c.writeInt8(+!!a.forSelf):c.writeInt8(-1)),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1);let d=await this.transmit("getPublicKey",b,c.toArray());return{publicKey:ai.toHex(d)}}async revealCounterpartyKeyLinkage(a,b){let c=new ai.Writer;c.write(this.encodePrivilegedParams(a.privileged,a.privilegedReason)),c.write(ai.toArray(a.counterparty,"hex")),c.write(ai.toArray(a.verifier,"hex"));let d=await this.transmit("revealCounterpartyKeyLinkage",b,c.toArray()),e=new ai.Reader(d),f=ai.toHex(e.read(33)),g=ai.toHex(e.read(33)),h=ai.toHex(e.read(33)),i=e.readVarIntNum(),j=ai.toUTF8(e.read(i)),k=e.readVarIntNum(),l=e.read(k),m=e.readVarIntNum();return{prover:f,verifier:g,counterparty:h,revelationTime:j,encryptedLinkage:l,encryptedLinkageProof:e.read(m)}}async revealSpecificKeyLinkage(a,b){let c=new ai.Writer;c.write(this.encodeKeyRelatedParams(a.protocolID,a.keyID,a.counterparty,a.privileged,a.privilegedReason)),c.write(ai.toArray(a.verifier,"hex"));let d=await this.transmit("revealSpecificKeyLinkage",b,c.toArray()),e=new ai.Reader(d),f=ai.toHex(e.read(33)),g=ai.toHex(e.read(33)),h=ai.toHex(e.read(33)),i=e.readUInt8(),j=e.readVarIntNum(),k=ai.toUTF8(e.read(j)),l=e.readVarIntNum(),m=ai.toUTF8(e.read(l)),n=e.readVarIntNum(),o=e.read(n),p=e.readVarIntNum();return{prover:f,verifier:g,counterparty:h,protocolID:[i,k],keyID:m,encryptedLinkage:o,encryptedLinkageProof:e.read(p),proofType:e.readUInt8()}}async encrypt(a,b){let c=new ai.Writer;return c.write(this.encodeKeyRelatedParams(a.protocolID,a.keyID,a.counterparty,a.privileged,a.privilegedReason)),c.writeVarIntNum(a.plaintext.length),c.write(a.plaintext),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1),{ciphertext:await this.transmit("encrypt",b,c.toArray())}}async decrypt(a,b){let c=new ai.Writer;return c.write(this.encodeKeyRelatedParams(a.protocolID,a.keyID,a.counterparty,a.privileged,a.privilegedReason)),c.writeVarIntNum(a.ciphertext.length),c.write(a.ciphertext),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1),{plaintext:await this.transmit("decrypt",b,c.toArray())}}async createHmac(a,b){let c=new ai.Writer;return c.write(this.encodeKeyRelatedParams(a.protocolID,a.keyID,a.counterparty,a.privileged,a.privilegedReason)),c.writeVarIntNum(a.data.length),c.write(a.data),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1),{hmac:await this.transmit("createHmac",b,c.toArray())}}async verifyHmac(a,b){let c=new ai.Writer;return c.write(this.encodeKeyRelatedParams(a.protocolID,a.keyID,a.counterparty,a.privileged,a.privilegedReason)),c.write(a.hmac),c.writeVarIntNum(a.data.length),c.write(a.data),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1),await this.transmit("verifyHmac",b,c.toArray()),{valid:!0}}async createSignature(a,b){let c=new ai.Writer;return c.write(this.encodeKeyRelatedParams(a.protocolID,a.keyID,a.counterparty,a.privileged,a.privilegedReason)),"object"==typeof a.data?(c.writeUInt8(1),c.writeVarIntNum(a.data.length),c.write(a.data)):(c.writeUInt8(2),c.write(a.hashToDirectlySign??=[])),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1),{signature:await this.transmit("createSignature",b,c.toArray())}}async verifySignature(a,b){let c=new ai.Writer;return c.write(this.encodeKeyRelatedParams(a.protocolID,a.keyID,a.counterparty,a.privileged,a.privilegedReason)),"boolean"==typeof a.forSelf?c.writeInt8(+!!a.forSelf):c.writeInt8(-1),c.writeVarIntNum(a.signature.length),c.write(a.signature),"object"==typeof a.data?(c.writeUInt8(1),c.writeVarIntNum(a.data.length),c.write(a.data)):(c.writeUInt8(2),c.write(a.hashToDirectlyVerify??[])),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1),await this.transmit("verifySignature",b,c.toArray()),{valid:!0}}encodeKeyRelatedParams(a,b,c,d,e){let f=new ai.Writer;f.writeUInt8(a[0]);let g=ai.toArray(a[1],"utf8");f.writeVarIntNum(g.length),f.write(g);let h=ai.toArray(b,"utf8");return f.writeVarIntNum(h.length),f.write(h),"string"!=typeof c?f.writeUInt8(0):"self"===c?f.writeUInt8(11):"anyone"===c?f.writeUInt8(12):f.write(ai.toArray(c,"hex")),f.write(this.encodePrivilegedParams(d,e)),f.toArray()}async acquireCertificate(a,b){let c=new ai.Writer;c.write(ai.toArray(a.type,"base64")),c.write(ai.toArray(a.certifier,"hex"));let d=Object.entries(a.fields);for(let[a,b]of(c.writeVarIntNum(d.length),d)){let d=ai.toArray(a,"utf8"),e=ai.toArray(b,"utf8");c.writeVarIntNum(d.length),c.write(d),c.writeVarIntNum(e.length),c.write(e)}if(c.write(this.encodePrivilegedParams(a.privileged,a.privilegedReason)),c.writeUInt8("direct"===a.acquisitionProtocol?1:2),"direct"===a.acquisitionProtocol){c.write(ai.toArray(a.serialNumber,"base64")),c.write(this.encodeOutpoint(a.revocationOutpoint??""));let b=ai.toArray(a.signature,"hex");c.writeVarIntNum(b.length),c.write(b);let d="certifier"!==a.keyringRevealer?ai.toArray(a.keyringRevealer,"hex"):[11];c.write(d);let e=Object.keys(a.keyringForSubject??{});c.writeVarIntNum(e.length);for(let b=0;b<e.length;b++){let d=ai.toArray(e[b],"utf8");c.writeVarIntNum(d.length),c.write(d);let f=ai.toArray(a.keyringForSubject?.[e[b]],"base64");c.writeVarIntNum(f.length),c.write(f)}}else{let b=ai.toArray(a.certifierUrl,"utf8");c.writeVarIntNum(b.length),c.write(b)}let e=await this.transmit("acquireCertificate",b,c.toArray()),f=ah.fromBinary(e);return{...f,signature:f.signature}}encodePrivilegedParams(a,b){let c=new ai.Writer;if("boolean"==typeof a?c.writeInt8(+!!a):c.writeInt8(-1),"string"==typeof b){let a=ai.toArray(b,"utf8");c.writeInt8(a.length),c.write(a)}else c.writeInt8(-1);return c.toArray()}async listCertificates(a,b){let c=new ai.Writer;c.writeVarIntNum(a.certifiers.length);for(let b=0;b<a.certifiers.length;b++)c.write(ai.toArray(a.certifiers[b],"hex"));c.writeVarIntNum(a.types.length);for(let b=0;b<a.types.length;b++)c.write(ai.toArray(a.types[b],"base64"));"number"==typeof a.limit?c.writeVarIntNum(a.limit):c.writeVarIntNum(-1),"number"==typeof a.offset?c.writeVarIntNum(a.offset):c.writeVarIntNum(-1),c.write(this.encodePrivilegedParams(a.privileged,a.privilegedReason));let d=await this.transmit("listCertificates",b,c.toArray()),e=new ai.Reader(d),f=e.readVarIntNum(),g=[];for(let a=0;a<f;a++){let a=e.readVarIntNum(),b=e.read(a),c=ah.fromBinary(b);g.push({...c,signature:c.signature})}return{totalCertificates:f,certificates:g}}async proveCertificate(a,b){let c=new ai.Writer,d=ai.toArray(a.certificate.type,"base64");c.write(d);let e=ai.toArray(a.certificate.subject,"hex");c.write(e);let f=ai.toArray(a.certificate.serialNumber,"base64");c.write(f);let g=ai.toArray(a.certificate.certifier,"hex");c.write(g);let h=this.encodeOutpoint(a.certificate.revocationOutpoint??"");c.write(h);let i=ai.toArray(a.certificate.signature,"hex");c.writeVarIntNum(i.length),c.write(i);let j=Object.entries(a.certificate.fields??{});for(let[a,b]of(c.writeVarIntNum(j.length),j)){let d=ai.toArray(a,"utf8"),e=ai.toArray(b,"utf8");c.writeVarIntNum(d.length),c.write(d),c.writeVarIntNum(e.length),c.write(e)}for(let b of(c.writeVarIntNum(a.fieldsToReveal.length),a.fieldsToReveal)){let a=ai.toArray(b,"utf8");c.writeVarIntNum(a.length),c.write(a)}c.write(ai.toArray(a.verifier,"hex")),c.write(this.encodePrivilegedParams(a.privileged,a.privilegedReason));let k=await this.transmit("proveCertificate",b,c.toArray()),l=new ai.Reader(k),m=l.readVarIntNum(),n={};for(let a=0;a<m;a++){let a=l.readVarIntNum(),b=ai.toUTF8(l.read(a)),c=l.readVarIntNum();n[b]=ai.toBase64(l.read(c))}return{keyringForVerifier:n}}async relinquishCertificate(a,b){let c=new ai.Writer,d=ai.toArray(a.type,"base64");c.write(d);let e=ai.toArray(a.serialNumber,"base64");c.write(e);let f=ai.toArray(a.certifier,"hex");return c.write(f),await this.transmit("relinquishCertificate",b,c.toArray()),{relinquished:!0}}parseDiscoveryResult(a){let b=new ai.Reader(a),c=b.readVarIntNum(),d=[];for(let a=0;a<c;a++){let a=b.readVarIntNum(),c=b.read(a),e=ah.fromBinary(c),f=b.readVarIntNum(),g=ai.toUTF8(b.read(f)),h=b.readVarIntNum(),i=ai.toUTF8(b.read(h)),j=b.readVarIntNum(),k=ai.toUTF8(b.read(j)),l=b.readUInt8(),m={},n=b.readVarIntNum();for(let a=0;a<n;a++){let a=b.readVarIntNum(),c=ai.toUTF8(b.read(a)),d=b.readVarIntNum();m[c]=b.read(d)}let o={},p=b.readVarIntNum();for(let a=0;a<p;a++){let a=b.readVarIntNum(),c=ai.toUTF8(b.read(a)),d=b.readVarIntNum();o[c]=ai.toUTF8(b.read(d))}d.push({...e,signature:e.signature,certifierInfo:{iconUrl:i,name:g,description:k,trust:l},publiclyRevealedKeyring:m,decryptedFields:o})}return{totalCertificates:c,certificates:d}}async discoverByIdentityKey(a,b){let c=new ai.Writer;c.write(ai.toArray(a.identityKey,"hex")),"number"==typeof a.limit?c.writeVarIntNum(a.limit):c.writeVarIntNum(-1),"number"==typeof a.offset?c.writeVarIntNum(a.offset):c.writeVarIntNum(-1),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1);let d=await this.transmit("discoverByIdentityKey",b,c.toArray());return this.parseDiscoveryResult(d)}async discoverByAttributes(a,b){let c=new ai.Writer,d=Object.keys(a.attributes);c.writeVarIntNum(d.length);for(let b=0;b<d.length;b++)c.writeVarIntNum(d[b].length),c.write(ai.toArray(d[b],"utf8")),c.writeVarIntNum(a.attributes[d[b]].length),c.write(ai.toArray(a.attributes[d[b]],"utf8"));"number"==typeof a.limit?c.writeVarIntNum(a.limit):c.writeVarIntNum(-1),"number"==typeof a.offset?c.writeVarIntNum(a.offset):c.writeVarIntNum(-1),c.writeInt8("boolean"==typeof a.seekPermission?+!!a.seekPermission:-1);let e=await this.transmit("discoverByAttributes",b,c.toArray());return this.parseDiscoveryResult(e)}async isAuthenticated(a,b){return{authenticated:1===(await this.transmit("isAuthenticated",b))[0]}}async waitForAuthentication(a,b){return await this.transmit("waitForAuthentication",b),{authenticated:!0}}async getHeight(a,b){let c=await this.transmit("getHeight",b);return{height:new ai.Reader(c).readVarIntNum()}}async getHeaderForHeight(a,b){let c=new ai.Writer;c.writeVarIntNum(a.height);let d=await this.transmit("getHeaderForHeight",b,c.toArray());return{header:ai.toHex(d)}}async getNetwork(a,b){return{network:0===(await this.transmit("getNetwork",b))[0]?"mainnet":"testnet"}}async getVersion(a,b){let c=await this.transmit("getVersion",b);return{version:ai.toUTF8(c)}}}a.s(["default",()=>ak],48501);var al=r;class am{baseUrl;httpClient;originator;constructor(a,b="http://localhost:3301",c=fetch){this.baseUrl=b,this.httpClient=c,this.originator=a}async transmitToWallet(a){let b,c=new al.Reader(a),d=c.readUInt8(),e=aj[d];if(void 0===e||""===e)throw Error(`Invalid call code: ${d}`);let f=c.readUInt8();if(f>0){let a=c.read(f);b=al.toUTF8(a)}let g=c.read(),h=await fetch(`${this.baseUrl}/${e}`,{method:"POST",headers:{"Content-Type":"application/octet-stream",Origin:b??""},body:new Uint8Array(g)});return Array.from(new Uint8Array(await h.arrayBuffer()))}}a.s(["default",()=>am],20211);class an extends Error{reviewActionResults;sendWithResults;txid;tx;noSendChange;code;isError=!0;constructor(a,b,c,d,e){super("Undelayed createAction or signAction results require review."),this.reviewActionResults=a,this.sendWithResults=b,this.txid=c,this.tx=d,this.noSendChange=e,this.code=5,this.name=this.constructor.name}}a.s(["WERR_REVIEW_ACTIONS",()=>an,"default",0,an],82463);class ao{baseUrl;httpClient;originator;api;constructor(a,b="http://localhost:3321",c=fetch){this.baseUrl=b,this.originator=a,this.httpClient=c,this.api=async(a,b)=>{let d=await await c(`${this.baseUrl}/${a}`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Originator:this.originator??""},body:JSON.stringify(b)}),e=await d.json();if(!d.ok)if(400===d.status&&e.isError&&5===e.code)throw new an(e.reviewActionResults,e.sendWithResults,e.txid,e.tx,e.noSendChange);else throw Error(JSON.stringify({call:a,args:b,message:e.message??`HTTP Client error ${d.status}`}));return e}}async createAction(a){return await this.api("createAction",a)}async signAction(a){return await this.api("signAction",a)}async abortAction(a){return await this.api("abortAction",a)}async listActions(a){return await this.api("listActions",a)}async internalizeAction(a){return await this.api("internalizeAction",a)}async listOutputs(a){return await this.api("listOutputs",a)}async relinquishOutput(a){return await this.api("relinquishOutput",a)}async getPublicKey(a){return await this.api("getPublicKey",a)}async revealCounterpartyKeyLinkage(a){return await this.api("revealCounterpartyKeyLinkage",a)}async revealSpecificKeyLinkage(a){return await this.api("revealSpecificKeyLinkage",a)}async encrypt(a){return await this.api("encrypt",a)}async decrypt(a){return await this.api("decrypt",a)}async createHmac(a){return await this.api("createHmac",a)}async verifyHmac(a){return await this.api("verifyHmac",a)}async createSignature(a){return await this.api("createSignature",a)}async verifySignature(a){return await this.api("verifySignature",a)}async acquireCertificate(a){return await this.api("acquireCertificate",a)}async listCertificates(a){return await this.api("listCertificates",a)}async proveCertificate(a){return await this.api("proveCertificate",a)}async relinquishCertificate(a){return await this.api("relinquishCertificate",a)}async discoverByIdentityKey(a){return await this.api("discoverByIdentityKey",a)}async discoverByAttributes(a){return await this.api("discoverByAttributes",a)}async isAuthenticated(a){return await this.api("isAuthenticated",a)}async waitForAuthentication(a){return await this.api("waitForAuthentication",a)}async getHeight(a){return await this.api("getHeight",a)}async getHeaderForHeight(a){return await this.api("getHeaderForHeight",a)}async getNetwork(a){return await this.api("getNetwork",a)}async getVersion(a){return await this.api("getVersion",a)}}a.s(["default",()=>ao],91330);var ap=r;class aq{domain;constructor(a="*"){throw Error("The XDM substrate requires a global window object.")}async invoke(a,b){return await new Promise((c,d)=>{let e=ap.toBase64((0,M.default)(12)),f=a=>{let b=JSON.parse(a.data);"CWI"===b.type&&b.id===e&&!0!==b.isInvocation&&("function"==typeof window.removeEventListener&&window.removeEventListener("message",f),"error"===b.status?d(new ad(b.description,b.code)):c(b.result))};window.addEventListener("message",f),window.ReactNativeWebView.postMessage(JSON.stringify({type:"CWI",isInvocation:!0,id:e,call:a,args:b}))})}async createAction(a){return await this.invoke("createAction",a)}async signAction(a){return await this.invoke("signAction",a)}async abortAction(a){return await this.invoke("abortAction",a)}async listActions(a){return await this.invoke("listActions",a)}async internalizeAction(a){return await this.invoke("internalizeAction",a)}async listOutputs(a){return await this.invoke("listOutputs",a)}async relinquishOutput(a){return await this.invoke("relinquishOutput",a)}async getPublicKey(a){return await this.invoke("getPublicKey",a)}async revealCounterpartyKeyLinkage(a){return await this.invoke("revealCounterpartyKeyLinkage",a)}async revealSpecificKeyLinkage(a){return await this.invoke("revealSpecificKeyLinkage",a)}async encrypt(a){return await this.invoke("encrypt",a)}async decrypt(a){return await this.invoke("decrypt",a)}async createHmac(a){return await this.invoke("createHmac",a)}async verifyHmac(a){return await this.invoke("verifyHmac",a)}async createSignature(a){return await this.invoke("createSignature",a)}async verifySignature(a){return await this.invoke("verifySignature",a)}async acquireCertificate(a){return await this.invoke("acquireCertificate",a)}async listCertificates(a){return await this.invoke("listCertificates",a)}async proveCertificate(a){return await this.invoke("proveCertificate",a)}async relinquishCertificate(a){return await this.invoke("relinquishCertificate",a)}async discoverByIdentityKey(a){return await this.invoke("discoverByIdentityKey",a)}async discoverByAttributes(a){return await this.invoke("discoverByAttributes",a)}async isAuthenticated(a){return await this.invoke("isAuthenticated",a)}async waitForAuthentication(a){return await this.invoke("waitForAuthentication",a)}async getHeight(a){return await this.invoke("getHeight",a)}async getHeaderForHeight(a){return await this.invoke("getHeaderForHeight",a)}async getNetwork(a){return await this.invoke("getNetwork",a)}async getVersion(a){return await this.invoke("getVersion",a)}}a.s(["default",()=>aq],24030);class ar{substrate;originator;constructor(a="auto",b){"Cicada"===a&&(a=new ak(new am(b))),"window.CWI"===a&&(a=new ab),"XDM"===a&&(a=new ae),"json-api"===a&&(a=new ao(b)),"react-native"===a&&(a=new aq(b)),this.substrate=a,this.originator=b}async connectToSubstrate(){let a;if("object"==typeof this.substrate)return;let b=async b=>{let c;if("object"!=typeof(c="number"==typeof b?await Promise.race([a.getVersion({}),new Promise((a,c)=>setTimeout(()=>c(Error("Timed out.")),b))]):await a.getVersion({}))||"string"!=typeof c.version)throw Error("Failed to use substrate.")};try{a=new ab,await b(),this.substrate=a}catch(c){try{a=new ae,await b(200),this.substrate=a}catch(c){try{a=new ak(new am(this.originator)),await b(),this.substrate=a}catch(c){try{a=new ao(this.originator),await b(),this.substrate=a}catch(c){try{a=new aq(this.originator),await b(),this.substrate=a}catch(a){throw Error("No wallet available over any communication substrate. Install a BSV wallet today!")}}}}}}async createAction(a){return await this.connectToSubstrate(),await this.substrate.createAction(a,this.originator)}async signAction(a){return await this.connectToSubstrate(),await this.substrate.signAction(a,this.originator)}async abortAction(a){return await this.connectToSubstrate(),await this.substrate.abortAction(a,this.originator)}async listActions(a){return await this.connectToSubstrate(),await this.substrate.listActions(a,this.originator)}async internalizeAction(a){return await this.connectToSubstrate(),await this.substrate.internalizeAction(a,this.originator)}async listOutputs(a){return await this.connectToSubstrate(),await this.substrate.listOutputs(a,this.originator)}async relinquishOutput(a){return await this.connectToSubstrate(),await this.substrate.relinquishOutput(a,this.originator)}async getPublicKey(a){return await this.connectToSubstrate(),await this.substrate.getPublicKey(a,this.originator)}async revealCounterpartyKeyLinkage(a){return await this.connectToSubstrate(),await this.substrate.revealCounterpartyKeyLinkage(a,this.originator)}async revealSpecificKeyLinkage(a){return await this.connectToSubstrate(),await this.substrate.revealSpecificKeyLinkage(a,this.originator)}async encrypt(a){return await this.connectToSubstrate(),await this.substrate.encrypt(a,this.originator)}async decrypt(a){return await this.substrate.decrypt(a,this.originator)}async createHmac(a){return await this.connectToSubstrate(),await this.substrate.createHmac(a,this.originator)}async verifyHmac(a){return await this.connectToSubstrate(),await this.substrate.verifyHmac(a,this.originator)}async createSignature(a){return await this.connectToSubstrate(),await this.substrate.createSignature(a,this.originator)}async verifySignature(a){return await this.connectToSubstrate(),await this.substrate.verifySignature(a,this.originator)}async acquireCertificate(a){return await this.connectToSubstrate(),await this.substrate.acquireCertificate(a,this.originator)}async listCertificates(a){return await this.connectToSubstrate(),await this.substrate.listCertificates(a,this.originator)}async proveCertificate(a){return await this.connectToSubstrate(),await this.substrate.proveCertificate(a,this.originator)}async relinquishCertificate(a){return await this.connectToSubstrate(),await this.substrate.relinquishCertificate(a,this.originator)}async discoverByIdentityKey(a){return await this.connectToSubstrate(),await this.substrate.discoverByIdentityKey(a,this.originator)}async discoverByAttributes(a){return await this.connectToSubstrate(),await this.substrate.discoverByAttributes(a,this.originator)}async isAuthenticated(a={}){return await this.connectToSubstrate(),await this.substrate.isAuthenticated(a,this.originator)}async waitForAuthentication(a={}){return await this.connectToSubstrate(),await this.substrate.waitForAuthentication(a,this.originator)}async getHeight(a={}){return await this.connectToSubstrate(),await this.substrate.getHeight(a,this.originator)}async getHeaderForHeight(a){return await this.connectToSubstrate(),await this.substrate.getHeaderForHeight(a,this.originator)}async getNetwork(a={}){return await this.connectToSubstrate(),await this.substrate.getNetwork(a,this.originator)}async getVersion(a={}){return await this.connectToSubstrate(),await this.substrate.getVersion(a,this.originator)}}a.s(["default",()=>ar],2405),a.s([],69435);var as=r;class at{wallet;constructor(a){this.wallet=a}decodeOutpoint(a){let b=a.read(32),c=as.toHex(b),d=a.readVarIntNum();return`${c}.${d}`}encodeOutpoint(a){let b=new as.Writer,[c,d]=a.split(".");return b.write(as.toArray(c,"hex")),b.writeVarIntNum(Number(d)),b.toArray()}async transmitToWallet(a){let b=new as.Reader(a);try{let a=b.readUInt8(),c=aj[a];if(void 0===c||""===c)throw Error(`Invalid call code: ${a}`);let d=b.readUInt8(),e=b.read(d),f=as.toUTF8(e);switch(c){case"createAction":{let a={},c=b.readVarIntNum(),d=b.read(c);a.description=as.toUTF8(d);let e=b.readVarIntNum();e>=0?a.inputBEEF=b.read(e):a.inputBEEF=void 0;let g=b.readVarIntNum();if(g>=0){a.inputs=[];for(let c=0;c<g;c++){let c={};c.outpoint=this.decodeOutpoint(b);let d=b.readVarIntNum();if(d>=0){let a=b.read(d);c.unlockingScript=as.toHex(a)}else c.unlockingScript=void 0,c.unlockingScriptLength=b.readVarIntNum();let e=b.readVarIntNum(),f=b.read(e);c.inputDescription=as.toUTF8(f);let g=b.readVarIntNum();g>=0?c.sequenceNumber=g:c.sequenceNumber=void 0,a.inputs.push(c)}}else a.inputs=void 0;let h=b.readVarIntNum();if(h>=0){a.outputs=[];for(let c=0;c<h;c++){let c={},d=b.readVarIntNum(),e=b.read(d);c.lockingScript=as.toHex(e),c.satoshis=b.readVarIntNum();let f=b.readVarIntNum(),g=b.read(f);c.outputDescription=as.toUTF8(g);let h=b.readVarIntNum();if(h>=0){let a=b.read(h);c.basket=as.toUTF8(a)}else c.basket=void 0;let i=b.readVarIntNum();if(i>=0){let a=b.read(i);c.customInstructions=as.toUTF8(a)}else c.customInstructions=void 0;let j=b.readVarIntNum();if(j>=0){c.tags=[];for(let a=0;a<j;a++){let a=b.readVarIntNum(),d=b.read(a),e=as.toUTF8(d);c.tags.push(e)}}else c.tags=void 0;a.outputs.push(c)}}else a.outputs=void 0;let i=b.readVarIntNum();i>=0?a.lockTime=i:a.lockTime=void 0;let j=b.readVarIntNum();j>=0?a.version=j:a.version=void 0;let k=b.readVarIntNum();if(k>=0){a.labels=[];for(let c=0;c<k;c++){let c=b.readVarIntNum(),d=b.read(c),e=as.toUTF8(d);a.labels.push(e)}}else a.labels=void 0;let l=b.readInt8();if(1===l){a.options={};let c=b.readInt8();-1===c?a.options.signAndProcess=void 0:a.options.signAndProcess=1===c;let d=b.readInt8();-1===d?a.options.acceptDelayedBroadcast=void 0:a.options.acceptDelayedBroadcast=1===d;let e=b.readInt8();-1===e?a.options.trustSelf=void 0:1===e&&(a.options.trustSelf="known");let f=b.readVarIntNum();if(f>=0){a.options.knownTxids=[];for(let c=0;c<f;c++){let c=b.read(32),d=as.toHex(c);a.options.knownTxids.push(d)}}else a.options.knownTxids=void 0;let g=b.readInt8();-1===g?a.options.returnTXIDOnly=void 0:a.options.returnTXIDOnly=1===g;let h=b.readInt8();-1===h?a.options.noSend=void 0:a.options.noSend=1===h;let i=b.readVarIntNum();if(i>=0){a.options.noSendChange=[];for(let c=0;c<i;c++){let c=this.decodeOutpoint(b);a.options.noSendChange.push(c)}}else a.options.noSendChange=void 0;let j=b.readVarIntNum();if(j>=0){a.options.sendWith=[];for(let c=0;c<j;c++){let c=b.read(32),d=as.toHex(c);a.options.sendWith.push(d)}}else a.options.sendWith=void 0;let k=b.readInt8();-1===k?a.options.randomizeOutputs=void 0:a.options.randomizeOutputs=1===k}else a.options=void 0;let m=await this.wallet.createAction(a,f),n=new as.Writer;if(null!=m.txid&&""!==m.txid?(n.writeInt8(1),n.write(as.toArray(m.txid,"hex"))):n.writeInt8(0),null!=m.tx?(n.writeInt8(1),n.writeVarIntNum(m.tx.length),n.write(m.tx)):n.writeInt8(0),null!=m.noSendChange)for(let a of(n.writeVarIntNum(m.noSendChange.length),m.noSendChange))n.write(this.encodeOutpoint(a));else n.writeVarIntNum(-1);if(null!=m.sendWithResults)for(let a of(n.writeVarIntNum(m.sendWithResults.length),m.sendWithResults)){let b;n.write(as.toArray(a.txid,"hex")),"unproven"===a.status?b=1:"sending"===a.status?b=2:"failed"===a.status&&(b=3),n.writeInt8(b)}else n.writeVarIntNum(-1);if(null!=m.signableTransaction){n.writeInt8(1),n.writeVarIntNum(m.signableTransaction.tx.length),n.write(m.signableTransaction.tx);let a=as.toArray(m.signableTransaction.reference,"base64");n.writeVarIntNum(a.length),n.write(a)}else n.writeInt8(0);let o=new as.Writer;return o.writeUInt8(0),o.write(n.toArray()),o.toArray()}case"signAction":{let a={},c=b.readVarIntNum();a.spends={};for(let d=0;d<c;d++){let c=b.readVarIntNum(),d={},e=b.readVarIntNum(),f=b.read(e);d.unlockingScript=as.toHex(f);let g=b.readVarIntNum();g>=0?d.sequenceNumber=g:d.sequenceNumber=void 0,a.spends[c]=d}let d=b.readVarIntNum(),e=b.read(d);a.reference=as.toBase64(e);let g=b.readInt8();if(1===g){a.options={};let c=b.readInt8();-1===c?a.options.acceptDelayedBroadcast=void 0:a.options.acceptDelayedBroadcast=1===c;let d=b.readInt8();-1===d?a.options.returnTXIDOnly=void 0:a.options.returnTXIDOnly=1===d;let e=b.readInt8();-1===e?a.options.noSend=void 0:a.options.noSend=1===e;let f=b.readVarIntNum();if(f>=0){a.options.sendWith=[];for(let c=0;c<f;c++){let c=b.read(32),d=as.toHex(c);a.options.sendWith.push(d)}}else a.options.sendWith=void 0}else a.options=void 0;let h=await this.wallet.signAction(a,f),i=new as.Writer;if(null!=h.txid&&""!==h.txid?(i.writeInt8(1),i.write(as.toArray(h.txid,"hex"))):i.writeInt8(0),null!=h.tx?(i.writeInt8(1),i.writeVarIntNum(h.tx.length),i.write(h.tx)):i.writeInt8(0),null!=h.sendWithResults)for(let a of(i.writeVarIntNum(h.sendWithResults.length),h.sendWithResults)){let b;i.write(as.toArray(a.txid,"hex")),"unproven"===a.status?b=1:"sending"===a.status?b=2:"failed"===a.status&&(b=3),i.writeInt8(b)}else i.writeVarIntNum(-1);let j=new as.Writer;return j.writeUInt8(0),j.write(i.toArray()),j.toArray()}case"abortAction":{let a=b.read(),c=as.toBase64(a);await this.wallet.abortAction({reference:c},f);let d=new as.Writer;return d.writeUInt8(0),d.toArray()}case"listActions":{let a={},c=b.readVarIntNum();a.labels=[];for(let d=0;d<c;d++){let c=b.readVarIntNum(),d=b.read(c);a.labels.push(as.toUTF8(d))}let d=b.readInt8();for(let c of(-1===d?a.labelQueryMode=void 0:1===d?a.labelQueryMode="any":2===d&&(a.labelQueryMode="all"),["includeLabels","includeInputs","includeInputSourceLockingScripts","includeInputUnlockingScripts","includeOutputs","includeOutputLockingScripts"])){let d=b.readInt8();-1===d?a[c]=void 0:a[c]=1===d}let e=b.readVarIntNum();e>=0?a.limit=e:a.limit=void 0;let g=b.readVarIntNum();g>=0?a.offset=g:a.offset=void 0;let h=b.readInt8();h>=0?a.seekPermission=1===h:a.seekPermission=void 0;let i=await this.wallet.listActions(a,f),j=new as.Writer;for(let a of(j.writeVarIntNum(i.totalActions),i.actions)){let b;switch(j.write(as.toArray(a.txid,"hex")),j.writeVarIntNum(a.satoshis),a.status){case"completed":b=1;break;case"unprocessed":b=2;break;case"sending":b=3;break;case"unproven":b=4;break;case"unsigned":b=5;break;case"nosend":b=6;break;case"nonfinal":b=7;break;case"failed":b=8;break;default:b=-1}j.writeInt8(b),j.writeInt8(+!!a.isOutgoing);let c=as.toArray(a.description,"utf8");if(j.writeVarIntNum(c.length),j.write(c),void 0!==a.labels)for(let b of(j.writeVarIntNum(a.labels.length),a.labels)){let a=as.toArray(b,"utf8");j.writeVarIntNum(a.length),j.write(a)}else j.writeVarIntNum(-1);if(j.writeVarIntNum(a.version),j.writeVarIntNum(a.lockTime),void 0!==a.inputs)for(let b of(j.writeVarIntNum(a.inputs.length),a.inputs)){if(j.write(this.encodeOutpoint(b.sourceOutpoint)),j.writeVarIntNum(b.sourceSatoshis),void 0!==b.sourceLockingScript){let a=as.toArray(b.sourceLockingScript,"hex");j.writeVarIntNum(a.length),j.write(a)}else j.writeVarIntNum(-1);if(void 0!==b.unlockingScript){let a=as.toArray(b.unlockingScript,"hex");j.writeVarIntNum(a.length),j.write(a)}else j.writeVarIntNum(-1);let a=as.toArray(b.inputDescription,"utf8");j.writeVarIntNum(a.length),j.write(a),j.writeVarIntNum(b.sequenceNumber)}else j.writeVarIntNum(-1);if(void 0!==a.outputs)for(let b of(j.writeVarIntNum(a.outputs.length),a.outputs)){if(j.writeVarIntNum(b.outputIndex),j.writeVarIntNum(b.satoshis),void 0!==b.lockingScript){let a=as.toArray(b.lockingScript,"hex");j.writeVarIntNum(a.length),j.write(a)}else j.writeVarIntNum(-1);j.writeInt8(+!!b.spendable);let a=as.toArray(b.outputDescription,"utf8");if(j.writeVarIntNum(a.length),j.write(a),void 0!==b.basket){let a=as.toArray(b.basket,"utf8");j.writeVarIntNum(a.length),j.write(a)}else j.writeVarIntNum(-1);if(void 0!==b.tags)for(let a of(j.writeVarIntNum(b.tags.length),b.tags)){let b=as.toArray(a,"utf8");j.writeVarIntNum(b.length),j.write(b)}else j.writeVarIntNum(-1);if(void 0!==b.customInstructions){let a=as.toArray(b.customInstructions,"utf8");j.writeVarIntNum(a.length),j.write(a)}else j.writeVarIntNum(-1)}else j.writeVarIntNum(-1)}let k=new as.Writer;return k.writeUInt8(0),k.write(j.toArray()),k.toArray()}case"internalizeAction":{let a={},c=b.readVarIntNum();a.tx=b.read(c);let d=b.readVarIntNum();a.outputs=[];for(let c=0;c<d;c++){let c={};c.outputIndex=b.readVarIntNum();let d=b.readUInt8();if(1===d){c.protocol="wallet payment",c.paymentRemittance={};let a=b.read(33);c.paymentRemittance.senderIdentityKey=as.toHex(a);let d=b.readVarIntNum(),e=b.read(d);c.paymentRemittance.derivationPrefix=as.toBase64(e);let f=b.readVarIntNum(),g=b.read(f);c.paymentRemittance.derivationSuffix=as.toBase64(g)}else if(2===d){c.protocol="basket insertion",c.insertionRemittance={};let a=b.readVarIntNum(),d=b.read(a);c.insertionRemittance.basket=as.toUTF8(d);let e=b.readVarIntNum();if(e>=0){let a=b.read(e);c.insertionRemittance.customInstructions=as.toUTF8(a)}let f=b.readVarIntNum();if(f>0){c.insertionRemittance.tags=[];for(let a=0;a<f;a++){let a=b.readVarIntNum(),d=b.read(a);c.insertionRemittance.tags.push(as.toUTF8(d))}}else c.insertionRemittance.tags=[]}a.outputs.push(c)}let e=b.readVarIntNum();if(e>=0){a.labels=[];for(let c=0;c<e;c++){let c=b.readVarIntNum();a.labels.push(as.toUTF8(b.read(c)))}}let g=b.readVarIntNum();a.description=as.toUTF8(b.read(g));let h=b.readInt8();h>=0?a.seekPermission=1===h:a.seekPermission=void 0,await this.wallet.internalizeAction(a,f);let i=new as.Writer;return i.writeUInt8(0),i.toArray()}case"listOutputs":{let a={},c=b.readVarIntNum(),d=b.read(c);a.basket=as.toUTF8(d);let e=b.readVarIntNum();if(e>0){a.tags=[];for(let c=0;c<e;c++){let c=b.readVarIntNum(),d=b.read(c);a.tags.push(as.toUTF8(d))}}else a.tags=void 0;let g=b.readInt8();1===g?a.tagQueryMode="all":2===g?a.tagQueryMode="any":a.tagQueryMode=void 0;let h=b.readInt8();1===h?a.include="locking scripts":2===h?a.include="entire transactions":a.include=void 0;let i=b.readInt8();-1===i?a.includeCustomInstructions=void 0:a.includeCustomInstructions=1===i;let j=b.readInt8();-1===j?a.includeTags=void 0:a.includeTags=1===j;let k=b.readInt8();-1===k?a.includeLabels=void 0:a.includeLabels=1===k;let l=b.readVarIntNum();l>=0?a.limit=l:a.limit=void 0;let m=b.readVarIntNum();m>=0?a.offset=m:a.offset=void 0;let n=b.readInt8();n>=0?a.seekPermission=1===n:a.seekPermission=void 0;let o=await this.wallet.listOutputs(a,f),p=new as.Writer;for(let a of(p.writeVarIntNum(o.totalOutputs),null!=o.BEEF?(p.writeVarIntNum(o.BEEF.length),p.write(o.BEEF)):p.writeVarIntNum(-1),o.outputs)){if(p.write(this.encodeOutpoint(a.outpoint)),p.writeVarIntNum(a.satoshis),void 0!==a.lockingScript){let b=as.toArray(a.lockingScript,"hex");p.writeVarIntNum(b.length),p.write(b)}else p.writeVarIntNum(-1);if(void 0!==a.customInstructions){let b=as.toArray(a.customInstructions,"utf8");p.writeVarIntNum(b.length),p.write(b)}else p.writeVarIntNum(-1);if(void 0!==a.tags)for(let b of(p.writeVarIntNum(a.tags.length),a.tags)){let a=as.toArray(b,"utf8");p.writeVarIntNum(a.length),p.write(a)}else p.writeVarIntNum(-1);if(void 0!==a.labels)for(let b of(p.writeVarIntNum(a.labels.length),a.labels)){let a=as.toArray(b,"utf8");p.writeVarIntNum(a.length),p.write(a)}else p.writeVarIntNum(-1)}let q=new as.Writer;return q.writeUInt8(0),q.write(p.toArray()),q.toArray()}case"relinquishOutput":{let a={},c=b.readVarIntNum(),d=b.read(c);a.basket=as.toUTF8(d),a.output=this.decodeOutpoint(b),await this.wallet.relinquishOutput(a,f);let e=new as.Writer;return e.writeUInt8(0),e.toArray()}case"getPublicKey":{let a={},c=b.readUInt8();if(a.identityKey=1===c,!0!==a.identityKey){a.protocolID=this.decodeProtocolID(b),a.keyID=this.decodeString(b),a.counterparty=this.decodeCounterparty(b);let c=b.readInt8();-1===c?a.privileged=void 0:a.privileged=1===c;let d=b.readInt8();if(-1!==d){let c=b.read(d);a.privilegedReason=as.toUTF8(c)}else a.privilegedReason=void 0;let e=b.readInt8();-1===e?a.forSelf=void 0:a.forSelf=1===e}else{let c=b.readInt8();-1===c?a.privileged=void 0:a.privileged=1===c;let d=b.readInt8();if(-1!==d){let c=b.read(d);a.privilegedReason=as.toUTF8(c)}else a.privilegedReason=void 0}let d=b.readInt8();d>=0?a.seekPermission=1===d:a.seekPermission=void 0;let e=await this.wallet.getPublicKey(a,f),g=new as.Writer;g.writeUInt8(0);let h=as.toArray(e.publicKey,"hex");return g.write(h),g.toArray()}case"encrypt":{let a=this.decodeKeyRelatedParams(b),c=b.readVarIntNum();a.plaintext=b.read(c);let d=b.readInt8();d>=0?a.seekPermission=1===d:a.seekPermission=void 0;let e=await this.wallet.encrypt(a,f),g=new as.Writer;return g.writeUInt8(0),g.write(e.ciphertext),g.toArray()}case"decrypt":{let a=this.decodeKeyRelatedParams(b),c=b.readVarIntNum();a.ciphertext=b.read(c);let d=b.readInt8();d>=0?a.seekPermission=1===d:a.seekPermission=void 0;let e=await this.wallet.decrypt(a,f),g=new as.Writer;return g.writeUInt8(0),g.write(e.plaintext),g.toArray()}case"createHmac":{let a=this.decodeKeyRelatedParams(b),c=b.readVarIntNum();a.data=b.read(c);let d=b.readInt8();d>=0?a.seekPermission=1===d:a.seekPermission=void 0;let e=await this.wallet.createHmac(a,f),g=new as.Writer;return g.writeUInt8(0),g.write(e.hmac),g.toArray()}case"verifyHmac":{let a=this.decodeKeyRelatedParams(b);a.hmac=b.read(32);let c=b.readVarIntNum();a.data=b.read(c);let d=b.readInt8();d>=0?a.seekPermission=1===d:a.seekPermission=void 0,await this.wallet.verifyHmac(a,f);let e=new as.Writer;return e.writeUInt8(0),e.toArray()}case"createSignature":{let a=this.decodeKeyRelatedParams(b),c=b.readUInt8();if(1===c){let c=b.readVarIntNum();a.data=b.read(c)}else 2===c&&(a.hashToDirectlySign=b.read(32));let d=b.readInt8();d>=0?a.seekPermission=1===d:a.seekPermission=void 0;let e=await this.wallet.createSignature(a,f),g=new as.Writer;return g.writeUInt8(0),g.write(e.signature),g.toArray()}case"verifySignature":{let a=this.decodeKeyRelatedParams(b),c=b.readInt8();-1===c?a.forSelf=void 0:a.forSelf=1===c;let d=b.readVarIntNum();a.signature=b.read(d);let e=b.readUInt8();if(1===e){let c=b.readVarIntNum();a.data=b.read(c)}else 2===e&&(a.hashToDirectlyVerify=b.read(32));let g=b.readInt8();g>=0?a.seekPermission=1===g:a.seekPermission=void 0,await this.wallet.verifySignature(a,f);let h=new as.Writer;return h.writeUInt8(0),h.toArray()}case"isAuthenticated":{let a=await this.wallet.isAuthenticated({},f),b=new as.Writer;return b.writeUInt8(0),b.writeUInt8(+!!a.authenticated),b.toArray()}case"waitForAuthentication":{await this.wallet.waitForAuthentication({},f);let a=new as.Writer;return a.writeUInt8(0),a.toArray()}case"getHeight":{let a=await this.wallet.getHeight({},f),b=new as.Writer;return b.writeUInt8(0),b.writeVarIntNum(a.height),b.toArray()}case"getHeaderForHeight":{let a={};a.height=b.readVarIntNum();let c=await this.wallet.getHeaderForHeight(a,f),d=new as.Writer;d.writeUInt8(0);let e=as.toArray(c.header,"hex");return d.write(e),d.toArray()}case"getNetwork":{let a=await this.wallet.getNetwork({},f),b=new as.Writer;return b.writeUInt8(0),b.writeUInt8(+("mainnet"!==a.network)),b.toArray()}case"getVersion":{let a=await this.wallet.getVersion({},f),b=new as.Writer;b.writeUInt8(0);let c=as.toArray(a.version,"utf8");return b.write(c),b.toArray()}case"revealCounterpartyKeyLinkage":{let a={},c=b.readInt8();-1===c?a.privileged=void 0:a.privileged=1===c;let d=b.readInt8();if(-1===d)a.privilegedReason=void 0;else{let c=b.read(d);a.privilegedReason=as.toUTF8(c)}let e=b.read(33);a.counterparty=as.toHex(e);let g=b.read(33);a.verifier=as.toHex(g);let h=await this.wallet.revealCounterpartyKeyLinkage(a,f),i=new as.Writer;i.write(as.toArray(h.prover,"hex")),i.write(as.toArray(h.verifier,"hex")),i.write(as.toArray(h.counterparty,"hex"));let j=as.toArray(h.revelationTime,"utf8");i.writeVarIntNum(j.length),i.write(j),i.writeVarIntNum(h.encryptedLinkage.length),i.write(h.encryptedLinkage),i.writeVarIntNum(h.encryptedLinkageProof.length),i.write(h.encryptedLinkageProof);let k=new as.Writer;return k.writeUInt8(0),k.write(i.toArray()),k.toArray()}case"revealSpecificKeyLinkage":{let a=this.decodeKeyRelatedParams(b),c=b.read(33);a.verifier=as.toHex(c);let d=await this.wallet.revealSpecificKeyLinkage(a,f),e=new as.Writer;e.write(as.toArray(d.prover,"hex")),e.write(as.toArray(d.verifier,"hex")),e.write(as.toArray(d.counterparty,"hex")),e.writeUInt8(d.protocolID[0]);let g=as.toArray(d.protocolID[1],"utf8");e.writeVarIntNum(g.length),e.write(g);let h=as.toArray(d.keyID,"utf8");e.writeVarIntNum(h.length),e.write(h),e.writeVarIntNum(d.encryptedLinkage.length),e.write(d.encryptedLinkage),e.writeVarIntNum(d.encryptedLinkageProof.length),e.write(d.encryptedLinkageProof),e.writeUInt8(d.proofType);let i=new as.Writer;return i.writeUInt8(0),i.write(e.toArray()),i.toArray()}case"acquireCertificate":{let a={},c=b.read(32);a.type=as.toBase64(c);let d=b.read(33);a.certifier=as.toHex(d);let e=b.readVarIntNum();a.fields={};for(let c=0;c<e;c++){let c=b.readVarIntNum(),d=b.read(c),e=as.toUTF8(d),f=b.readVarIntNum(),g=b.read(f),h=as.toUTF8(g);a.fields[e]=h}let g=b.readInt8();-1===g?a.privileged=void 0:a.privileged=1===g;let h=b.readInt8();if(-1===h)a.privilegedReason=void 0;else{let c=b.read(h);a.privilegedReason=as.toUTF8(c)}let i=b.readUInt8();if(a.acquisitionProtocol=1===i?"direct":"issuance","direct"===a.acquisitionProtocol){let c=b.read(32);a.serialNumber=as.toBase64(c),a.revocationOutpoint=this.decodeOutpoint(b);let d=b.readVarIntNum(),e=b.read(d);a.signature=as.toHex(e);let f=b.readUInt8();if(11===f)a.keyringRevealer="certifier";else{let c=[f].concat(b.read(32));a.keyringRevealer=as.toHex(c)}let g=b.readVarIntNum();a.keyringForSubject={};for(let c=0;c<g;c++){let c=b.readVarIntNum(),d=b.read(c),e=as.toUTF8(d),f=b.readVarIntNum(),g=b.read(f),h=as.toBase64(g);a.keyringForSubject[e]=h}}else{let c=b.readVarIntNum(),d=b.read(c);a.certifierUrl=as.toUTF8(d)}let j=await this.wallet.acquireCertificate(a,f),k=new ah(j.type,j.serialNumber,j.subject,j.certifier,j.revocationOutpoint,j.fields,j.signature).toBinary(),l=new as.Writer;return l.writeUInt8(0),l.write(k),l.toArray()}case"listCertificates":{let a={},c=b.readVarIntNum();a.certifiers=[];for(let d=0;d<c;d++){let c=b.read(33);a.certifiers.push(as.toHex(c))}let d=b.readVarIntNum();a.types=[];for(let c=0;c<d;c++){let c=b.read(32);a.types.push(as.toBase64(c))}let e=b.readVarIntNum();e>=0?a.limit=e:a.limit=void 0;let g=b.readVarIntNum();g>=0?a.offset=g:a.offset=void 0;let h=b.readInt8();-1===h?a.privileged=void 0:a.privileged=1===h;let i=b.readInt8();if(-1===i)a.privilegedReason=void 0;else{let c=b.read(i);a.privilegedReason=as.toUTF8(c)}let j=await this.wallet.listCertificates(a,f),k=new as.Writer;for(let a of(k.writeVarIntNum(j.totalCertificates),j.certificates)){let b=new ah(a.type,a.serialNumber,a.subject,a.certifier,a.revocationOutpoint,a.fields,a.signature).toBinary();k.writeVarIntNum(b.length),k.write(b)}let l=new as.Writer;return l.writeUInt8(0),l.write(k.toArray()),l.toArray()}case"proveCertificate":{let a={},c={},d=b.read(32);c.type=as.toBase64(d);let e=b.read(33);c.subject=as.toHex(e);let g=b.read(32);c.serialNumber=as.toBase64(g);let h=b.read(33);c.certifier=as.toHex(h),c.revocationOutpoint=this.decodeOutpoint(b);let i=b.readVarIntNum(),j=b.read(i);c.signature=as.toHex(j);let k=b.readVarIntNum();c.fields={};for(let a=0;a<k;a++){let a=b.readVarIntNum(),d=b.read(a),e=as.toUTF8(d),f=b.readVarIntNum(),g=b.read(f),h=as.toUTF8(g);c.fields[e]=h}a.certificate=c;let l=b.readVarIntNum();a.fieldsToReveal=[];for(let c=0;c<l;c++){let c=b.readVarIntNum(),d=b.read(c),e=as.toUTF8(d);a.fieldsToReveal.push(e)}let m=b.read(33);a.verifier=as.toHex(m);let n=b.readInt8();-1===n?a.privileged=void 0:a.privileged=1===n;let o=b.readInt8();if(-1===o)a.privilegedReason=void 0;else{let c=b.read(o);a.privilegedReason=as.toUTF8(c)}let p=await this.wallet.proveCertificate(a,f),q=new as.Writer,r=Object.entries(p.keyringForVerifier);for(let[a,b]of(q.writeVarIntNum(r.length),r)){let c=as.toArray(a,"utf8");q.writeVarIntNum(c.length),q.write(c);let d=as.toArray(b,"base64");q.writeVarIntNum(d.length),q.write(d)}let s=new as.Writer;return s.writeUInt8(0),s.write(q.toArray()),s.toArray()}case"relinquishCertificate":{let a={},c=b.read(32);a.type=as.toBase64(c);let d=b.read(32);a.serialNumber=as.toBase64(d);let e=b.read(33);a.certifier=as.toHex(e),await this.wallet.relinquishCertificate(a,f);let g=new as.Writer;return g.writeUInt8(0),g.toArray()}case"discoverByIdentityKey":{let a={},c=b.read(33);a.identityKey=as.toHex(c);let d=b.readVarIntNum();d>=0?a.limit=d:a.limit=void 0;let e=b.readVarIntNum();e>=0?a.offset=e:a.offset=void 0;let g=b.readInt8();g>=0?a.seekPermission=1===g:a.seekPermission=void 0;let h=await this.wallet.discoverByIdentityKey(a,f),i=this.serializeDiscoveryResult(h),j=new as.Writer;return j.writeUInt8(0),j.write(i),j.toArray()}case"discoverByAttributes":{let a={},c=b.readVarIntNum();a.attributes={};for(let d=0;d<c;d++){let c=b.readVarIntNum(),d=b.read(c),e=as.toUTF8(d),f=b.readVarIntNum(),g=b.read(f),h=as.toUTF8(g);a.attributes[e]=h}let d=b.readVarIntNum();d>=0?a.limit=d:a.limit=void 0;let e=b.readVarIntNum();e>=0?a.offset=e:a.offset=void 0;let g=b.readInt8();g>=0?a.seekPermission=1===g:a.seekPermission=void 0;let h=await this.wallet.discoverByAttributes(a,f),i=this.serializeDiscoveryResult(h),j=new as.Writer;return j.writeUInt8(0),j.write(i),j.toArray()}default:throw Error(`Method ${c} not implemented`)}}catch(f){let a=new as.Writer;a.writeUInt8("number"==typeof f.code?f.code:1);let b="string"==typeof f.message?f.message:"Unknown error",c=as.toArray(b,"utf8");a.writeVarIntNum(c.length),a.write(c);let d="string"==typeof f.stack?f.stack:"",e=as.toArray(d,"utf8");return a.writeVarIntNum(e.length),a.write(e),a.toArray()}}decodeProtocolID(a){let b=a.readUInt8(),c=a.readVarIntNum(),d=a.read(c);return[b,as.toUTF8(d)]}decodeString(a){let b=a.readVarIntNum(),c=a.read(b);return as.toUTF8(c)}decodeCounterparty(a){let b=a.readUInt8();if(11===b)return"self";{if(12===b)return"anyone";if(0===b)return;let c=a.read(32);return as.toHex([b,...c])}}serializeDiscoveryResult(a){let b=new as.Writer;for(let c of(b.writeVarIntNum(a.totalCertificates),a.certificates)){let a=new ah(c.type,c.serialNumber,c.subject,c.certifier,c.revocationOutpoint,c.fields,c.signaturre).toBinary();b.writeVarIntNum(a.length),b.write(a);let d=as.toArray(c.certifierInfo.name,"utf8");b.writeVarIntNum(d.length),b.write(d);let e=as.toArray(c.certifierInfo.iconUrl,"utf8");b.writeVarIntNum(e.length),b.write(e);let f=as.toArray(c.certifierInfo.description,"utf8");b.writeVarIntNum(f.length),b.write(f),b.writeUInt8(c.certifierInfo.trust);let g=Object.entries(c.publiclyRevealedKeyring);for(let[a,c]of(b.writeVarIntNum(g.length),g)){let d=as.toArray(a,"utf8");b.writeVarIntNum(d.length),b.write(d);let e=as.toArray(c,"base64");b.writeVarIntNum(e.length),b.write(e)}let h=Object.entries(c.decryptedFields);for(let[a,c]of(b.writeVarIntNum(h.length),h)){let d=as.toArray(a,"utf8");b.writeVarIntNum(d.length),b.write(d);let e=as.toArray(c,"utf8");b.writeVarIntNum(e.length),b.write(e)}}return b.toArray()}decodeKeyRelatedParams(a){let b={};b.protocolID=this.decodeProtocolID(a);let c=a.readVarIntNum(),d=a.read(c);b.keyID=as.toUTF8(d),b.counterparty=this.decodeCounterparty(a);let e=a.readInt8();-1===e?b.privileged=void 0:b.privileged=1===e;let f=a.readInt8();if(-1===f)b.privilegedReason=void 0;else{let c=a.read(f);b.privilegedReason=as.toUTF8(c)}return b}}a.s(["default",()=>at],36277),a.s([],8048),a.s([],66904);var au=r;class av extends ah{masterKeyring;constructor(a,b,c,d,e,f,g,h){for(const i of(super(a,b,c,d,e,f,h),Object.keys(f)))if(void 0===g[i]||""===g[i])throw Error(`Master keyring must contain a value for every field. Missing or empty key for field: "${i}".`);this.masterKeyring=g}static async createCertificateFields(a,b,c,d,e){let f={},g={};for(let[h,i]of Object.entries(c)){let c=Q.default.fromRandom(),j=c.encrypt(au.toArray(i,"utf8"));f[h]=au.toBase64(j);let{ciphertext:k}=await a.encrypt({plaintext:c.toArray(),...ah.getCertificateFieldEncryptionDetails(h),counterparty:b,privileged:d,privilegedReason:e});g[h]=au.toBase64(k)}return{certificateFields:f,masterKeyring:g}}static async createKeyringForVerifier(a,b,c,d,e,f,g,h,i){if(!Array.isArray(e))throw Error("fieldsToReveal must be an array of strings");let j={};for(let k of e){if(void 0===d[k]||null===d[k]||""===d[k])throw Error(`Fields to reveal must be a subset of the certificate fields. Missing the "${k}" field.`);let e=(await this.decryptField(a,f,k,d[k],b,h,i)).fieldRevelationKey,{ciphertext:l}=await a.encrypt({plaintext:e,...ah.getCertificateFieldEncryptionDetails(k,g),counterparty:c,privileged:h,privilegedReason:i});j[k]=au.toBase64(l)}return j}static async issueCertificateForSubject(a,b,c,d,e=async a=>"Certificate revocation not tracked.",f){let g=f??au.toBase64((0,M.default)(32)),{certificateFields:h,masterKeyring:i}=await this.createCertificateFields(a,b,c),j=await e(g),k=new av(d,g,b,(await a.getPublicKey({identityKey:!0})).publicKey,j,h,i);return await k.sign(a),k}static async decryptFields(a,b,c,d,e,f){if(null==b||0===Object.keys(b).length)throw Error("A MasterCertificate must have a valid masterKeyring!");try{let g={};for(let h of Object.keys(c))g[h]=(await this.decryptField(a,b,h,c[h],d,e,f)).decryptedFieldValue;return g}catch{throw Error("Failed to decrypt all master certificate fields.")}}static async decryptField(a,b,c,d,e,f,g){if(null==b||0===Object.keys(b).length)throw Error("A MasterCertificate must have a valid masterKeyring!");try{let{plaintext:h}=await a.decrypt({ciphertext:au.toArray(b[c],"base64"),...ah.getCertificateFieldEncryptionDetails(c),counterparty:e,privileged:f,privilegedReason:g}),i=new Q.default(h).decrypt(au.toArray(d,"base64"));return{fieldRevelationKey:h,decryptedFieldValue:au.toUTF8(i)}}catch{throw Error("Failed to decrypt certificate field!")}}}a.s(["MasterCertificate",()=>av],4679);var aw=r;class ax extends ah{keyring;decryptedFields;constructor(a,b,c,d,e,f,g,h,i){super(a,b,c,d,e,f,h),this.keyring=g,this.decryptedFields=i}static fromCertificate(a,b){return new ax(a.type,a.serialNumber,a.subject,a.certifier,a.revocationOutpoint,a.fields,b,a.signature)}async decryptFields(a,b,c){if(null==this.keyring||0===Object.keys(this.keyring).length)throw Error("A keyring is required to decrypt certificate fields for the verifier.");try{let d={};for(let e in this.keyring){let{plaintext:f}=await a.decrypt({ciphertext:aw.toArray(this.keyring[e],"base64"),...ah.getCertificateFieldEncryptionDetails(e,this.serialNumber),counterparty:this.subject,privileged:b,privilegedReason:c}),g=new Q.default(f).decrypt(aw.toArray(this.fields[e],"base64"));d[e]=aw.toUTF8(g)}return d}catch(a){throw Error(`Failed to decrypt selectively revealed certificate fields using keyring: ${String(a instanceof Error?a.message:a)}`)}}}a.s(["VerifiableCertificate",()=>ax],83487);class ay extends aa{keyDeriver;constructor(a){if(super(a),a instanceof X)this.keyDeriver=a;else if("string"==typeof a||a instanceof m.default)this.keyDeriver=new X(a);else throw Error("Invalid key deriver provided")}async isAuthenticated(){throw Error("not implemented")}async waitForAuthentication(){throw Error("not implemented")}async getNetwork(){throw Error("not implemented")}async getVersion(){throw Error("not implemented")}async getPublicKey(a){if(!0===a.privileged)throw Error("no privilege support");if(!0===a.identityKey){if(null===this.keyDeriver||void 0===this.keyDeriver)throw Error("keyDeriver is not initialized");return{publicKey:this.keyDeriver.rootKey.toPublicKey().toString()}}if(null==a.protocolID||"string"!=typeof a.keyID||""===a.keyID.trim())throw Error("protocolID and keyID are required if identityKey is false or undefined.");if(null===this.keyDeriver||void 0===this.keyDeriver)throw Error("keyDeriver is not initialized");return{publicKey:this.keyDeriver.derivePublicKey(a.protocolID,a.keyID,"string"==typeof a.counterparty&&""!==a.counterparty.trim()?a.counterparty:"self",!!a.forSelf).toString()}}async createAction(){throw Error("not implemented")}async signAction(){throw Error("not implemented")}async abortAction(){throw Error("not implemented")}async listActions(){throw Error("not implemented")}async internalizeAction(){throw Error("not implemented")}async listOutputs(){throw Error("not implemented")}async relinquishOutput(){throw Error("not implemented")}async acquireCertificate(){throw Error("not implemented")}async listCertificates(){throw Error("not implemented")}async proveCertificate(){throw Error("not implemented")}async relinquishCertificate(){throw Error("not implemented")}async discoverByIdentityKey(){throw Error("not implemented")}async discoverByAttributes(){throw Error("not implemented")}async getHeight(){throw Error("not implemented")}async getHeaderForHeight(){throw Error("not implemented")}}a.s(["CompletedProtoWallet",()=>ay],51740),a.s([],8198);class az{sessionNonceToSession;identityKeyToNonces;constructor(){this.sessionNonceToSession=new Map,this.identityKeyToNonces=new Map}addSession(a){if("string"!=typeof a.sessionNonce)throw Error("Invalid session: sessionNonce is required to add a session.");if(this.sessionNonceToSession.set(a.sessionNonce,a),"string"==typeof a.peerIdentityKey){let b=this.identityKeyToNonces.get(a.peerIdentityKey);null==b&&(b=new Set,this.identityKeyToNonces.set(a.peerIdentityKey,b)),b.add(a.sessionNonce)}}updateSession(a){this.removeSession(a),this.addSession(a)}getSession(a){let b,c=this.sessionNonceToSession.get(a);if(null!=c)return c;let d=this.identityKeyToNonces.get(a);if(null!=d&&0!==d.size){for(let a of d){let c=this.sessionNonceToSession.get(a);null!=c&&(null==b?b=c:(c.lastUpdate??0)>(b.lastUpdate??0)&&(b=c))}return b}}removeSession(a){if("string"==typeof a.sessionNonce&&this.sessionNonceToSession.delete(a.sessionNonce),"string"==typeof a.peerIdentityKey){let b=this.identityKeyToNonces.get(a.peerIdentityKey);null!=b&&(b.delete(a.sessionNonce??""),0===b.size&&this.identityKeyToNonces.delete(a.peerIdentityKey))}}hasSession(a){if(this.sessionNonceToSession.has(a))return!0;let b=this.identityKeyToNonces.get(a);return null!=b&&b.size>0}}a.s(["SessionManager",()=>az],8010);var aA=r;async function aB(a,b,c="self"){let d=aA.toArray(a,"base64"),e=d.slice(0,16),f=d.slice(16),{valid:g}=await b.verifyHmac({data:e,hmac:f,protocolID:[2,"server hmac"],keyID:aA.toUTF8(e),counterparty:c});return g}a.s(["verifyNonce",()=>aB],70843);var aC=r;async function aD(a,b="self"){let c=(0,M.default)(16),{hmac:d}=await a.createHmac({protocolID:[2,"server hmac"],keyID:aC.toUTF8(c),data:c,counterparty:b}),e=[...c,...d];return aC.toBase64(e)}a.s(["createNonce",()=>aD],64756);let aE=async(a,b,c)=>{let d=await a.listCertificates({certifiers:b.certifiers,types:Object.keys(b.types)});return await Promise.all(d.certificates.map(async d=>{let{keyringForVerifier:e}=await a.proveCertificate({certificate:d,fieldsToReveal:b.types[d.type],verifier:c});return new ax(d.type,d.serialNumber,d.subject,d.certifier,d.revocationOutpoint,d.fields,e,d.signature)}))};a.s(["getVerifiableCertificates",0,aE],53967);let aF=async(a,b,c)=>{if(null==b.certificates||0===b.certificates.length)throw Error("No certificates were provided in the AuthMessage.");await Promise.all(b.certificates.map(async d=>{if(d.subject!==b.identityKey)throw Error(`The subject of one of your certificates ("${d.subject}") is not the same as the request sender ("${b.identityKey}").`);let e=new ax(d.type,d.serialNumber,d.subject,d.certifier,d.revocationOutpoint,d.fields,d.keyring,d.signature);if(!await e.verify())throw Error(`The signature for the certificate with serial number ${e.serialNumber} is invalid!`);if(null!=c){let{certifiers:a,types:b}=c;if(!a.includes(e.certifier))throw Error(`Certificate with serial number ${e.serialNumber} has an unrequested certifier: ${e.certifier}`);if(null==b[e.type])throw Error(`Certificate with type ${e.type} was not requested`)}await e.decryptFields(a)}))};a.s(["validateCertificates",0,aF],71660),a.s([],38053);var aG=r;class aH{sessionManager;transport;wallet;certificatesToRequest;onGeneralMessageReceivedCallbacks=new Map;onCertificatesReceivedCallbacks=new Map;onCertificateRequestReceivedCallbacks=new Map;onInitialResponseReceivedCallbacks=new Map;callbackIdCounter=0;autoPersistLastSession=!0;lastInteractedWithPeer;constructor(a,b,c,d,e){this.wallet=a,this.transport=b,this.certificatesToRequest=c??{certifiers:[],types:{}},this.transport.onData(this.handleIncomingMessage.bind(this)).catch(a=>{throw a}),this.sessionManager=null!=d?d:new az,!1===e?this.autoPersistLastSession=!1:this.autoPersistLastSession=!0}async toPeer(a,b,c){this.autoPersistLastSession&&"string"==typeof this.lastInteractedWithPeer&&"string"!=typeof b&&(b=this.lastInteractedWithPeer);let d=await this.getAuthenticatedSession(b,c),e=aG.toBase64((0,M.default)(32)),{signature:f}=await this.wallet.createSignature({data:a,protocolID:[2,"auth message signature"],keyID:`${e} ${d.peerNonce??""}`,counterparty:d.peerIdentityKey}),g={version:"0.1",messageType:"general",identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,nonce:e,yourNonce:d.peerNonce,payload:a,signature:f};d.lastUpdate=Date.now(),this.sessionManager.updateSession(d);try{await this.transport.send(g)}catch(b){let a=Error(`Failed to send message to peer ${d.peerIdentityKey??"unknown"}: ${String(b.message)}`);throw a.stack=b.stack,a}}async requestCertificates(a,b,c=1e4){this.autoPersistLastSession&&"string"==typeof this.lastInteractedWithPeer&&"string"!=typeof b&&(b=this.lastInteractedWithPeer);let d=await this.getAuthenticatedSession(b,c),e=aG.toBase64((0,M.default)(32)),{signature:f}=await this.wallet.createSignature({data:aG.toArray(JSON.stringify(a),"utf8"),protocolID:[2,"auth message signature"],keyID:`${e} ${d.peerNonce??""}`,counterparty:d.peerIdentityKey}),g={version:"0.1",messageType:"certificateRequest",identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,nonce:e,initialNonce:d.sessionNonce,yourNonce:d.peerNonce,requestedCertificates:a,signature:f};d.lastUpdate=Date.now(),this.sessionManager.updateSession(d);try{await this.transport.send(g)}catch(a){throw Error(`Failed to send certificate request message to peer ${d.peerIdentityKey??"unknown"}: ${String(a.message)}`)}}async getAuthenticatedSession(a,b){let c;if(void 0===this.transport)throw Error("Peer transport is not connected!");if("string"==typeof a&&(c=this.sessionManager.getSession(a)),null==c||!c.isAuthenticated){let d=await this.initiateHandshake(a,b);if(null==(c=this.sessionManager.getSession(d))||!c.isAuthenticated)throw Error("Unable to establish mutual authentication with peer!")}return c}listenForGeneralMessages(a){let b=this.callbackIdCounter++;return this.onGeneralMessageReceivedCallbacks.set(b,a),b}stopListeningForGeneralMessages(a){this.onGeneralMessageReceivedCallbacks.delete(a)}listenForCertificatesReceived(a){let b=this.callbackIdCounter++;return this.onCertificatesReceivedCallbacks.set(b,a),b}stopListeningForCertificatesReceived(a){this.onCertificatesReceivedCallbacks.delete(a)}listenForCertificatesRequested(a){let b=this.callbackIdCounter++;return this.onCertificateRequestReceivedCallbacks.set(b,a),b}stopListeningForCertificatesRequested(a){this.onCertificateRequestReceivedCallbacks.delete(a)}async initiateHandshake(a,b=1e4){let c=await aD(this.wallet),d=Date.now();this.sessionManager.addSession({isAuthenticated:!1,sessionNonce:c,peerIdentityKey:a,lastUpdate:d});let e={version:"0.1",messageType:"initialRequest",identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,initialNonce:c,requestedCertificates:this.certificatesToRequest};return await this.transport.send(e),await this.waitForInitialResponse(c,b)}async waitForInitialResponse(a,b=1e4){return await new Promise((c,d)=>{let e=this.listenForInitialResponse(a,a=>{clearTimeout(f),this.stopListeningForInitialResponses(e),c(a)}),f=setTimeout(()=>{this.stopListeningForInitialResponses(e),d(Error("Initial response timed out."))},b)})}listenForInitialResponse(a,b){let c=this.callbackIdCounter++;return this.onInitialResponseReceivedCallbacks.set(c,{callback:b,sessionNonce:a}),c}stopListeningForInitialResponses(a){this.onInitialResponseReceivedCallbacks.delete(a)}async handleIncomingMessage(a){if("string"!=typeof a.version||"0.1"!==a.version)throw Error(`Invalid or unsupported message auth version! Received: ${a.version}, expected: 0.1`);switch(a.messageType){case"initialRequest":await this.processInitialRequest(a);break;case"initialResponse":await this.processInitialResponse(a);break;case"certificateRequest":await this.processCertificateRequest(a);break;case"certificateResponse":await this.processCertificateResponse(a);break;case"general":await this.processGeneralMessage(a);break;default:throw Error(`Unknown message type of ${String(a.messageType)} from ${String(a.identityKey)}`)}}async processInitialRequest(a){let b;if("string"!=typeof a.identityKey||"string"!=typeof a.initialNonce||""===a.initialNonce)throw Error("Missing required fields in initialRequest message.");let c=await aD(this.wallet),d=Date.now();this.sessionManager.addSession({isAuthenticated:!0,sessionNonce:c,peerNonce:a.initialNonce,peerIdentityKey:a.identityKey,lastUpdate:d}),null!=a.requestedCertificates&&Array.isArray(a.requestedCertificates.certifiers)&&a.requestedCertificates.certifiers.length>0&&(this.onCertificateRequestReceivedCallbacks.size>0?this.onCertificateRequestReceivedCallbacks.forEach(b=>{b(a.identityKey,a.requestedCertificates)}):b=await aE(this.wallet,a.requestedCertificates,a.identityKey));let{signature:e}=await this.wallet.createSignature({data:aG.toArray(a.initialNonce+c,"base64"),protocolID:[2,"auth message signature"],keyID:`${a.initialNonce} ${c}`,counterparty:a.identityKey}),f={version:"0.1",messageType:"initialResponse",identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,initialNonce:c,yourNonce:a.initialNonce,certificates:b,requestedCertificates:this.certificatesToRequest,signature:e};void 0===this.lastInteractedWithPeer&&(this.lastInteractedWithPeer=a.identityKey),await this.transport.send(f)}async processInitialResponse(a){if(!await aB(a.yourNonce,this.wallet))throw Error(`Initial response nonce verification failed from peer: ${a.identityKey}`);let b=this.sessionManager.getSession(a.yourNonce);if(null==b)throw Error(`Peer session not found for peer: ${a.identityKey}`);let c=aG.toArray((b.sessionNonce??"")+(a.initialNonce??""),"base64"),{valid:d}=await this.wallet.verifySignature({data:c,signature:a.signature,protocolID:[2,"auth message signature"],keyID:`${b.sessionNonce??""} ${a.initialNonce??""}`,counterparty:a.identityKey});if(!d)throw Error(`Unable to verify initial response signature for peer: ${a.identityKey}`);if(b.peerNonce=a.initialNonce,b.peerIdentityKey=a.identityKey,b.isAuthenticated=!0,b.lastUpdate=Date.now(),this.sessionManager.updateSession(b),this.certificatesToRequest?.certifiers?.length>0&&a.certificates?.length>0&&(await aF(this.wallet,a,this.certificatesToRequest),this.onCertificatesReceivedCallbacks.forEach(b=>b(a.identityKey,a.certificates))),this.lastInteractedWithPeer=a.identityKey,this.onInitialResponseReceivedCallbacks.forEach(a=>{a.sessionNonce===b.sessionNonce&&a.callback(b.sessionNonce)}),null!=a.requestedCertificates&&Array.isArray(a.requestedCertificates.certifiers)&&a.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(b=>{b(a.identityKey,a.requestedCertificates)});else{let b=await aE(this.wallet,a.requestedCertificates,a.identityKey);await this.sendCertificateResponse(a.identityKey,b)}}async processCertificateRequest(a){if(!await aB(a.yourNonce,this.wallet))throw Error(`Unable to verify nonce for certificate request message from: ${a.identityKey}`);let b=this.sessionManager.getSession(a.yourNonce);if(null==b)throw Error(`Session not found for nonce: ${a.yourNonce}`);let{valid:c}=await this.wallet.verifySignature({data:aG.toArray(JSON.stringify(a.requestedCertificates),"utf8"),signature:a.signature,protocolID:[2,"auth message signature"],keyID:`${a.nonce??""} ${b.sessionNonce??""}`,counterparty:b.peerIdentityKey});if(!c)throw Error(`Invalid signature in certificate request message from ${b.peerIdentityKey}`);if(b.lastUpdate=Date.now(),this.sessionManager.updateSession(b),null!=a.requestedCertificates&&Array.isArray(a.requestedCertificates.certifiers)&&a.requestedCertificates.certifiers.length>0)if(this.onCertificateRequestReceivedCallbacks.size>0)this.onCertificateRequestReceivedCallbacks.forEach(b=>{b(a.identityKey,a.requestedCertificates)});else{let b=await aE(this.wallet,a.requestedCertificates,a.identityKey);await this.sendCertificateResponse(a.identityKey,b)}}async sendCertificateResponse(a,b){let c=await this.getAuthenticatedSession(a),d=aG.toBase64((0,M.default)(32)),{signature:e}=await this.wallet.createSignature({data:aG.toArray(JSON.stringify(b),"utf8"),protocolID:[2,"auth message signature"],keyID:`${d} ${c.peerNonce??""}`,counterparty:c.peerIdentityKey}),f={version:"0.1",messageType:"certificateResponse",identityKey:(await this.wallet.getPublicKey({identityKey:!0})).publicKey,nonce:d,initialNonce:c.sessionNonce,yourNonce:c.peerNonce,certificates:b,signature:e};c.lastUpdate=Date.now(),this.sessionManager.updateSession(c);try{await this.transport.send(f)}catch(b){let a=b instanceof Error?b.message:String(b);throw Error(`Failed to send certificate response message to peer ${c.peerIdentityKey??"unknown"}: ${a}`)}}async processCertificateResponse(a){if(!await aB(a.yourNonce,this.wallet))throw Error(`Unable to verify nonce for certificate response from: ${a.identityKey}`);let b=this.sessionManager.getSession(a.yourNonce);if(null==b)throw Error(`Session not found for nonce: ${a.yourNonce}`);let{valid:c}=await this.wallet.verifySignature({data:aG.toArray(JSON.stringify(a.certificates),"utf8"),signature:a.signature,protocolID:[2,"auth message signature"],keyID:`${a.nonce??""} ${b.sessionNonce??""}`,counterparty:a.identityKey});if(!c)throw Error(`Unable to verify certificate response signature for peer: ${a.identityKey}`);await aF(this.wallet,a,a.requestedCertificates),this.onCertificatesReceivedCallbacks.forEach(b=>{b(a.identityKey,a.certificates??[])}),b.lastUpdate=Date.now(),this.sessionManager.updateSession(b)}async processGeneralMessage(a){if(!await aB(a.yourNonce,this.wallet))throw Error(`Unable to verify nonce for general message from: ${a.identityKey}`);let b=this.sessionManager.getSession(a.yourNonce);if(null==b)throw Error(`Session not found for nonce: ${a.yourNonce}`);let{valid:c}=await this.wallet.verifySignature({data:a.payload,signature:a.signature,protocolID:[2,"auth message signature"],keyID:`${a.nonce??""} ${b.sessionNonce??""}`,counterparty:b.peerIdentityKey});if(!c)throw Error(`Invalid signature in generalMessage from ${b.peerIdentityKey}`);b.lastUpdate=Date.now(),this.sessionManager.updateSession(b),this.lastInteractedWithPeer=a.identityKey,this.onGeneralMessageReceivedCallbacks.forEach(b=>{b(a.identityKey,a.payload??[])})}}a.s(["Peer",()=>aH],3886),a.s([],24656);var aI=r,aJ=u,aK=r;let aL=fetch;class aM{onDataCallback;fetchClient;baseUrl;constructor(a,b=aL){this.fetchClient=b,this.baseUrl=a}async send(a){if(!this.onDataCallback)throw Error("Listen before you start speaking. God gave you two ears and one mouth for a reason.");if("general"!==a.messageType)return new Promise(async(b,c)=>{try{let c=this.fetchClient(`${this.baseUrl}/.well-known/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});"initialRequest"!==a.messageType&&b();let d=await c;if(d.ok&&this.onDataCallback){let a=await d.json();this.onDataCallback(a)}else throw Error("HTTP server failed to authenticate");"initialRequest"===a.messageType&&b()}catch(a){c(a);return}});{let b=this.deserializeRequestPayload(a.payload),c=`${this.baseUrl}${b.urlPostfix}`;if("object"!=typeof b.headers&&(b.headers={}),b.headers["x-bsv-auth-version"]=a.version,b.headers["x-bsv-auth-identity-key"]=a.identityKey,b.headers["x-bsv-auth-nonce"]=a.nonce,b.headers["x-bsv-auth-your-nonce"]=a.yourNonce,b.headers["x-bsv-auth-signature"]=aK.toHex(a.signature),b.headers["x-bsv-auth-request-id"]=b.requestId,b.body){let a=b.headers;if(!a["content-type"])throw Error("Content-Type header is required for requests with a body.");let c=a["content-type"];c.includes("application/json")||c.includes("application/x-www-form-urlencoded")||c.includes("text/plain")?b.body=aK.toUTF8(b.body):b.body=new Uint8Array(b.body)}let d=await this.fetchClient(c,{method:b.method,headers:b.headers,body:b.body});if(500===d.status&&!d.headers.get("x-bsv-auth-request-id")){let a=await d.json();throw Error(`HTTP ${d.status} - ${JSON.stringify(a)}`)}let e=await d.arrayBuffer(),f=new aK.Writer;f.write(aK.toArray(d.headers.get("x-bsv-auth-request-id"),"base64")),f.writeVarIntNum(d.status);let g=[];d.headers.forEach((a,b)=>{let c=b.toLowerCase();(c.startsWith("x-bsv-")||"authorization"===c)&&!c.startsWith("x-bsv-auth")&&g.push([c,a])}),g.sort(([a],[b])=>a.localeCompare(b)),f.writeVarIntNum(g.length);for(let a=0;a<g.length;a++){let b=aK.toArray(g[a][0],"utf8");f.writeVarIntNum(b.length),f.write(b);let c=aK.toArray(g[a][1],"utf8");f.writeVarIntNum(c.length),f.write(c)}if(e){let a=Array.from(new Uint8Array(e));f.writeVarIntNum(a.length),f.write(a)}else f.writeVarIntNum(-1);let h={version:d.headers.get("x-bsv-auth-version"),messageType:"certificateRequest"===d.headers.get("x-bsv-auth-message-type")?"certificateRequest":"general",identityKey:d.headers.get("x-bsv-auth-identity-key"),nonce:d.headers.get("x-bsv-auth-nonce"),yourNonce:d.headers.get("x-bsv-auth-your-nonce"),requestedCertificates:JSON.parse(d.headers.get("x-bsv-auth-requested-certificates")),payload:f.toArray(),signature:aK.toArray(d.headers.get("x-bsv-auth-signature"),"hex")};if(!h.version)throw Error("HTTP server failed to authenticate");this.onDataCallback(h)}}async onData(a){this.onDataCallback=b=>{a(b)}}deserializeRequestPayload(a){let b,c=new aK.Reader(a),d=aK.toBase64(c.read(32)),e=c.readVarIntNum(),f="GET";e>0&&(f=aK.toUTF8(c.read(e)));let g=c.readVarIntNum(),h="";g>0&&(h=aK.toUTF8(c.read(g)));let i=c.readVarIntNum(),j="";i>0&&(j=aK.toUTF8(c.read(i)));let k={},l=c.readVarIntNum();if(l>0)for(let a=0;a<l;a++){let a=c.readVarIntNum(),b=c.read(a),d=aK.toUTF8(b),e=c.readVarIntNum(),f=c.read(e),g=aK.toUTF8(f);k[d]=g}let m=c.readVarIntNum();return m>0&&(b=c.read(m)),{urlPostfix:h+j,method:f,headers:k,body:b,requestId:d}}}a.s(["SimplifiedFetchTransport",()=>aM],29601);class aN{sessionManager;wallet;callbacks={};certificatesReceived=[];requestedCertificates;peers={};constructor(a,b,c){this.wallet=a,this.requestedCertificates=b,this.sessionManager=c||new az}async fetch(a,b={}){if("number"==typeof b.retryCounter){if(b.retryCounter<=0)throw Error("Request failed after maximum number of retries.");b.retryCounter--}let c=await new Promise(async(c,d)=>{try{let e,{method:f="GET",headers:g={},body:h}=b,i=new URL(a),j=i.origin;if(void 0===this.peers[j]){let a=new aM(j);e={peer:new aH(this.wallet,a,this.requestedCertificates,this.sessionManager),pendingCertificateRequests:[]},this.peers[j]=e,this.peers[j].peer.listenForCertificatesReceived((a,b)=>{this.certificatesReceived.push(...b)}),this.peers[j].peer.listenForCertificatesRequested(async(a,b)=>{try{this.peers[j].pendingCertificateRequests.push(!0);let c=await aE(this.wallet,b,a);await this.peers[j].peer.sendCertificateResponse(a,c)}finally{await new Promise(a=>setTimeout(a,500)),this.peers[j].pendingCertificateRequests.shift()}})}else{if(!1===this.peers[j].supportsMutualAuth){try{let d=await this.handleFetchAndValidate(a,b,this.peers[j]);c(d)}catch(a){d(a)}return}e=this.peers[j]}let k=(0,M.default)(32),l=aI.toBase64(k),m=await this.serializeRequest(f,g,h,i,k);this.callbacks[l]={resolve:c,reject:d};let n=e.peer.listenForGeneralMessages((a,b)=>{let c,d=new aI.Reader(b);if(aI.toBase64(d.read(32))!==l)return;e.peer.stopListeningForGeneralMessages(n),this.peers[j].identityKey=a,this.peers[j].supportsMutualAuth=!0;let f=d.readVarIntNum(),g={},h=d.readVarIntNum();if(h>0)for(let a=0;a<h;a++){let a=d.readVarIntNum(),b=d.read(a),c=aI.toUTF8(b),e=d.readVarIntNum(),f=d.read(e),h=aI.toUTF8(f);g[c]=h}g["x-bsv-auth-identity-key"]=a;let i=d.readVarIntNum();i>0&&(c=d.read(i));let k=new Response(c?new Uint8Array(c):null,{status:f,statusText:`${f}`,headers:new Headers(g)});this.callbacks[l].resolve(k),delete this.callbacks[l]});e.pendingCertificateRequests.length>0&&await new Promise(a=>{setInterval(()=>{0===e.pendingCertificateRequests.length&&a()},100)}),await e.peer.toPeer(m.toArray(),e.identityKey).catch(async f=>{if(f.message.includes("Session not found for nonce")){delete this.peers[j],b.retryCounter??=3;let d=await this.fetch(a,b);c(d);return}if(f.message.includes("HTTP server failed to authenticate"))try{let d=await this.handleFetchAndValidate(a,b,e);c(d);return}catch(a){d(a)}else d(f)})}catch(a){d(a)}});return 402===c.status?await this.handlePaymentAndRetry(a,b,c):c}async sendCertificateRequest(a,b){let c,d=new URL(a).origin;if(void 0!==this.peers[d])c={peer:this.peers[d].peer};else{let a=new aM(d);c={peer:new aH(this.wallet,a,this.requestedCertificates,this.sessionManager)},this.peers[d]=c}return await new Promise(async(a,d)=>{let e=c.peer.listenForCertificatesReceived((b,d)=>{c.peer.stopListeningForCertificatesReceived(e),this.certificatesReceived.push(...d),a(d)});try{await c.peer.requestCertificates(b,c.identityKey)}catch(a){c.peer.stopListeningForCertificatesReceived(e),d(a)}})}consumeReceivedCertificates(){return this.certificatesReceived.splice(0)}async serializeRequest(a,b,c,d,e){let f=new aI.Writer;if(f.write(e),f.writeVarIntNum(a.length),f.write(aI.toArray(a)),d.pathname.length>0){let a=aI.toArray(d.pathname);f.writeVarIntNum(a.length),f.write(a)}else f.writeVarIntNum(-1);if(d.search.length>0){let a=aI.toArray(d.search);f.writeVarIntNum(a.length),f.write(a)}else f.writeVarIntNum(-1);let g=[];for(let[a,c]of Object.entries(b))if((a=a.toLowerCase()).startsWith("x-bsv-")||"authorization"===a){if(a.startsWith("x-bsv-auth"))throw Error("No BSV auth headers allowed here!");g.push([a,c])}else if(a.startsWith("content-type"))c=c.split(";")[0].trim(),g.push([a,c]);else throw Error("Unsupported header in the simplified fetch implementation. Only content-type, authorization, and x-bsv-* headers are supported.");g.sort(([a],[b])=>a.localeCompare(b)),f.writeVarIntNum(g.length);for(let a=0;a<g.length;a++){let b=aI.toArray(g[a][0],"utf8");f.writeVarIntNum(b.length),f.write(b);let c=aI.toArray(g[a][1],"utf8");f.writeVarIntNum(c.length),f.write(c)}if(["POST","PUT","PATCH","DELETE"].includes(a.toUpperCase())&&void 0===c){let a=g.find(([a])=>"content-type"===a);c=a&&a[1].includes("application/json")?"{}":""}if(c){let a=await this.normalizeBodyToNumberArray(c);f.writeVarIntNum(a.length),f.write(a)}else f.writeVarIntNum(-1);return f}async handleFetchAndValidate(a,b,c){let d=await fetch(a,b);if(d.headers.forEach(a=>{if(a.toLocaleLowerCase().startsWith("x-bsv"))throw Error("The server is trying to claim it has been authenticated when it has not!")}),d.ok)return c.supportsMutualAuth=!1,d;throw Error(`Request failed with status: ${d.status}`)}async handlePaymentAndRetry(a,b={},c){let d=c.headers.get("x-bsv-payment-version");if(!d||"1.0"!==d)throw Error(`Unsupported x-bsv-payment-version response header. Client version: 1.0, Server version: ${d}`);let e=c.headers.get("x-bsv-payment-satoshis-required");if(!e)throw Error("Missing x-bsv-payment-satoshis-required response header.");let f=parseInt(e);if(isNaN(f)||f<=0)throw Error("Invalid x-bsv-payment-satoshis-required response header value.");let g=c.headers.get("x-bsv-auth-identity-key");if(!g)throw Error("Missing x-bsv-auth-identity-key response header.");let h=c.headers.get("x-bsv-payment-derivation-prefix");if("string"!=typeof h||h.length<1)throw Error("Missing x-bsv-payment-derivation-prefix response header.");let i=await aD(this.wallet),{publicKey:j}=await this.wallet.getPublicKey({protocolID:[2,"3241645161d8"],keyID:`${h} ${i}`,counterparty:g}),k=new l.default().lock(aJ.default.fromString(j).toAddress()).toHex(),{tx:m}=await this.wallet.createAction({description:`Payment for request to ${new URL(a).origin}`,outputs:[{satoshis:f,lockingScript:k,customInstructions:JSON.stringify({derivationPrefix:h,derivationSuffix:i,payee:g}),outputDescription:"HTTP request payment"}],options:{randomizeOutputs:!1}});return b.headers=b.headers||{},b.headers["x-bsv-payment"]=JSON.stringify({derivationPrefix:h,derivationSuffix:i,transaction:aI.toBase64(m)}),b.retryCounter??=3,this.fetch(a,b)}async normalizeBodyToNumberArray(a){if(null==a)return[];if("object"==typeof a)return aI.toArray(JSON.stringify(a,"utf8"));if(Array.isArray(a)&&a.every(a=>"number"==typeof a))return a;if("string"==typeof a)return aI.toArray(a,"utf8");if(a instanceof ArrayBuffer||ArrayBuffer.isView(a))return Array.from(new Uint8Array(a instanceof ArrayBuffer?a:a.buffer));if(a instanceof Blob)return Array.from(new Uint8Array(await a.arrayBuffer()));if(a instanceof FormData){let b=[];a.forEach((a,c)=>{b.push([c,a.toString()])});let c=new URLSearchParams(b).toString();return aI.toArray(c,"utf8")}if(a instanceof URLSearchParams)return aI.toArray(a.toString(),"utf8");if(a instanceof ReadableStream)throw Error("ReadableStream cannot be directly converted to number[].");throw Error("Unsupported body type in this SimplifiedFetch implementation.")}}a.s(["AuthFetch",()=>aN],40625),a.s([],71133),a.s([],39430),a.s([],16259);var aO=y,r=r;class aP{pushDrop;static decode(a){let b=x.decode(a);if(b.fields.length<4)throw Error("Invalid SHIP/SLAP advertisement!");let c=r.toUTF8(b.fields[0]);if("SHIP"!==c&&"SLAP"!==c)throw Error("Invalid protocol type!");let d=r.toHex(b.fields[1]);return{protocol:c,identityKey:d,domain:r.toUTF8(b.fields[2]),topicOrService:r.toUTF8(b.fields[3])}}constructor(a){this.pushDrop=new x(a)}async lock(a,b,c){let{publicKey:d}=await this.pushDrop.wallet.getPublicKey({identityKey:!0});return await this.pushDrop.lock([r.toArray(a,"utf8"),r.toArray(d,"hex"),r.toArray(b,"utf8"),r.toArray(c,"utf8")],[2,"SHIP"===a?"Service Host Interconnect":"Service Lookup Availability"],"1","self")}unlock(a){return this.pushDrop.unlock([2,"SHIP"===a?"Service Host Interconnect":"Service Lookup Availability"],"1","self")}}a.s(["default",()=>aP],18996);let aQ=["https://users.bapp.dev"],aR=["https://testnet-users.bapp.dev"];class aS{fetchClient;allowHTTP;constructor(a=fetch,b=!1){this.fetchClient=a,this.allowHTTP=b}async lookup(a,b,c=5e3){if(!a.startsWith("https:")&&!this.allowHTTP)throw Error('HTTPS facilitator can only use URLs that start with "https:"');let d=new Promise((a,b)=>setTimeout(()=>b(Error("Request timed out")),c)),e=fetch(`${a}/lookup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service:b.service,query:b.query})}),f=await Promise.race([e,d]);if(f.ok)return await f.json();throw Error("Failed to facilitate lookup")}}class aT{facilitator;slapTrackers;hostOverrides;additionalHosts;networkPreset;constructor(a={}){this.networkPreset=a.networkPreset??"mainnet",this.facilitator=a.facilitator??new aS(void 0,"local"===this.networkPreset),this.slapTrackers=a.slapTrackers??("mainnet"===this.networkPreset?aQ:aR),this.hostOverrides=a.hostOverrides??{},this.additionalHosts=a.additionalHosts??{}}async query(a,b){let c=[];if(c="ls_slap"===a.service?"local"===this.networkPreset?["http://localhost:8080"]:this.slapTrackers:null!=this.hostOverrides[a.service]?this.hostOverrides[a.service]:"local"===this.networkPreset?["http://localhost:8080"]:await this.findCompetentHosts(a.service),this.additionalHosts[a.service]?.length>0&&(c=[...c,...this.additionalHosts[a.service]]),c.length<1)throw Error(`No competent ${this.networkPreset} hosts found by the SLAP trackers for lookup service: ${a.service}`);let d=(await Promise.allSettled(c.map(async c=>await this.facilitator.lookup(c,a,b)))).filter(a=>"fulfilled"===a.status).map(a=>a.value);if(0===d.length)throw Error("No successful responses from any hosts");if("freeform"===d[0].type)return d[0];let e=new Map;for(let a of d)if("output-list"===a.type)try{for(let b of a.outputs)try{let a=String(aO.default.fromBEEF(b.beef).id("hex"));if(""!==a){let c=`${String(a)}.${String(b.outputIndex)}`;e.set(c,b)}else console.warn("Invalid transaction ID:",a)}catch{continue}}catch(a){}return{type:"output-list",outputs:Array.from(e.values())}}async findCompetentHosts(a){let b={service:"ls_slap",query:{service:a}},c=await Promise.allSettled(this.slapTrackers.map(async a=>await this.facilitator.lookup(a,b,5e3))),d=new Set;for(let b of c)if("fulfilled"!==b.status)continue;else{let c=b.value;if("output-list"!==c.type)continue;for(let b of c.outputs)try{let c=aO.default.fromBEEF(b.beef).outputs[b.outputIndex].lockingScript,e=aP.decode(c);if(e.topicOrService!==a||"SLAP"!==e.protocol)continue;d.add(e.domain)}catch{continue}}return[...d]}}a.s(["DEFAULT_SLAP_TRACKERS",0,aQ,"DEFAULT_TESTNET_SLAP_TRACKERS",0,aR,"HTTPSOverlayLookupFacilitator",()=>aS,"default",()=>aT],54e3);var aO=y;class aU{httpClient;allowHTTP;constructor(a=fetch,b=!1){this.httpClient=a,this.allowHTTP=b}async send(a,b){if(console.log(a),!a.startsWith("https:")&&!this.allowHTTP)throw Error('HTTPS facilitator can only use URLs that start with "https:"');let c=await fetch(`${a}/submit`,{method:"POST",headers:{"Content-Type":"application/octet-stream","X-Topics":JSON.stringify(b.topics)},body:new Uint8Array(b.beef)});if(c.ok)return await c.json();throw Error("Failed to facilitate broadcast")}}class aV{topics;facilitator;resolver;requireAcknowledgmentFromAllHostsForTopics;requireAcknowledgmentFromAnyHostForTopics;requireAcknowledgmentFromSpecificHostsForTopics;networkPreset;constructor(a,b={}){if(0===a.length)throw Error("At least one topic is required for broadcast.");if(a.some(a=>!a.startsWith("tm_")))throw Error('Every topic must start with "tm_".');this.topics=a,this.networkPreset=b.networkPreset??"mainnet",this.facilitator=b.facilitator??new aU(void 0,"local"===this.networkPreset),this.resolver=b.resolver??new aT({networkPreset:this.networkPreset}),this.requireAcknowledgmentFromAllHostsForTopics=b.requireAcknowledgmentFromAllHostsForTopics??[],this.requireAcknowledgmentFromAnyHostForTopics=b.requireAcknowledgmentFromAnyHostForTopics??"all",this.requireAcknowledgmentFromSpecificHostsForTopics=b.requireAcknowledgmentFromSpecificHostsForTopics??{}}async broadcast(a){let b,c,d,e,f;console.log(a);try{b=a.toBEEF()}catch(a){throw Error("Transactions sent via SHIP to Overlay Services must be serializable to BEEF format.")}let g=await this.findInterestedHosts();if(console.log(g),0===Object.keys(g).length)return{status:"error",code:"ERR_NO_HOSTS_INTERESTED",description:`No ${this.networkPreset} hosts are interested in receiving this transaction.`};let h=Object.entries(g).map(async([a,c])=>{try{let d=await this.facilitator.send(a,{beef:b,topics:[...c]});if(null==d||0===Object.keys(d).length)throw Error("Steak has no topics.");return{host:a,success:!0,steak:d}}catch(b){return console.error(b),{host:a,success:!1,error:b}}}),i=(await Promise.all(h)).filter(a=>a.success);if(0===i.length)return{status:"error",code:"ERR_ALL_HOSTS_REJECTED",description:`All ${this.networkPreset} topical hosts have rejected the transaction.`};let j={};for(let a of i){let b=a.host,c=a.steak,d=new Set;for(let[a,b]of Object.entries(c)){let c=b.outputsToAdmit,e=b.coinsToRetain,f=b.coinsRemoved;(c?.length>0||e?.length>0||f?.length>0)&&d.add(a)}j[b]=d}return("all"===this.requireAcknowledgmentFromAllHostsForTopics?(c=this.topics,d="all"):"any"===this.requireAcknowledgmentFromAllHostsForTopics?(c=this.topics,d="any"):(c=Array.isArray(this.requireAcknowledgmentFromAllHostsForTopics)?this.requireAcknowledgmentFromAllHostsForTopics:this.topics,d="all"),c.length>0&&!this.checkAcknowledgmentFromAllHosts(j,c,d))?{status:"error",code:"ERR_REQUIRE_ACK_FROM_ALL_HOSTS_FAILED",description:"Not all hosts acknowledged the required topics."}:("all"===this.requireAcknowledgmentFromAnyHostForTopics?(e=this.topics,f="all"):"any"===this.requireAcknowledgmentFromAnyHostForTopics?(e=this.topics,f="any"):(e=Array.isArray(this.requireAcknowledgmentFromAnyHostForTopics)?this.requireAcknowledgmentFromAnyHostForTopics:[],f="all"),e.length>0&&!this.checkAcknowledgmentFromAnyHost(j,e,f))?{status:"error",code:"ERR_REQUIRE_ACK_FROM_ANY_HOST_FAILED",description:"No host acknowledged the required topics."}:Object.keys(this.requireAcknowledgmentFromSpecificHostsForTopics).length>0&&!this.checkAcknowledgmentFromSpecificHosts(j,this.requireAcknowledgmentFromSpecificHostsForTopics)?{status:"error",code:"ERR_REQUIRE_ACK_FROM_SPECIFIC_HOSTS_FAILED",description:"Specific hosts did not acknowledge the required topics."}:{status:"success",txid:a.id("hex"),message:`Sent to ${i.length} Overlay Services ${1===i.length?"host":"hosts"}.`}}checkAcknowledgmentFromAllHosts(a,b,c){for(let d of Object.values(a))if("all"===c){for(let a of b)if(!d.has(a))return!1}else if("any"===c){let a=!1;for(let c of b)if(d.has(c)){a=!0;break}if(!a)return!1}return!0}checkAcknowledgmentFromAnyHost(a,b,c){if("all"===c){for(let c of Object.values(a)){let a=!0;for(let d of b)if(!c.has(d)){a=!1;break}if(a)return!0}return!1}for(let c of Object.values(a))for(let a of b)if(c.has(a))return!0;return!1}checkAcknowledgmentFromSpecificHosts(a,b){for(let[c,d]of Object.entries(b)){let b,e,f=a[c];if(null==f)return!1;if("all"===d||"any"===d)e=d,b=this.topics;else{if(!Array.isArray(d))continue;b=d,e="all"}if("all"===e){for(let a of b)if(!f.has(a))return!1}else if("any"===e){let a=!1;for(let c of b)if(f.has(c)){a=!0;break}if(!a)return!1}}return!0}async findInterestedHosts(){if("local"===this.networkPreset){let a=new Set;for(let b=0;b<this.topics.length;b++)a.add(this.topics[b]);return{"http://localhost:8080":a}}let a={},b=await this.resolver.query({service:"ls_ship",query:{topics:this.topics}},5e3);if("output-list"!==b.type)throw Error("SHIP answer is not an output list.");for(let c of b.outputs)try{let b=aO.default.fromBEEF(c.beef).outputs[c.outputIndex].lockingScript,d=aP.decode(b);if(!this.topics.includes(d.topicOrService)||"SHIP"!==d.protocol)continue;void 0===a[d.domain]&&(a[d.domain]=new Set),a[d.domain].add(d.topicOrService)}catch(a){continue}return a}}a.s(["HTTPSOverlayBroadcastFacilitator",()=>aU,"default",()=>aV],39287),a.s([],33434),a.s([],36488);var aW=r;let aX=a=>(a.toLowerCase().startsWith("uhrp:")&&(a=a.slice(5)),a.startsWith("//")&&(a=a.slice(2)),a),aY=a=>{if(32!==a.length)throw Error("Hash length must be 32 bytes (sha256)");return(0,aW.toBase58Check)(a,(0,aW.toArray)("ce00","hex"))},aZ=a=>aY((0,o.sha256)(a)),a$=a=>{a=aX(a);let{data:b,prefix:c}=(0,aW.fromBase58Check)(a,void 0,2);if(32!==b.length)throw Error("Invalid length!");if("ce00"!==(0,aW.toHex)(c))throw Error("Bad prefix");return b};a.s(["getHashFromURL",0,a$,"getURLForFile",0,aZ,"getURLForHash",0,aY,"isValidURL",0,a=>{try{return a$(a),!0}catch(a){return!1}},"normalizeURL",0,aX],57397);class a_{authFetch;baseURL;constructor(a){this.baseURL=a.storageURL,this.authFetch=new aN(a.wallet)}async getUploadInfo(a,b){let c=`${this.baseURL}/upload`,d=await this.authFetch.fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileSize:a,retentionPeriod:b})});if(!d.ok)throw Error(`Upload info request failed: HTTP ${d.status}`);let e=await d.json();if("error"===e.status)throw Error("Upload route returned an error.");return{uploadURL:e.uploadURL,requiredHeaders:e.requiredHeaders,amount:e.amount}}async uploadFile(a,b,c){let d=Uint8Array.from(b.data),e=await fetch(a,{method:"PUT",body:d,headers:{"Content-Type":b.type,...c}});if(!e.ok)throw Error(`File upload failed: HTTP ${e.status}`);return{published:!0,uhrpURL:await aZ(b.data)}}async publishFile(a){let{file:b,retentionPeriod:c}=a,d=b.data.length,{uploadURL:e,requiredHeaders:f}=await this.getUploadInfo(d,c);return await this.uploadFile(e,b,f)}async findFile(a){let b=new URL(`${this.baseURL}/find`);b.searchParams.set("uhrpUrl",a);let c=await this.authFetch.fetch(b.toString(),{method:"GET"});if(!c.ok)throw Error(`findFile request failed: HTTP ${c.status}`);let d=await c.json();if("error"===d.status){let a=d.code??"unknown-code",b=d.description??"no-description";throw Error(`findFile returned an error: ${a} - ${b}`)}return d.data}async listUploads(){let a=`${this.baseURL}/list`,b=await this.authFetch.fetch(a,{method:"GET"});if(!b.ok)throw Error(`listUploads request failed: HTTP ${b.status}`);let c=await b.json();if("error"===c.status){let a=c.code??"unknown-code",b=c.description??"no-description";throw Error(`listUploads returned an error: ${a} - ${b}`)}return c.uploads}async renewFile(a,b){let c=`${this.baseURL}/renew`,d=await this.authFetch.fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uhrpUrl:a,additionalMinutes:b})});if(!d.ok)throw Error(`renewFile request failed: HTTP ${d.status}`);let e=await d.json();if("error"===e.status){let a=e.code??"unknown-code",b=e.description??"no-description";throw Error(`renewFile returned an error: ${a} - ${b}`)}return{status:e.status,prevExpiryTime:e.prevExpiryTime,newExpiryTime:e.newExpiryTime,amount:e.amount}}}a.s(["StorageUploader",()=>a_],39351),a.s(["StorageDownloader",()=>a1],20283);var a0=a.i(57397),a0=a0,s=o,r=r;class a1{networkPreset="mainnet";constructor(a){this.networkPreset=a?.networkPreset}async resolve(a){let b=new aT({networkPreset:this.networkPreset}),c=await b.query({service:"ls_uhrp",query:{uhrpUrl:a}});if("output-list"!==c.type)throw Error("Lookup answer must be an output list");let d=[],e=Math.floor(Date.now()/1e3);for(let a=0;a<c.outputs.length;a++){let b=y.default.fromBEEF(c.outputs[a].beef),{fields:f}=x.decode(b.outputs[c.outputs[a].outputIndex].lockingScript);new r.Reader(f[3]).readVarIntNum()<e||d.push(r.toUTF8(f[2]))}return d}async download(a){if(!a0.isValidURL(a))throw Error("Invalid parameter UHRP url");let b=a0.getHashFromURL(a),c=await this.resolve(a);if(!Array.isArray(c)||0===c.length)throw Error("No one currently hosts this file!");for(let a=0;a<c.length;a++)try{let d=await fetch(c[a],{method:"GET"});if(!d.ok||d.status>=400)continue;let e=await d.arrayBuffer(),f=[...new Uint8Array(e)],g=s.sha256(f);for(let a=0;a<g.length;++a)if(g[a]!==b[a])throw Error("Value of content does not match hash of the url given");return{data:f,mimeType:d.headers.get("Content-Type")}}catch(a){continue}throw Error(`Unable to download content from ${a}`)}}let a2={name:"Unknown Identity",avatarURL:"XUUB8bbn9fEthk15Ge3zTQXypUShfC94vFjp65v7u5CQ8qkpxzst",identityKey:"",abbreviatedKey:"",badgeIconURL:"XUUV39HVPkpmMzYNTx7rpKzJvXfeiVyQWg2vfSpjBAuhunTCA9uG",badgeLabel:"Not verified by anyone you trust.",badgeClickURL:"https://projectbabbage.com/docs/unknown-identity"},a3={protocolID:[1,"identity"],keyID:"1",tokenAmount:1,outputIndex:0},a4={identiCert:"z40BOInXkI8m7f/wBrv4MJ09bZfzZbTj2fJqCtONqCY=",discordCert:"2TgqRC35B1zehGmB21xveZNc7i5iqHc0uxMb+1NMPW4=",phoneCert:"mffUklUzxbHr65xLohn0hRL0Tq2GjW1GYF/OPfzqJ6A=",xCert:"vdDWvftf1H+5+ZprUw123kjHlywH+v20aPQTuXgMpNc=",registrant:"YoPsbfR6YQczjzPdHCoGC7nJsOdPQR50+SYqcWpJ0y0=",emailCert:"exOl3KM0dIJ04EW5pZgbZmPag6MdJXd3/a1enmUU/BA=",anyone:"mfkOMfLDQmrr3SBxBQ5WeE+6Hy3VJRFq6w4A5Ljtlis=",self:"Hkge6X5JRxt1cWXtHLCrSTg6dCVTxjQJJ48iOYd7n3g=",coolCert:"AGfk/WrT1eBDXpz3mcw386Zww2HmqcIn3uY6x4Af1eo="};a.s(["DEFAULT_IDENTITY_CLIENT_OPTIONS",0,a3,"KNOWN_IDENTITY_TYPES",0,a4,"defaultIdentity",0,a2],82378);var aO=y;a.i(34292),a.s(["P2PKH",()=>l.default,"PushDrop",()=>x,"RPuzzle",()=>p],41363);var r=r;class a5{options;originator;authClient;wallet;constructor(a,b=a3,c){this.options=b,this.originator=c,this.wallet=a??new ar,this.authClient=new aN(this.wallet)}async publiclyRevealAttributes(a,b){if(0===Object.keys(a.fields).length)throw Error("Public reveal failed: Certificate has no fields to reveal!");if(0===b.length)throw Error("Public reveal failed: You must reveal at least one field!");try{let b=new ah(a.type,a.serialNumber,a.subject,a.certifier,a.revocationOutpoint,a.fields,a.signature);await b.verify()}catch(a){throw Error("Public reveal failed: Certificate verification failed!")}let{keyringForVerifier:c}=await this.wallet.proveCertificate({certificate:a,fieldsToReveal:b,verifier:new W.PrivateKey(1).toPublicKey().toString()}),d=await new x(this.wallet).lock([r.toArray(JSON.stringify({...a,keyring:c}))],this.options.protocolID,this.options.keyID,"anyone",!0,!0),{tx:e}=await this.wallet.createAction({description:"Create a new Identity Token",outputs:[{satoshis:this.options.tokenAmount,lockingScript:d.toHex(),outputDescription:"Identity Token"}],options:{randomizeOutputs:!1}});if(void 0!==e){let a=new aV(["tm_identity"],{networkPreset:(await this.wallet.getNetwork({})).network});return await a.broadcast(aO.default.fromAtomicBEEF(e))}throw Error("Public reveal failed: failed to create action!")}async resolveByIdentityKey(a){let{certificates:b}=await this.wallet.discoverByIdentityKey(a,this.originator);return b.map(a=>a5.parseIdentity(a))}async resolveByAttributes(a){let{certificates:b}=await this.wallet.discoverByAttributes(a,this.originator);return b.map(a=>a5.parseIdentity(a))}static parseIdentity(a){let b,c,d,e,f,{type:g,decryptedFields:h,certifierInfo:i}=a;switch(g){case a4.xCert:b=h.userName,c=h.profilePhoto,d=`X account certified by ${i.name}`,e=i.iconUrl,f="https://socialcert.net";break;case a4.discordCert:b=h.userName,c=h.profilePhoto,d=`Discord account certified by ${i.name}`,e=i.iconUrl,f="https://socialcert.net";break;case a4.emailCert:b=h.email,c="XUTZxep7BBghAJbSBwTjNfmcsDdRFs5EaGEgkESGSgjJVYgMEizu",d=`Email certified by ${i.name}`,e=i.iconUrl,f="https://socialcert.net";break;case a4.phoneCert:b=h.phoneNumber,c="XUTLxtX3ELNUwRhLwL7kWNGbdnFM8WG2eSLv84J7654oH8HaJWrU",d=`Phone certified by ${i.name}`,e=i.iconUrl,f="https://socialcert.net";break;case a4.identiCert:b=`${h.firstName} ${h.lastName}`,c=h.profilePhoto,d=`Government ID certified by ${i.name}`,e=i.iconUrl,f="https://identicert.me";break;case a4.registrant:b=h.name,c=h.icon,d=`Entity certified by ${i.name}`,e=i.iconUrl,f="https://projectbabbage.com/docs/registrant";break;case a4.coolCert:b="true"===h.cool?"Cool Person!":"Not cool!";break;case a4.anyone:b="Anyone",c="XUT4bpQ6cpBaXi1oMzZsXfpkWGbtp2JTUYAoN7PzhStFJ6wLfoeR",d="Represents the ability for anyone to access this information.",e="XUUV39HVPkpmMzYNTx7rpKzJvXfeiVyQWg2vfSpjBAuhunTCA9uG",f="https://projectbabbage.com/docs/anyone-identity";break;case a4.self:b="You",c="XUT9jHGk2qace148jeCX5rDsMftkSGYKmigLwU2PLLBc7Hm63VYR",d="Represents your ability to access this information.",e="XUUV39HVPkpmMzYNTx7rpKzJvXfeiVyQWg2vfSpjBAuhunTCA9uG",f="https://projectbabbage.com/docs/self-identity";break;default:b=a2.name,c=h.profilePhoto,d=a2.badgeLabel,e=a2.badgeIconURL,f=a2.badgeClickURL}return{name:b,avatarURL:c,abbreviatedKey:a.subject.length>0?`${a.subject.substring(0,10)}...`:"",identityKey:a.subject,badgeIconURL:e,badgeLabel:d,badgeClickURL:f}}}a.s(["IdentityClient",()=>a5],90310),a.s([],57166);var r=r,aO=y,q=j;class a6{wallet;network;constructor(a=new ar){this.wallet=a}async registerDefinition(a){let b=(await this.wallet.getPublicKey({identityKey:!0})).publicKey,c=new x(this.wallet),d=this.buildPushDropFields(a,b),e=this.mapDefinitionTypeToWalletProtocol(a.definitionType),f=await c.lock(d,e,"1","anyone",!0),{tx:g}=await this.wallet.createAction({description:`Register a new ${a.definitionType} item`,outputs:[{satoshis:1,lockingScript:f.toHex(),outputDescription:`New ${a.definitionType} registration token`,basket:this.mapDefinitionTypeToBasketName(a.definitionType)}],options:{randomizeOutputs:!1}});if(void 0===g)throw Error(`Failed to create ${a.definitionType} registration transaction!`);let h=new aV([this.mapDefinitionTypeToTopic(a.definitionType)],{networkPreset:this.network??=(await this.wallet.getNetwork({})).network});return await h.broadcast(aO.default.fromAtomicBEEF(g))}async resolve(a,b){let c=new aT,d=this.mapDefinitionTypeToServiceName(a),e=await c.query({service:d,query:b});if("output-list"!==e.type)return[];let f=[];for(let b of e.outputs)try{let c=aO.default.fromBEEF(b.beef).outputs[b.outputIndex].lockingScript,d=await this.parseLockingScript(a,c);f.push(d)}catch{}return f}async listOwnRegistryEntries(a){let b=this.mapDefinitionTypeToBasketName(a),{outputs:c,BEEF:d}=await this.wallet.listOutputs({basket:b,include:"entire transactions"}),e=[];for(let b of c)if(b.spendable)try{let[c,f]=b.outpoint.split("."),g=aO.default.fromBEEF(d).outputs[f].lockingScript,h=await this.parseLockingScript(a,g);e.push({...h,txid:c,outputIndex:Number(f),satoshis:b.satoshis,lockingScript:g.toHex(),beef:d})}catch{}return e}async revokeOwnRegistryEntry(a){if(void 0===a.txid||void 0===a.outputIndex||void 0===a.lockingScript)throw Error("Invalid registry record. Missing txid, outputIndex, or lockingScript.");let b=(await this.wallet.getPublicKey({identityKey:!0})).publicKey;if(a.registryOperator!==b)throw Error("This registry token does not belong to the current wallet.");let c="basket"===a.definitionType?a.basketID:"protocol"===a.definitionType?a.name:"certificate"===a.definitionType?void 0!==a.name?a.name:a.type:"unknown",d=`${a.txid}.${a.outputIndex}`,{signableTransaction:e}=await this.wallet.createAction({description:`Revoke ${a.definitionType} item: ${c}`,inputBEEF:a.beef,inputs:[{outpoint:d,unlockingScriptLength:73,inputDescription:`Revoking ${a.definitionType} token`}]});if(void 0===e)throw Error("Failed to create signable transaction.");let f=aO.default.fromBEEF(e.tx),g=new x(this.wallet),h=await g.unlock(this.mapDefinitionTypeToWalletProtocol(a.definitionType),"1","anyone","all",!1,a.satoshis,q.default.fromHex(a.lockingScript)),i=await h.sign(f,a.outputIndex),{tx:j}=await this.wallet.signAction({reference:e.reference,spends:{[a.outputIndex]:{unlockingScript:i.toHex()}},options:{acceptDelayedBroadcast:!1}});if(void 0===j)throw Error("Failed to finalize the transaction signature.");let k=new aV([this.mapDefinitionTypeToTopic(a.definitionType)],{networkPreset:this.network??=(await this.wallet.getNetwork({})).network});return await k.broadcast(aO.default.fromAtomicBEEF(j))}buildPushDropFields(a,b){let c;switch(a.definitionType){case"basket":c=[a.basketID,a.name,a.iconURL,a.description,a.documentationURL];break;case"protocol":c=[JSON.stringify(a.protocolID),a.name,a.iconURL,a.description,a.documentationURL];break;case"certificate":c=[a.type,a.name,a.iconURL,a.description,a.documentationURL,JSON.stringify(a.fields)];break;default:throw Error("Unsupported definition type")}return c.push(b),c.map(a=>r.toArray(a))}async parseLockingScript(a,b){let c,d,e=x.decode(b);if(0===e.fields.length)throw Error("Not a valid registry pushdrop script.");switch(a){case"basket":{if(7!==e.fields.length)throw Error("Unexpected field count for basket type.");let[a,b,f,g,h,i]=e.fields;c=r.toUTF8(i),d={definitionType:"basket",basketID:r.toUTF8(a),name:r.toUTF8(b),iconURL:r.toUTF8(f),description:r.toUTF8(g),documentationURL:r.toUTF8(h)};break}case"protocol":{if(7!==e.fields.length)throw Error("Unexpected field count for protocol type.");let[a,b,f,g,h,i]=e.fields;c=r.toUTF8(i),d={definitionType:"protocol",protocolID:a7(r.toUTF8(a)),name:r.toUTF8(b),iconURL:r.toUTF8(f),description:r.toUTF8(g),documentationURL:r.toUTF8(h)};break}case"certificate":{if(8!==e.fields.length)throw Error("Unexpected field count for certificate type.");let[a,b,f,g,h,i,j]=e.fields;c=r.toUTF8(j);let k={};try{k=JSON.parse(r.toUTF8(i))}catch{}d={definitionType:"certificate",type:r.toUTF8(a),name:r.toUTF8(b),iconURL:r.toUTF8(f),description:r.toUTF8(g),documentationURL:r.toUTF8(h),fields:k};break}default:throw Error(`Unsupported definition type: ${a}`)}return{...d,registryOperator:c}}mapDefinitionTypeToWalletProtocol(a){switch(a){case"basket":return[1,"basketmap"];case"protocol":return[1,"protomap"];case"certificate":return[1,"certmap"];default:throw Error(`Unknown definition type: ${a}`)}}mapDefinitionTypeToBasketName(a){switch(a){case"basket":return"basketmap";case"protocol":return"protomap";case"certificate":return"certmap";default:throw Error(`Unknown definition type: ${a}`)}}mapDefinitionTypeToTopic(a){switch(a){case"basket":return"tm_basketmap";case"protocol":return"tm_protomap";case"certificate":return"tm_certmap";default:throw Error(`Unknown definition type: ${a}`)}}mapDefinitionTypeToServiceName(a){switch(a){case"basket":return"ls_basketmap";case"protocol":return"ls_protomap";case"certificate":return"ls_certmap";default:throw Error(`Unknown definition type: ${a}`)}}}function a7(a){let b=JSON.parse(a);if(!Array.isArray(b)||2!==b.length)throw Error("Invalid wallet protocol format.");let[c,d]=b;if(![0,1,2].includes(c))throw Error("Invalid security level.");if("string"!=typeof d)throw Error("Invalid protocolID");return[c,d]}a.s(["RegistryClient",()=>a6,"deserializeWalletProtocol",()=>a7],3043),a.s([],29877),a.s([],71825);var a8=r;class a9{wallet;context;encrypt;originator;constructor(a=new ar,b="kvstore default",c=!0,d){if("string"!=typeof b||b.length<1)throw Error("A context in which to operate is required.");this.wallet=a,this.context=b,this.encrypt=c,this.originator=d}getProtocol(a){return{protocolID:[2,this.context],keyID:a}}async getOutputs(a,b){return await this.wallet.listOutputs({basket:this.context,tags:[a],tagQueryMode:"all",include:"entire transactions",limit:b})}async get(a,b){return(await this.lookupValue(a,b,5)).value}getLockingScript(a,b){let[c,d]=a.outpoint.split("."),e=b.findTxid(c)?.tx;if(null==e)throw Error(`beef must contain txid ${c}`);return e.outputs[Number(d)].lockingScript}async lookupValue(a,b,c){let d,e=await this.getOutputs(a,c),f={value:b,outpoint:void 0,lor:e},{outputs:g}=e;if(0===g.length)return f;let h=g.slice(-1)[0];f.outpoint=h.outpoint;try{if(void 0===e.BEEF)throw Error("entire transactions listOutputs option must return valid BEEF");let a=this.getLockingScript(h,B.Beef.fromBinary(e.BEEF)),b=x.decode(a);if(b.fields.length<1||b.fields.length>2)throw Error("Invalid token.");d=b.fields[0]}catch(a){throw Error(`Invalid value found. You need to call set to collapse the corrupted state (or relinquish the corrupted ${g[0].outpoint} output from the ${this.context} basket) before you can get this value again.`)}if(this.encrypt){let{plaintext:b}=await this.wallet.decrypt({...this.getProtocol(a),ciphertext:d});f.value=a8.toUTF8(b)}else f.value=a8.toUTF8(d);return f}getInputs(a){let b=[];for(let c=0;c<a.length;c++)b.push({outpoint:a[c].outpoint,unlockingScriptLength:74,inputDescription:"Previous key-value token"});return b}async getSpends(a,b,c,d){let e=this.getProtocol(a),f=y.default.fromAtomicBEEF(d),g={};for(let a=0;a<b.length;a++){let b=c.unlock(e.protocolID,e.keyID,"self"),d=await b.sign(f,a);g[a]={unlockingScript:d.toHex()}}return g}async set(a,b){let c,d=await this.lookupValue(a,void 0,10);if(d.value===b){if(void 0===d.outpoint)throw Error("outpoint must be valid when value is valid and unchanged");return d.outpoint}let e=this.getProtocol(a),f=a8.toArray(b,"utf8");if(this.encrypt){let{ciphertext:a}=await this.wallet.encrypt({...e,plaintext:f});f=a}let g=new x(this.wallet,this.originator),h=await g.lock([f],e.protocolID,e.keyID,"self"),{outputs:i,BEEF:j}=d.lor;try{let b=this.getInputs(i),{txid:d,signableTransaction:e}=await this.wallet.createAction({description:`Update ${a} in ${this.context}`,inputBEEF:j,inputs:b,outputs:[{basket:this.context,tags:[a],lockingScript:h.toHex(),satoshis:1,outputDescription:"Key-value token"}],options:{acceptDelayedBroadcast:!1,randomizeOutputs:!1}});if(i.length>0&&"object"!=typeof e)throw Error("Wallet did not return a signable transaction when expected.");if(null==e)c=`${d}.0`;else{let b=await this.getSpends(a,i,g,e.tx),{txid:d}=await this.wallet.signAction({reference:e.reference,spends:b});c=`${d}.0`}}catch(b){throw Error(`There are ${i.length} outputs with tag ${a} that cannot be unlocked.`)}return c}async remove(a){let b=[];for(;;){let{outputs:c,BEEF:d,totalOutputs:e}=await this.getOutputs(a);if(c.length>0){let f=new x(this.wallet,this.originator);try{let e=this.getInputs(c),{signableTransaction:g}=await this.wallet.createAction({description:`Remove ${a} in ${this.context}`,inputBEEF:d,inputs:e,options:{acceptDelayedBroadcast:!1}});if("object"!=typeof g)throw Error("Wallet did not return a signable transaction when expected.");let h=await this.getSpends(a,c,f,g.tx),{txid:i}=await this.wallet.signAction({reference:g.reference,spends:h});if(void 0===i)throw Error("signAction must return a valid txid");b.push(i)}catch(b){throw Error(`There are ${e} outputs with tag ${a} that cannot be unlocked.`)}}if(c.length===e)break}return b}}a.s(["default",()=>a9],60787),a.s([],96209),a.s([],47784)},61101,a=>{"use strict";a.i(7069);var b=a.i(89058),c=a.i(27872),d=a.i(81719),e=a.i(95320),f=a.i(31641),g=a.i(96745),h=a.i(91010),i=a.i(92189),j=a.i(15512),k=a.i(22787),l=a.i(88497),m=a.i(60933),n=a.i(56389),o=a.i(37883),p=a.i(85183);a.s(["BigNumber",()=>b.default,"Curve",()=>c.default,"DRBG",()=>i.default,"ECDSA",0,j,"Hash",0,l,"KeyShares",()=>g.KeyShares,"Point",()=>d.default,"PointInFiniteField",()=>o.PointInFiniteField,"Polynomial",()=>o.default,"PrivateKey",()=>g.default,"PublicKey",()=>e.default,"Random",()=>m.default,"Schnorr",()=>p.default,"Signature",()=>f.default,"SymmetricKey",()=>h.default,"TransactionSignature",()=>n.default,"Utils",0,k])}];

//# sourceMappingURL=node_modules_%40bsv_sdk_dist_esm_108dda9c._.js.map